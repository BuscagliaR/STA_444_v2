<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>STA 444/5 - Introductory Data Science using R</title>
  <meta name="description" content="STA 444/5 - Introductory Data Science using R" />
  <meta name="generator" content="bookdown #bookdown:version# and GitBook 2.6.7" />

  <meta property="og:title" content="STA 444/5 - Introductory Data Science using R" />
  <meta property="og:type" content="book" />
  <meta property="og:image" content="/images/Cover1.png" />
  
  <meta name="github-repo" content="BuscagliaR/STA_444_v2" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="STA 444/5 - Introductory Data Science using R" />
  
  
  <meta name="twitter:image" content="/images/Cover1.png" />

<meta name="author" content="Dr. Robert Buscaglia" />


<meta name="date" content="2024-09-16" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



<!--bookdown:title:start-->
<div id="header">
<h1 class="title">STA 444/5 - Introductory Data Science using R</h1>
<h2 class="subtitle"><em>Version 2</em></h2>
<p class="author"><em>Dr. Robert Buscaglia</em></p>
<p class="date"><em>September 16, 2024</em></p>
</div>
<!--bookdown:title:end-->

<!--bookdown:toc:start-->
  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">
<!--bookdown:toc2:start-->
<ul>
<li><a href="#preface" id="toc-preface">Preface</a>
<ul>
<li><a href="#other-resources" id="toc-other-resources">Other Resources</a></li>
<li><a href="#source-and-error-reports" id="toc-source-and-error-reports">Source and Error Reports</a></li>
<li><a href="#acknowledgments" id="toc-acknowledgments">Acknowledgments</a></li>
</ul></li>
<li><a href="#part-sta-444" id="toc-part-sta-444">(PART*) STA 444</a></li>
<li><a href="#familiarization" id="toc-familiarization"><span class="toc-section-number">1</span> Familiarization</a>
<ul>
<li><a href="#a-basic-script" id="toc-a-basic-script"><span class="toc-section-number">1.1</span> A Basic Script</a></li>
<li><a href="#working-within-an-rmarkdown-file" id="toc-working-within-an-rmarkdown-file"><span class="toc-section-number">1.2</span> Working within an Rmarkdown File</a></li>
<li><a href="#r-as-a-simple-calculator" id="toc-r-as-a-simple-calculator"><span class="toc-section-number">1.3</span> R as a simple calculator</a>
<ul>
<li><a href="#assignment" id="toc-assignment"><span class="toc-section-number">1.3.1</span> Assignment</a></li>
<li><a href="#vectors" id="toc-vectors"><span class="toc-section-number">1.3.2</span> Vectors</a></li>
</ul></li>
<li><a href="#packages" id="toc-packages"><span class="toc-section-number">1.4</span> Packages</a></li>
<li><a href="#finding-help" id="toc-finding-help"><span class="toc-section-number">1.5</span> Finding Help</a>
<ul>
<li><a href="#how-does-this-function-work" id="toc-how-does-this-function-work"><span class="toc-section-number">1.5.1</span> How does this function work?</a></li>
<li><a href="#how-does-this-package-work" id="toc-how-does-this-package-work"><span class="toc-section-number">1.5.2</span> How does this package work?</a></li>
<li><a href="#how-do-i-do-xxx" id="toc-how-do-i-do-xxx"><span class="toc-section-number">1.5.3</span> How do I do XXX?</a></li>
</ul></li>
<li><a href="#Exercises_Familiarization" id="toc-Exercises_Familiarization"><span class="toc-section-number">1.6</span> Exercises</a></li>
</ul></li>
<li><a href="#data-frames" id="toc-data-frames"><span class="toc-section-number">2</span> Data Frames</a>
<ul>
<li><a href="#data-frames-1" id="toc-data-frames-1"><span class="toc-section-number">2.1</span> Data Frames</a></li>
<li><a href="#introduction-to-importing-data" id="toc-introduction-to-importing-data"><span class="toc-section-number">2.2</span> Introduction to Importing Data</a>
<ul>
<li><a href="#from-a-package" id="toc-from-a-package"><span class="toc-section-number">2.2.1</span> From a Package</a></li>
<li><a href="#import-from-.csv-or-.xls-files" id="toc-import-from-.csv-or-.xls-files"><span class="toc-section-number">2.2.2</span> Import from <code>.csv</code> or <code>.xls</code> files</a></li>
</ul></li>
<li><a href="#data-types" id="toc-data-types"><span class="toc-section-number">2.3</span> Data Types</a></li>
<li><a href="#basic-manipulation" id="toc-basic-manipulation"><span class="toc-section-number">2.4</span> Basic Manipulation</a></li>
<li><a href="#Exercises_IntroDataFrames" id="toc-Exercises_IntroDataFrames"><span class="toc-section-number">2.5</span> Exercises</a></li>
</ul></li>
<li><a href="#graphing" id="toc-graphing"><span class="toc-section-number">3</span> Graphing</a>
<ul>
<li><a href="#introduction-to-ggplot2-graphics" id="toc-introduction-to-ggplot2-graphics"><span class="toc-section-number">3.1</span> Introduction to ggplot2 graphics</a></li>
<li><a href="#basic-graphs" id="toc-basic-graphs"><span class="toc-section-number">3.2</span> Basic Graphs</a>
<ul>
<li><a href="#scatterplots" id="toc-scatterplots"><span class="toc-section-number">3.2.1</span> Scatterplots</a></li>
<li><a href="#box-plots" id="toc-box-plots"><span class="toc-section-number">3.2.2</span> Box Plots</a></li>
</ul></li>
<li><a href="#faceting" id="toc-faceting"><span class="toc-section-number">3.3</span> Faceting</a></li>
<li><a href="#annotation" id="toc-annotation"><span class="toc-section-number">3.4</span> Annotation</a>
<ul>
<li><a href="#axis-labels-and-titles" id="toc-axis-labels-and-titles"><span class="toc-section-number">3.4.1</span> Axis Labels and Titles</a></li>
<li><a href="#text-labels" id="toc-text-labels"><span class="toc-section-number">3.4.2</span> Text Labels</a></li>
</ul></li>
<li><a href="#Exercises_IntroGraphing" id="toc-Exercises_IntroGraphing"><span class="toc-section-number">3.5</span> Exercises</a></li>
</ul></li>
<li><a href="#data-wrangling" id="toc-data-wrangling"><span class="toc-section-number">4</span> Data Wrangling</a>
<ul>
<li><a href="#introduction-to-dplyr-and-the-pipe-command" id="toc-introduction-to-dplyr-and-the-pipe-command"><span class="toc-section-number">4.1</span> Introduction to dplyr and the pipe command</a></li>
<li><a href="#common-dplyr-verbs" id="toc-common-dplyr-verbs"><span class="toc-section-number">4.2</span> Common dplyr Verbs</a></li>
<li><a href="#adding-new-rows-and-columns" id="toc-adding-new-rows-and-columns"><span class="toc-section-number">4.3</span> Adding new rows and columns</a>
<ul>
<li><a href="#add_row" id="toc-add_row"><span class="toc-section-number">4.3.1</span> add_row()</a></li>
<li><a href="#bind_rows" id="toc-bind_rows"><span class="toc-section-number">4.3.2</span> bind_rows()</a></li>
</ul></li>
<li><a href="#subsetting" id="toc-subsetting"><span class="toc-section-number">4.4</span> Subsetting</a>
<ul>
<li><a href="#select-select-columns" id="toc-select-select-columns"><span class="toc-section-number">4.4.1</span> select(): select columns</a></li>
<li><a href="#filter-select-rows-with-logicals" id="toc-filter-select-rows-with-logicals"><span class="toc-section-number">4.4.2</span> filter(): select rows with logicals</a></li>
<li><a href="#slice-select-rows-with-numerics." id="toc-slice-select-rows-with-numerics."><span class="toc-section-number">4.4.3</span> slice(): Select rows with numerics.</a></li>
<li><a href="#arrange-sort-data" id="toc-arrange-sort-data"><span class="toc-section-number">4.4.4</span> arrange(): sort data</a></li>
<li><a href="#mutate-update-and-create-new-columns" id="toc-mutate-update-and-create-new-columns"><span class="toc-section-number">4.4.5</span> mutate(): Update and Create New Columns</a></li>
<li><a href="#across-modify-multiple-columns" id="toc-across-modify-multiple-columns"><span class="toc-section-number">4.4.6</span> across(): Modify Multiple Columns</a></li>
<li><a href="#summarise-create-new-summary-data-frame" id="toc-summarise-create-new-summary-data-frame"><span class="toc-section-number">4.4.7</span> summarise(): create new summary data frame</a></li>
</ul></li>
<li><a href="#group-split-and-combine" id="toc-group-split-and-combine"><span class="toc-section-number">4.5</span> Group, Split, and Combine</a>
<ul>
<li><a href="#group_by-calculations-on-grouped-variables" id="toc-group_by-calculations-on-grouped-variables"><span class="toc-section-number">4.5.1</span> group_by(): calculations on grouped variables</a></li>
</ul></li>
<li><a href="#Exercises_IntroDataWrangling" id="toc-Exercises_IntroDataWrangling"><span class="toc-section-number">4.6</span> Exercises</a></li>
</ul></li>
<li><a href="#statistical-models" id="toc-statistical-models"><span class="toc-section-number">5</span> Statistical Models</a>
<ul>
<li><a href="#introduction-to-simple-statistical-models" id="toc-introduction-to-simple-statistical-models"><span class="toc-section-number">5.1</span> Introduction to Simple Statistical Models</a>
<ul>
<li><a href="#formula-notation" id="toc-formula-notation"><span class="toc-section-number">5.1.1</span> Formula Notation</a></li>
</ul></li>
<li><a href="#basic-models" id="toc-basic-models"><span class="toc-section-number">5.2</span> Basic Models</a>
<ul>
<li><a href="#t-tests" id="toc-t-tests"><span class="toc-section-number">5.2.1</span> t-tests</a></li>
<li><a href="#lm-objects" id="toc-lm-objects"><span class="toc-section-number">5.2.2</span> lm objects</a></li>
</ul></li>
<li><a href="#accessor-functions" id="toc-accessor-functions"><span class="toc-section-number">5.3</span> Accessor functions</a></li>
<li><a href="#Exercises_ModelBuilding" id="toc-Exercises_ModelBuilding"><span class="toc-section-number">5.4</span> Exercises</a></li>
</ul></li>
<li><a href="#flow-control" id="toc-flow-control"><span class="toc-section-number">6</span> Flow &amp; Control</a>
<ul>
<li><a href="#control-and-flow" id="toc-control-and-flow"><span class="toc-section-number">6.1</span> Control and Flow</a></li>
<li><a href="#logical-expressions" id="toc-logical-expressions"><span class="toc-section-number">6.2</span> Logical Expressions</a></li>
<li><a href="#decision-statements" id="toc-decision-statements"><span class="toc-section-number">6.3</span> Decision statements</a>
<ul>
<li><a href="#simplified-dplyr-wrangling" id="toc-simplified-dplyr-wrangling"><span class="toc-section-number">6.3.1</span> Simplified <code>dplyr</code> wrangling</a></li>
<li><a href="#base-if-else-statements" id="toc-base-if-else-statements"><span class="toc-section-number">6.3.2</span> Base <code>if else</code> statements</a></li>
<li><a href="#nested-if-else-statements" id="toc-nested-if-else-statements"><span class="toc-section-number">6.3.3</span> Nested <code>if else</code> statements</a></li>
</ul></li>
<li><a href="#loops" id="toc-loops"><span class="toc-section-number">6.4</span> Loops</a>
<ul>
<li><a href="#while-loops" id="toc-while-loops"><span class="toc-section-number">6.4.1</span> <code>while</code> Loops</a></li>
<li><a href="#for-loops" id="toc-for-loops"><span class="toc-section-number">6.4.2</span> <code>for</code> Loops</a></li>
</ul></li>
<li><a href="#functions" id="toc-functions"><span class="toc-section-number">6.5</span> Functions</a></li>
<li><a href="#Exercises_FlowControl" id="toc-Exercises_FlowControl"><span class="toc-section-number">6.6</span> Exercises</a>
<ul>
<li><a href="#exercise-1" id="toc-exercise-1">Exercise 1</a></li>
<li><a href="#exercise-2" id="toc-exercise-2">Exercise 2</a></li>
<li><a href="#exercise-3" id="toc-exercise-3">Exercise 3</a></li>
<li><a href="#exercise-4" id="toc-exercise-4">Exercise 4</a></li>
</ul></li>
</ul></li>
<li><a href="#factors" id="toc-factors"><span class="toc-section-number">7</span> Factors</a>
<ul>
<li><a href="#creation-and-structure" id="toc-creation-and-structure"><span class="toc-section-number">7.1</span> Creation and Structure</a></li>
<li><a href="#change-labels" id="toc-change-labels"><span class="toc-section-number">7.2</span> Change Labels</a></li>
<li><a href="#reorder-levels-1" id="toc-reorder-levels-1"><span class="toc-section-number">7.3</span> Reorder Levels</a></li>
<li><a href="#add-or-subtract-levels-1" id="toc-add-or-subtract-levels-1"><span class="toc-section-number">7.4</span> Add or subtract Levels</a></li>
<li><a href="#Exercises_Factors" id="toc-Exercises_Factors"><span class="toc-section-number">7.5</span> Exercises</a></li>
</ul></li>
<li><a href="#part-additional-information" id="toc-part-additional-information">(PART*) Additional Information</a></li>
<li><a href="#personal-computer---r-and-rmd" id="toc-personal-computer---r-and-rmd">Personal Computer - R and RMD</a>
<ul>
<li><a href="#installing-r" id="toc-installing-r">Installing R</a></li>
<li><a href="#rstudio" id="toc-rstudio">RStudio</a></li>
<li><a href="#rmarkdown" id="toc-rmarkdown">RMarkdown</a></li>
<li><a href="#tinytex" id="toc-tinytex">tinytex</a></li>
<li><a href="#first-rmd-file" id="toc-first-rmd-file">First RMD File</a></li>
</ul></li>
<li><a href="#cheatsheet" id="toc-cheatsheet">CheatSheet</a>
<ul>
<li><a href="#importing-data-and-loading-packages" id="toc-importing-data-and-loading-packages">Importing Data and Loading Packages</a></li>
<li><a href="#useful-vectorized-functions" id="toc-useful-vectorized-functions">Useful vectorized functions</a></li>
<li><a href="#data-frame-tibble-manipulation" id="toc-data-frame-tibble-manipulation">Data frame (tibble) manipulation</a></li>
<li><a href="#data-frame-tibble-reshaping" id="toc-data-frame-tibble-reshaping">Data frame (tibble) reshaping</a></li>
</ul></li>
</ul>
<!--bookdown:toc2:end-->
      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">STA 444/5 - Introductory Data Science using R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<!--bookdown:toc:end-->
<!--bookdown:body:start-->
<div id="preface" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">Preface<a href="#preface" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This book is intended for use during the STA 444/445 courses at Northern Arizona University. The book is broken into two sections based on the related course material. The <em>STA 444</em> section covers basic introductory content for getting started with statistical programming in R. This course is intended for students of all backgrounds and pairs importantly with courses such as STA 570 (Statistical Methods I) and STA 471 (Regression Analysis). The first section covers details to allow students to work on basic statistical programming while developing simple PDF documents using R-Markdown. This can both improve the students ability to digest complex statistical topics while also providing them a method for distributing their work in high-quality PDF formats.</p>
<p>The second section entitled <em>STA 445</em> dives deeper into issues that commonly arise in many data wrangling situations. The section is intended for more advanced students over the secondary 10-week period as a follow-up to STA 444. The chapters within cover a variety of more complex details related to Data Scene and Statistical Methodology. The intention of STA 445 is to support the BS Data Science program at Northern Arizona University, but provides a tangible enough workload to be applicable to many students looking to advanced their Data Science knowledge within R.</p>
<div id="other-resources" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Other Resources<a href="#other-resources" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are a great number of very good online and physical resources for learning R. Hadley Wickham is the creator of many of the foundational packages we’ll use in this course and he has worked on a number of wonderful teaching resources:</p>
<ul>
<li><p>Hadley Wickham and Garrett Grolemund’s free online book <a href="https://r4ds.had.co.nz">R for Data Science</a>.
This is a wonderful introduction to the <code>tidyverse</code> and is free. If there is any book I’d recommend buying, this would be it. Many of the topics my book covers are perhaps better covered in Hadley and Garrett’s book. For people brand new to R, <em>R for Data Science</em> probably has the wrong presentation order.</p></li>
<li><p>Hadley Wickham and Jenny Bryan have a whole book on <a href="https://r-pkgs.org">R packages</a> to effectively manage large projects.</p></li>
<li><p>Finally Hadley Wickham also has a book about <a href="https://adv-r.hadley.nz">Advanced R programming</a> and is quite helpful in understanding deeper issues relating to Object Oriented programming in R, Environments, Namespaces, and function evaluation.</p></li>
</ul>
<p>There are a number of other resources out there that quite good as well:</p>
<ul>
<li><p>Michael Freeman’s book <a href="https://www.amazon.com/Programming-Skills-Data-Science-Addison-Wesley/dp/0135133106">Programming Skills for Data Science</a>.
This book covers much of what we’ll do in this class and is quite readable.</p></li>
<li><p>Roger Peng also has an online book <a href="https://bookdown.org/rdpeng/rprogdatascience/">R programming for Data Science</a>
introducing R.</p></li>
</ul>
</div>
<div id="source-and-error-reports" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Source and Error Reports<a href="#source-and-error-reports" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The source documents for this book live on GitHub at
<a href="https://github.com/BuscagliaR/STA_444_v2/">https://github.com/BuscagliaR/STA_444_v2/</a>.
There you can can make bug reports or clone the GitHub repository, and submit fixes via pull requests. I welcome feedback and suggestions for improvement. The most likely way to get fixes introduced quickly is to email me directly at <a href="mailto:robert.buscaglia@nau.edu" class="email">robert.buscaglia@nau.edu</a>.</p>
</div>
<div id="acknowledgments" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Acknowledgments<a href="#acknowledgments" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>A very large thanks to Dr. Derek Sonderegger for developing the first version of this textbook that has been widely used within the Department of Mathematics and Statistics at Northern Arizona University. I hope to continue to expand upon this easy-to-use and informative textbook that is an excellent first source for many undergraduate and graduate students interested in furthering their Statistical and Data Science skills.</p>
<!--chapter:end:index.Rmd-->
</div>
</div>
<div id="part-sta-444" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART*) STA 444<a href="#part-sta-444" class="anchor-section" aria-label="Anchor link to header"></a></h1>
</div>
<div id="familiarization" class="section level1 hasAnchor" number="1">
<h1 class="hasAnchor"><span class="header-section-number">1</span> Familiarization<a href="#familiarization" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Throughout this textbook, we will include links to a variety of video lectures developed by the original author Dr. Derek Sonderegger. The video lectures add useful additional details to the content of this textbook. At this time, the video lectures have not been updated but may be changed in future updates.</p>
<p>The video lecture for this chapter can be found here: <a href="https://youtu.be/7_kK4QdoA4k">Video Lecture</a></p>
<p>R is a open-source program that is commonly used in statistics and machine learning. It runs on almost every platform and is completely free and is available at <a href="www.r-project.org">www.r-project.org</a>. Most cutting-edge statistical research is first available on R.</p>
<p>The basic editor that comes with R works fairly well, but but it is <em>strongly</em> recommended that you run R through the program RStudio which is available at <a href="http://www.rstudio.org">rstudio.com</a>. This is a completely free Integrated Development Environment that works on Macs, Windows and a couple of flavors of Linux. It simplifies a bunch of more annoying aspects of the standard R GUI and supports useful things like tab completion.</p>
<p>R is a script based language, and there isn’t a point-and-click interface for data wrangling and statistical modeling. While initially painful, writing scripts leaves a clear and reproducible description of exactly what steps were performed. This is a critical aspect of sharing your methods and results with other students, colleagues, and the world at-large.</p>
<div id="a-basic-script" class="section level2 hasAnchor" number="1.1">
<h2 class="hasAnchor"><span class="header-section-number">1.1</span> A Basic Script<a href="#a-basic-script" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The simplest form for developing and executing code is a script file. A script file can be loaded within R studio by selecting <code>File -&gt; New File -&gt; R Script</code>. It is encouraged to develop and run code within a script file first, before placing code into an RMD file. A script file only executes R code, such as that of an R-chunk discussed below. However, the script file does not compile any of the other items an Rmarkdown file will use, and thus is a safe and easy way to check if your statistical code is working. If you are getting errors when compiling an Rmarkdown file, ensure that all of your statistical code is properly working first by executing within a basic script file. This can help you decide if the error is coming from Markdown (latex, etc…) or if you have a flaw in your solution.</p>
</div>
<div id="working-within-an-rmarkdown-file" class="section level2 hasAnchor" number="1.2">
<h2 class="hasAnchor"><span class="header-section-number">1.2</span> Working within an Rmarkdown File<a href="#working-within-an-rmarkdown-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The first step in any new analysis or project is to create a new Rmarkdown file. This can be done by selecting the <code>File -&gt; New File -&gt; R Markdown...</code> drop down option and a menu will appear asking you for the document title, author, and preferred output type. In order to create a PDF, you’ll need to have LaTeX installed, but the HTML output nearly always works and I’ve had good luck with the MS Word output as well. All university computers have software prepared for compiling latex documentation. A section has been added to the end of this textbook to help setup personal computers with a lightweight package known as <code>tinytex</code> for compiling PDF documents.</p>
<p>R-Markdown (RMD) is an implementation of the Markdown syntax that makes it extremely easy to write documents and give instructions for how to do typesetting, introduce graphics, display code, and write mathematical expressions. The syntax available to embed R commands directly into the document always for transparent and easy to follow statistical programming. Perhaps the easiest way to understand the syntax is to look at the <a href="http://rmarkdown.rstudio.com">RMarkdown website</a> or the <code>Help -&gt; Rmarkdown Quick Reference</code> drop down link in RStudio.</p>
<p><img src="images/RStudio_NewRmarkdown_File.gif" /></p>
<p>Once you’ve created a new Rmarkdown file, you’ll be presented with four different panes that you can interact with.</p>
<table>
<colgroup>
<col width="14%" />
<col width="12%" />
<col width="73%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Pane</th>
<th align="left">Location</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Editor</td>
<td align="left">Top Left</td>
<td>Where you edit the script. This is where you should write most all of your R code. You should write your code, then execute it from this pane. Because nobody writes code correctly the first time, you’ll inevitably make some change, and then execute the code again. This will be repeated until the code finally does what you want.</td>
</tr>
<tr class="even">
<td align="left">Console</td>
<td align="left">Bottom Left</td>
<td>You can execute code directly in this pane, but the code you write won’t be saved. I recommend only writing stuff here if you don’t want to keep it. I only type commands in the console when using R as a calculator and I don’t want to refer to the result ever again.</td>
</tr>
<tr class="odd">
<td align="left">Environment</td>
<td align="left">Top Right</td>
<td>This displays the current objects that are available to you. I typically keep the <code>data.frame</code> I’m working with opened here so that I can see the column names.</td>
</tr>
<tr class="even">
<td align="left">Miscellaneous</td>
<td align="left">Bottom Right</td>
<td>This pane gives access to the help files, the files in your current working directory, and your plots (if you have it set up to show here.)</td>
</tr>
</tbody>
</table>
<p><img src="images/RStudio_Pane_Descriptions.gif" /></p>
<p>Whenever you create a new Rmarkdown document, it is populated with code and comments that attempts to teach new users how to work with Rmarkdown. Critically there are two types of regions:</p>
<table>
<colgroup>
<col width="28%" />
<col width="71%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Region Type</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Commentary</td>
<td align="left">These are the areas with a white background. You can write nearly anything here and in your final document it will be copied over. I typically use these spaces to write commentary and interpretation of my data analysis project.</td>
</tr>
<tr class="even">
<td align="center">Code Chunk</td>
<td align="left">These are the grey areas. This is where your R code will go. When knitting the document, each code chunk will be run sequentially and the code in each chunk must run.</td>
</tr>
</tbody>
</table>
<p>In an R Markdown (RMD) document, R code is clearly separated from the regular text using three backticks along with an instruction indicating that it’s R code to be evaluated. You can easily insert a new R code chunk using the shortcut <code>Ctrl+Alt+I</code> on Windows or <code>Cmd+Option+I</code> on Mac, or by clicking the green insert button at the top of the RMD editor. You can also manually type the chunk delimiters. There are many <a href="https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf">chunk options</a> available. The final output of an RMD document can be rendered in various formats, including HTML, PDF, or MS Word.</p>
<p>This entire book is created using R Markdown. To view the RMD file for any chapter, simply click the <code>view source</code> icon at the top of the online notes. This allows you to see the source code, which is especially useful if you want to copy and paste code into your own work, such as the exercises provided at the end of each chapter.</p>
<p>While writing an RMD file, each of the code chunks can be executed in a couple of different ways.</p>
<ol style="list-style-type: decimal">
<li>Press the green arrow at the top of the code chunk to run the entire chunk.</li>
<li>The run button has several options for running different amounts of code.</li>
<li>There are keyboard shortcuts, on Windows use <code>Ctrl+Enter</code>, on Mac use <code>Cmd+Return</code>.</li>
</ol>
<p>Finally, we want to produce a nice output document that combines the code, output, and commentary. To do this, you’ll <strong>knit</strong> the document which causes all of the R code to be run in a new R session, and then weave together the output into your document. This can be done using the knit button at the top of the Editor Window. Be mindful that the RMD file is a stand-alone document that must have all components necessary for the file to run. Anything that was loaded into local memory will not be seen when compiling the RMD file. For instance, if you need a particular data set available for the code to run, this must be coded into the RMD file, and not just loaded into local memory. These types of issues will become more familiar as you work through the examples and exercises available in this textbook.</p>
<p>When I was a graduate student, I had to tediously copy and paste tables of output from the R console and figures I had made into my Microsoft Word document. Far too often I would realize I had made a small mistake in part (b) of a problem and would have to go back, correct my mistake, and then redo all the laborious copying. I often wished that I could write both the code for my statistical analysis and the long discussion about the interpretation all in the same document so that I could just re-run the analysis with a click of a button and all the tables and figures would be updated by magic. That is what RMD does.</p>
</div>
<div id="r-as-a-simple-calculator" class="section level2 hasAnchor" number="1.3">
<h2 class="hasAnchor"><span class="header-section-number">1.3</span> R as a simple calculator<a href="#r-as-a-simple-calculator" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Assuming that you have started R on whatever platform you like, you can use R as a simple calculator. In either your Rmarkdown file code chunk, an R script, or by running it within the console. Try running the following simple calculation in all three of the methods mentioned above:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># Some simple addition</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="dv">2</span><span class="sc">+</span><span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<p>In this fashion you can use R as a very capable calculator.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="dv">6</span><span class="sc">*</span><span class="dv">8</span></span></code></pre></div>
<pre><code>## [1] 48</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="dv">4</span><span class="sc">^</span><span class="dv">3</span></span></code></pre></div>
<pre><code>## [1] 64</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">exp</span>(<span class="dv">1</span>)   <span class="co"># exp() is the exponential function</span></span></code></pre></div>
<pre><code>## [1] 2.718282</code></pre>
<p>R has most constants and common mathematical functions you could ever want. Functions such as <code>sin()</code>, <code>cos()</code>, are available, as are the exponential and log functions <code>exp()</code>, <code>log()</code>. The absolute value is given by <code>abs()</code>, and <code>round()</code> will round a value to the nearest integer while <code>floor()</code> and <code>ceiling()</code> will always round down or up as desired.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>pi     <span class="co"># the constant 3.14159265...</span></span></code></pre></div>
<pre><code>## [1] 3.141593</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">sin</span>(<span class="dv">0</span>)</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">5</span>) <span class="co"># unless you specify the base, R will assume base e</span></span></code></pre></div>
<pre><code>## [1] 1.609438</code></pre>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">5</span>, <span class="at">base=</span><span class="dv">10</span>)  <span class="co"># base 10</span></span></code></pre></div>
<pre><code>## [1] 0.69897</code></pre>
<p>Whenever I call a function, there will be some arguments that are mandatory, and some that are optional and the arguments are separated by a comma. In the above statements the function <code>log()</code> requires at least one argument, the number in which you want to log. However, the base argument is optional. If you do not specify what base to use, R will use a default value. You can see that R will default to using base <span class="math inline">\(e\)</span> by looking at the help page by typing <code>help(log)</code> or <code>?log</code> at the command prompt.</p>
<p>Arguments can be specified via the order in which they are passed or by naming the arguments. So for the <code>log()</code> function which has arguments <code>log(x, base=exp(1))</code>. If I specify which arguments are which using the named values, then order doesn’t matter.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># Demonstrating order does not matter if you specify</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="co"># which argument is which</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="fu">log</span>(<span class="at">x=</span><span class="dv">5</span>, <span class="at">base=</span><span class="dv">10</span>)   </span></code></pre></div>
<pre><code>## [1] 0.69897</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="fu">log</span>(<span class="at">base=</span><span class="dv">10</span>, <span class="at">x=</span><span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 0.69897</code></pre>
<p>But if we don’t specify which argument is which, R will decide that <code>x</code> is the first argument, and <code>base</code> is the second. It is suggested to use the order of options as presented in the help files. This will improve efficiency as you become more complex with your statistical programming. Notice when you use these shortcuts though, you will get different answers based on the order you enter values with provided specific option names!</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a><span class="co"># If not specified, R will assume the second value is the base...</span></span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">5</span>, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## [1] 0.69897</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">10</span>, <span class="dv">5</span>)</span></code></pre></div>
<pre><code>## [1] 1.430677</code></pre>
<p>When arguments are specified, notice the use of syntax such as <code>name=value</code> notation and a student might be tempted to use the <code>&lt;-</code> notation here. Don’t do that as the <code>name=value</code> notation is making an association mapping and not a permanent assignment. Assignment of objects is one of the core ideas of using R, and is discussed more in the section below.</p>
<div id="assignment" class="section level3 hasAnchor" number="1.3.1">
<h3 class="hasAnchor"><span class="header-section-number">1.3.1</span> Assignment<a href="#assignment" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to be able to assign a value to a variable to be able to use it later. R does this by using an arrow <code>&lt;-</code> or an equal sign <code>=</code>. While R supports either, for readability, I suggest people pick one assignment operator and stick with it. I personally prefer to use the arrow and this is the most basic assignment possible. There are different levels of assignment available in R, so stick to the <code>&lt;-</code> arrow as you get started. When assigning a new object, be mindful that variable names cannot start with a number, may not include spaces, and are case sensitive. Let’s practice by assigning the variable <code>tau</code> and <code>my.test.var</code> below, and using them in further computations.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>tau <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>pi       <span class="co"># create two variables</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>my.test.var <span class="ot">=</span> <span class="dv">5</span>   <span class="co"># notice they show up in &#39;Environment&#39; tab in RStudio!</span></span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>tau</span></code></pre></div>
<pre><code>## [1] 6.283185</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>my.test.var</span></code></pre></div>
<pre><code>## [1] 5</code></pre>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>tau <span class="sc">*</span> my.test.var</span></code></pre></div>
<pre><code>## [1] 31.41593</code></pre>
<p>As your analysis gets more complicated, you’ll want to assign the results to a variable so that you can access the results later. <em>If you don’t assign the result to a variable, you have no way of accessing the result.</em> Using object-oriented programming within R will have tremendous consequences when developing more complex code.</p>
<p>When a variable has been assigned, you will see it in the environment tab in the environment pane. This area is extremely convenient to remind ourselves how we spelled a variable name and capitalization. R is case sensitive so <code>X</code> and <code>x</code> are two different variable names, so being consistent in your capitalization scheme is quite helpful. The complexity of assignment names in R is also very useful, so that you can write out complex names for easy to recall functionality. A common theme is known as camel casing, where you write a longer name with each separate word capitalized, such as <code>MyFirstFunction</code>.</p>
</div>
<div id="vectors" class="section level3 hasAnchor" number="1.3.2">
<h3 class="hasAnchor"><span class="header-section-number">1.3.2</span> Vectors<a href="#vectors" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While single values are useful, it is very important that we are able to make groups of values. The most fundamental aggregation of values is called a <em>vector</em>. In R, we will require vectors to always be of the same type (e.g. all integers or all character strings). To create a vector, we just need to use the <em>concatenation</em> function <code>c()</code>. This is a very common theme in R, so get used to using concatenation early! Below we create two vectors through concatenation, the first a vector of strings, the second a vector of constants.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>)</span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>x</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;A&quot; &quot;B&quot; &quot;C&quot;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>( <span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">8</span>, <span class="dv">10</span> )</span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>y</span></code></pre></div>
<pre><code>## [1]  4  3  8 10</code></pre>
<p>It is very common to have to make sequences of integers, and R has a shortcut to do this. The notation <code>A:B</code> will produce a vector of constants starting with the value A and incrementally increasing by one until the value B. Here we quickly produce a vector of constants from 2 to 6.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="dv">2</span><span class="sc">:</span><span class="dv">6</span></span></code></pre></div>
<pre><code>## [1] 2 3 4 5 6</code></pre>
<p>Nearly every function in R behaves correctly when being given a vector of values. This is called vectorization and can make computations within R very fast if properly used. Vectorization is much faster than writing for-loops (learned in later chapters), so practice with vectors is very important. Notice we can feed a vector of constants to the log function, and it will calculate the log of each element of the vector.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">2</span>)   <span class="co"># Make a vector with four values</span></span>
<span id="cb37-2"><a href="#cb37-2" tabindex="-1"></a><span class="fu">log</span>(x)            <span class="co"># calculate the log of each value.</span></span></code></pre></div>
<pre><code>## [1] 1.3862944 1.9459101 1.6094379 0.6931472</code></pre>
</div>
</div>
<div id="packages" class="section level2 hasAnchor" number="1.4">
<h2 class="hasAnchor"><span class="header-section-number">1.4</span> Packages<a href="#packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the greatest strengths about R is that so many people have developed add-on packages with additional functionality. For example, plant community ecologists have a large number of multivariate methods that are useful but were not part of R. So Jari Oksanen got together with some other folks and put together a package of functions that they found useful. The result is the package <code>vegan</code>.</p>
<p>To download and install the package from the Comprehensive R Archive Network (CRAN), you just need to ask RStudio it to install it. This can be done via the menu <code>Tools</code> -&gt; <code>Install Packages...</code>. You can also use a console or script and the R function <code>install.packages()</code>. With either method, you just need to provide the name of the package and RStudio will download and install the package on your computer.</p>
<p>Many major analysis types are available via downloaded packages as well as problem sets from various books (e.g. <code>Sleuth3</code> or <code>faraway</code>) and can be easily downloaded and installed from CRAN.</p>
<p>Once a package is downloaded and installed on your computer, it is available and does not need to be installed again. However, it is not loaded into your current R session by default. The reason it isn’t loaded is that there are thousands of packages, some of which are quite large and only used occasionally. So to improve overall performance only a few packages are loaded by default. When you want to use a specific package you must explicitly load them. You only need to load them once per session/script. After installing the <code>vegan</code> package, we can load the package into our environment using the <code>library()</code> function.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a><span class="fu">library</span>(vegan)   <span class="co"># load the vegan library</span></span></code></pre></div>
<p>For a similar performance reason, many packages do not automatically load their data sets unless explicitly asked. Therefore when loading data sets from a package, you might need to do a <em>two-step</em> process of loading the package and then loading the data set.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a><span class="fu">library</span>(faraway)       <span class="co"># load the package into memory</span></span></code></pre></div>
<pre><code>## 
## Attaching package: &#39;faraway&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:lattice&#39;:
## 
##     melanoma</code></pre>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;butterfat&quot;</span>)      <span class="co"># load the data set into memory</span></span></code></pre></div>
<p>If you don’t need to load any functions from a package and you just want the data, you can do it in one step.</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;butterfat&#39;</span>, <span class="at">package=</span><span class="st">&#39;faraway&#39;</span>)   <span class="co"># just load the data set, not anything else</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a><span class="fu">head</span>(butterfat)                        <span class="co"># print out the first 6 rows of the data</span></span></code></pre></div>
<pre><code>##   Butterfat    Breed    Age
## 1      3.74 Ayrshire Mature
## 2      4.01 Ayrshire  2year
## 3      3.77 Ayrshire Mature
## 4      3.78 Ayrshire  2year
## 5      4.10 Ayrshire Mature
## 6      4.06 Ayrshire  2year</code></pre>
<p>Similarly, if I am not using many functions from a package, I might choose call the functions using the notation <code>package::function()</code>. This is particularly important when two packages both have functions with the same name and it gets confusing which function you want to use. For example the packages <code>mosaic</code> and <code>dplyr</code> both have a function <code>tally</code>. When such a conflict occurs, you may notice R provides a warning that certain functions have been <em>masked</em>. This is a not an error, instead a message informing you that more than one function of the same name is present. These messages were purposefully left in the sections above so you can observe their behavior. For example, if the <code>dplyr</code> package is loaded but you want to use the <code>mosaic::tally()</code> function, you can introduce the following syntax so that R knows which version of <code>tally()</code> you want to execute.</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>mosaic<span class="sc">::</span><span class="fu">tally</span>( <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>) )</span></code></pre></div>
<pre><code>## Registered S3 method overwritten by &#39;mosaic&#39;:
##   method                           from   
##   fortify.SpatialPolygonsDataFrame ggplot2</code></pre>
<pre><code>## X
## 0 1 2 
## 3 4 1</code></pre>
<p>Finally, many researchers and programmers host their packages on GitHub (or equivalent site) and those packages can easily downloaded using tools from the <code>devtools</code> package, which can be downloaded from CRAN. In later chapters of the STA 445 section, we will learn to host our own R packages through GitHub. These can then be installed directly from a github repository using the <code>install_github()</code> function. Below installs a demo package we will build in later Chapters. Remember, if you want to execute the code below, you’ll likely need to install the <code>devtools</code> package first!</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>devtools<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&#39;DrBuscaglia/F23DemoPackage&#39;</span>)</span></code></pre></div>
</div>
<div id="finding-help" class="section level2 hasAnchor" number="1.5">
<h2 class="hasAnchor"><span class="header-section-number">1.5</span> Finding Help<a href="#finding-help" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are many complicated details about R and nobody knows everything about how each individual package works. As a result, a robust collection of resources has been developed and you are undoubtedly not the first person to wonder how to do something.</p>
<div id="how-does-this-function-work" class="section level3 hasAnchor" number="1.5.1">
<h3 class="hasAnchor"><span class="header-section-number">1.5.1</span> How does this function work?<a href="#how-does-this-function-work" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If you know the function you need, but just don’t know how to use it, the built-in documentation is really quite good. Suppose I am interested in how the <code>rep</code> function works. We could access the <code>rep</code> help page by searching in the help window or from the console via <code>help(rep)</code>. The document that is displayed shows what arguments the function expects and what it will return. At the bottom of the help page is often a set of examples demonstrating different ways to use the function. As you get more proficient in R, these help files become quite handy, but initially they feel quite overwhelming.</p>
</div>
<div id="how-does-this-package-work" class="section level3 hasAnchor" number="1.5.2">
<h3 class="hasAnchor"><span class="header-section-number">1.5.2</span> How does this package work?<a href="#how-does-this-package-work" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>If a package author really wants their package to be used by a wide audience, they will provide a “vignette”. These are a set of notes that explain enough of how a package works to get a user able to utilize the package effectively. This documentation is targeted towards people the know some R, but deep technical knowledge is not expected. Whenever I encounter a new package that might be applicable to me, the first thing I do is see if it has a vignette, and if so, I start reading it. If a package doesn’t have a vignette, I’ll Google “R package XXXX” and that will lead to documentation on CRAN that gives a list of functions in the package.</p>
</div>
<div id="how-do-i-do-xxx" class="section level3 hasAnchor" number="1.5.3">
<h3 class="hasAnchor"><span class="header-section-number">1.5.3</span> How do I do XXX?<a href="#how-do-i-do-xxx" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often I find myself asking how to do something but I don’t know the function or package to use. In those cases, I will use the coding question and answer site <a href="http://stackoverflow.com">stackoverflow</a>. This is particularly effective and I encourage students to spend some time to understand the solutions presented instead of just copying working code. By digging into why a particular code chunk works, you’ll learn all sorts of neat tricks and you’ll find yourself utilizing the site less frequently.</p>
</div>
</div>
<div id="Exercises_Familiarization" class="section level2 hasAnchor" number="1.6">
<h2 class="hasAnchor"><span class="header-section-number">1.6</span> Exercises<a href="#Exercises_Familiarization" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Create an RMarkdown file that solves the following exercises.</p>
<ol style="list-style-type: decimal">
<li><p>Calculate <span class="math inline">\(\log\left(6.2\right)\)</span> first using base <span class="math inline">\(e\)</span> and second using base
<span class="math inline">\(10\)</span>. To figure out how to do different bases, it might be helpful to look at
the help page for the <code>log</code> function.</p></li>
<li><p>Calculate the square root of 2 and save the result as the variable named sqrt2.
Have R display the decimal value of sqrt2.
<em>Hint: use Google to find the square root function. Perhaps search on the</em>
<em>keywords “R square root function”.</em></p></li>
<li><p>This exercise walks you through installing a package with all the data sets used
in the textbook <em>The Statistical Sleuth</em>.</p>
<ol style="list-style-type: lower-alpha">
<li>Install the package <code>Sleuth3</code> on your computer using RStudio.</li>
<li>Load the package using the <code>library()</code> command.</li>
<li>Print out the data set <code>case0101</code>.</li>
</ol></li>
</ol>
<!--chapter:end:01_Familiarization.Rmd-->
</div>
</div>
<div id="data-frames" class="section level1 hasAnchor" number="2">
<h1 class="hasAnchor"><span class="header-section-number">2</span> Data Frames<a href="#data-frames" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a><span class="co"># It is good practice to load the packages important to the RMD file at the top of </span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a><span class="co"># the script. Extra syntax is provided here that suppresses the output of messages,</span></span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a><span class="co"># of which some packages have extraordinary long message outputs (such as tidyverse).</span></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="co"># For this chapter we might want to load some common packages: dplyr, ggplot2,</span></span>
<span id="cb50-5"><a href="#cb50-5" tabindex="-1"></a><span class="co"># forcats, readr, and stringr. Lets load the packages from the `tidyverse` suite, but</span></span>
<span id="cb50-6"><a href="#cb50-6" tabindex="-1"></a><span class="co"># suppress the tidyverse message output. In future chapters, I will only show the packages</span></span>
<span id="cb50-7"><a href="#cb50-7" tabindex="-1"></a><span class="co"># necessary for that chapter. You may hide this information in your own script/RMD files.</span></span>
<span id="cb50-8"><a href="#cb50-8" tabindex="-1"></a><span class="fu">suppressPackageStartupMessages</span>({</span>
<span id="cb50-9"><a href="#cb50-9" tabindex="-1"></a>  <span class="fu">library</span>(tidyverse, <span class="at">quietly =</span> <span class="cn">TRUE</span>)</span>
<span id="cb50-10"><a href="#cb50-10" tabindex="-1"></a>})</span></code></pre></div>
<p>Dr. Sonderegger’s Video Companion: <a href="https://youtu.be/4IzqPTuHycc">Video Lecture</a>.</p>
<div id="data-frames-1" class="section level2 hasAnchor" number="2.1">
<h2 class="hasAnchor"><span class="header-section-number">2.1</span> Data Frames<a href="#data-frames-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Data frames are the fundamental unit of data storage that casual users of R need to work with. Conceptually they are just like a single tab in a spreadsheet (e.g. Excel) file. There are multiple rows and columns and each column is of the same type of information (e.g. numerical values, dates, or character strings) and each row represents a single observation.</p>
<p>Because the columns have meaning and we generally give them column names, it is desirable to want to access an element by the name of the column as opposed to the column number. While writing formulas in large Excel spreadsheets I often
get annoyed trying to remember which column something was in and muttering “Was total biomass in column P or Q?” A system where I could just name the column <code>Total_Biomass</code> and then always refer to it that way, is much nicer to work with and I make fewer mistakes.</p>
<p>In this chapter we will briefly cover the minimal set of tools for working with data frames. First we discuss how to import data sets, both from packages and appropriately formatted Excel and .csv files. Finally we’ll see how to create a data frame “by hand” and to access columns and do simple manipulations.</p>
<p>In this chapter, we will focus on standard R data frame manipulations so that readers gain basic familiarity with non-tidyverse accessor methods. This is our first building block before moving to more advanced functionality. When in doubt, there are always base-R methods to a solution, but we will find that R pacakges can make our life much easier when used properly!</p>
</div>
<div id="introduction-to-importing-data" class="section level2 hasAnchor" number="2.2">
<h2 class="hasAnchor"><span class="header-section-number">2.2</span> Introduction to Importing Data<a href="#introduction-to-importing-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="from-a-package" class="section level3 hasAnchor" number="2.2.1">
<h3 class="hasAnchor"><span class="header-section-number">2.2.1</span> From a Package<a href="#from-a-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For many students, they will be assigned homework that utilizes data sets that are stored in a package. To access those, we would need to first install the package if we haven’t already. Recall to do that, we can use the Rstudio menu bar <code>Tools -&gt; Install Packages...</code> mouse action or the <code>install_packages()</code> function.</p>
<p>Because we might have thousands of packages installed on a computer, and those packages might all have data sets associated with them, they aren’t loaded into memory by default. Instead we have to go through a two-step process of making sure that the package is installed on the computer, and then load the desired data set into the local session of R. Once the package is installed, we can load the data into our session via the following command:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;alfalfa&#39;</span>, <span class="at">package=</span><span class="st">&#39;faraway&#39;</span>)   <span class="co"># load the data set &#39;alfalfa&#39; from the package &#39;faraway&#39;</span></span></code></pre></div>
<p>Because R tries to avoid loading datasets until it is sure that you need them,the object <code>alfalfa</code> isn’t initially loaded as a <code>data.frame</code> but rather as a “promise” that it eventually will be loaded whenever you first use it. So lets first access it by viewing it.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a><span class="fu">View</span>(alfalfa)</span></code></pre></div>
<p>There are two ways to enter the view command. Either executing the <code>View()</code> function from the console, or clicking on either the white table or the object name in the <code>Environment</code> tab. It is encouraged to remove any <code>View()</code> functions from your final RMD files, as this will consistently open the data set you are trying to view. Instead, use <code>View()</code> to digest the data, then remove this from your RMD file to not have negative impacts on your final “knit” document.</p>
</div>
<div id="import-from-.csv-or-.xls-files" class="section level3 hasAnchor" number="2.2.2">
<h3 class="hasAnchor"><span class="header-section-number">2.2.2</span> Import from <code>.csv</code> or <code>.xls</code> files<a href="#import-from-.csv-or-.xls-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often times data is stored in a <strong>Comma Separated Values</strong> (CSV) file where the rows in the file represent the data frame rows, and the columns are separated by commas. The first row of the file is usually the column titles. Alternatively, the data might be stored in an Excel file and we just need to tell R where the file is and which worksheet tab to import.</p>
<p>The hardest part for people that are new to programming is giving the path to the data file. In this case, I recommend students use the data import wizard that RStudio includes which is accessed via <code>File -&gt; Import Dataset</code>. This will then give you a choice of file types to read from (.csv files are in the “Text” options). Once you have selected the file type to import, the user is presented with a file browser window where the desired file should be located. Once the file is chosen, we can import the file.</p>
<p>Critically, we should notice that the import wizard generates R code that does the actual import. We MUST copy that code into our Rmarkdown file or else the import won’t happen when we try to knit the Rmarkdown into an output document because knitting always occurs in a completely fresh R session. So only use the import wizard to generate the import code! The code generated by the import wizard ends with a <code>View()</code> command and I typically remove that as it can
interfere with the knitting process. The code that I’ll paste into my RMarkdown file typically looks like this (be mindful you have no way to run code that requires access to my dropbox, this is just an example):</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a><span class="fu">library</span>(readxl)</span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>Melioid_IgG <span class="ot">&lt;-</span> <span class="fu">read_excel</span>(<span class="st">&quot;~/Dropbox/NAU/MAGPIX serology/Data/Melioid_IgG.xlsx&quot;</span>)</span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a><span class="co"># View(Melioid_IgG)</span></span></code></pre></div>
<p>A nice property of working within an RMD file is that the working directory is set to be the same folder of which the RMD file is present. This can make loading data smoother and is another important reason for using projects and R-markdown files to improve efficiency. You may also wish to try loading the data using simple commands such as <code>read.csv()</code> within your script/RMd file, by placing the data file adjacent to your .rmd file. These types of ideas will be covered in more advanced sections later in the textbook, for now feel free to use the import wizard mentioned above, just be sure to copy the code into your RMD file!</p>
</div>
</div>
<div id="data-types" class="section level2 hasAnchor" number="2.3">
<h2 class="hasAnchor"><span class="header-section-number">2.3</span> Data Types<a href="#data-types" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Data frames are required that each column have the same type. That is to say, if a column is numeric, you can’t just change one value to a character string. Below are the most common data types that are used within R.</p>
<ol style="list-style-type: decimal">
<li><p>Integers - These are the integer numbers <span class="math inline">\(\left(\dots,-2,-1,0,1,2,\dots\right)\)</span>. To convert a numeric value to an integer you may use the function <code>as.integer()</code>.</p></li>
<li><p>Numeric - These could be any number (whole number or decimal). To convert another type to numeric you may use the function <code>as.numeric()</code>.</p></li>
<li><p>Strings - These are a collection of characters (example: Storing a student’s last name). To convert another type to a string, use <code>as.character()</code>.</p></li>
<li><p>Factors - These are strings that can only values from a finite set. For example we might wish to store a variable that records home department of a student. Since the department can only come from a finite set of possibilities, I would use a factor. Factors are categorical variables, but R calls them factors instead of categorical variable. A vector of values of another type can always be converted to a factor using the <code>as.factor()</code> command. For converting numeric values to factors, I will often use the function <code>cut()</code>.</p></li>
<li><p>Logicals - This is a special case of a factor that can only take on the values <code>TRUE</code> and <code>FALSE</code>, sometimes referred to as Boolean. (Be careful to always capitalize <code>TRUE</code> and <code>FALSE</code>. Because R is case-sensitive, TRUE is not the same as true.) Using the function <code>as.logical()</code> you can convert numeric values to <code>TRUE</code> and <code>FALSE</code> where <code>0</code> is <code>FALSE</code> and anything else is <code>TRUE</code>.</p></li>
</ol>
<p>Depending on the command, R will coerce your data from one type to another if necessary, but it is a good habit to do the coercion yourself. If a variable is a number, R will automatically assume that it is continuous numerical variable. If it is a character string, then R will assume it is a factor when doing any statistical analysis. It is always good practice to double check that R is using the data as intended, as this can have major consequences in statistical modeling, where a continuous variable behaves much differently than a categorical variable. Such cases can arise if a value like <code>1</code> is actually denoting a group and not a numerical value.</p>
<p>Most of these types are familiar to beginning R users except for factors. Factors are how R keeps track of categorical variables. R does this in a two step pattern. First it figures out how many categories there are and remembers which category an observation belongs. Second, it keeps a vector of character strings that correspond to the names of each of the categories.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># A character vector</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;B&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;A&#39;</span>,<span class="st">&#39;C&#39;</span>)</span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>y</span></code></pre></div>
<pre><code>## [1] &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;C&quot;</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a><span class="co"># convert the vector of characters into a vector of factors </span></span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>z <span class="ot">&lt;-</span> <span class="fu">factor</span>(y)</span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a><span class="fu">str</span>(z)</span></code></pre></div>
<pre><code>##  Factor w/ 3 levels &quot;A&quot;,&quot;B&quot;,&quot;C&quot;: 2 2 1 1 3</code></pre>
<p>Notice that the vector <code>z</code> is actually the combination of group assignment vector <code>2,2,1,1,3</code> and the group names vector <code>“A”,”B”,”C”</code>. So we could convert z to a vector of numerics or to a vector of character strings.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="fu">as.numeric</span>(z)</span></code></pre></div>
<pre><code>## [1] 2 2 1 1 3</code></pre>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="fu">as.character</span>(z)</span></code></pre></div>
<pre><code>## [1] &quot;B&quot; &quot;B&quot; &quot;A&quot; &quot;A&quot; &quot;C&quot;</code></pre>
<p>Often we need to know what possible groups there are, and this is done using the <code>levels()</code> command.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a><span class="fu">levels</span>(z)</span></code></pre></div>
<pre><code>## [1] &quot;A&quot; &quot;B&quot; &quot;C&quot;</code></pre>
<p>Notice that the order of the group names was done alphabetically, which we did not chose. This ordering of the levels has implications when we do an analysis or make a plot and R will always display information about the factor levels using this order. It would be nice to be able to change the order. Also it would be really nice to give more descriptive names to the groups rather than just the group code in my raw data. Useful functions for controlling the order and labels of the factor can be found in the <code>forcats</code> package. We will learn how to manipulate factors more in a later chapter, but it is never too early to play around!</p>
</div>
<div id="basic-manipulation" class="section level2 hasAnchor" number="2.4">
<h2 class="hasAnchor"><span class="header-section-number">2.4</span> Basic Manipulation<a href="#basic-manipulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Occasionally I’ll need to create a small data frame “by hand” to facilitate creating graphs in <code>ggplot2</code>. In this final section, we’ll cover creating a data frame and doing simple manipulations using the base R commands and syntax. To create a data frame, we have to squish together a bunch of column vectors. The command <code>data.frame()</code> does exactly that. The example below provides the names, ages, and heights (in inches) of the Sonderegger family (the Buscaglia family is too small of an example to be useful).</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>family <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>  <span class="at">Names =</span> <span class="fu">c</span>(<span class="st">&#39;Derek&#39;</span>, <span class="st">&#39;Aubrey&#39;</span>, <span class="st">&#39;Elise&#39;</span>, <span class="st">&#39;Casey&#39;</span>),</span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>  <span class="at">Age   =</span> <span class="fu">c</span>(<span class="dv">42</span>, <span class="dv">39</span>, <span class="dv">6</span>, <span class="dv">3</span>),</span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>  <span class="at">Height.in =</span> <span class="fu">c</span>(<span class="dv">64</span>, <span class="dv">66</span>, <span class="dv">43</span>, <span class="dv">39</span>) </span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>)</span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a>family</span></code></pre></div>
<pre><code>##    Names Age Height.in
## 1  Derek  42        64
## 2 Aubrey  39        66
## 3  Elise   6        43
## 4  Casey   3        39</code></pre>
<p>To access a particular column, we could use the <code>$</code> operator. We could then do something like calculate the mean or standard deviation. Here are some examples of using the <code>$</code> operator for statistical computation.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a>family<span class="sc">$</span>Age</span></code></pre></div>
<pre><code>## [1] 42 39  6  3</code></pre>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="fu">mean</span>( family<span class="sc">$</span>Age )</span></code></pre></div>
<pre><code>## [1] 22.5</code></pre>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="fu">sd</span>( family<span class="sc">$</span>Age )</span></code></pre></div>
<pre><code>## [1] 20.85665</code></pre>
<p>As an alternative to the “$” operator, we could use the <code>[row, column]</code> notation. The first dimension of an array is always the row, the second always the column, and this can go up further (3rd, 4th, 5th) dimension if working with more complex data. Always remember - first entry is the row, second entry the column! To select a particular row or column, we can select them by either name or location.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a>family[ , <span class="st">&#39;Age&#39;</span>] <span class="co"># all the rows of the Age column (exact the Age column)</span></span></code></pre></div>
<pre><code>## [1] 42 39  6  3</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a>family[ <span class="dv">2</span>, <span class="st">&#39;Age&#39;</span>] <span class="co"># age of person in row 2</span></span></code></pre></div>
<pre><code>## [1] 39</code></pre>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a>family[ , <span class="dv">2</span>] <span class="co"># extrac the second column, same as using &#39;Age&#39;</span></span></code></pre></div>
<pre><code>## [1] 42 39  6  3</code></pre>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a>family[ <span class="dv">1</span>, ] <span class="co"># extract the first row</span></span></code></pre></div>
<pre><code>##   Names Age Height.in
## 1 Derek  42        64</code></pre>
<p>Next we could calculate everyone’s height in centimeters by multiplying the heights by <code>2.54</code> and saving the result in column appropriately named. Notice the syntax provided below actually creates a new column!</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a>family<span class="sc">$</span>Height.cm <span class="ot">&lt;-</span> family<span class="sc">$</span>Height.in <span class="sc">*</span> <span class="fl">2.54</span>  <span class="co"># calculate the heights and save them!</span></span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>family                                       <span class="co"># view our result!</span></span></code></pre></div>
<pre><code>##    Names Age Height.in Height.cm
## 1  Derek  42        64    162.56
## 2 Aubrey  39        66    167.64
## 3  Elise   6        43    109.22
## 4  Casey   3        39     99.06</code></pre>
</div>
<div id="Exercises_IntroDataFrames" class="section level2 hasAnchor" number="2.5">
<h2 class="hasAnchor"><span class="header-section-number">2.5</span> Exercises<a href="#Exercises_IntroDataFrames" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Create a data frame “by hand” with the names, ages, and heights of your own family. <em>If this feels excessively personal, feel free to make up people or include pets.</em></p></li>
<li><p>Calculate the mean age among your family.</p></li>
<li><p>We can load data directly from the internet. Dr. Sonderegger has many spreadsheet files hosted on GitHub. Lets use this file <a href="https://raw.githubusercontent.com/dereksonderegger/570L/master/data-raw/Example_1.csv" class="uri">https://raw.githubusercontent.com/dereksonderegger/570L/master/data-raw/Example_1.csv</a>. Because the <code>readr</code> package doesn’t care whether a file is on your local computer or on the Internet, we’ll use this file by downloading it directly through our R code.</p>
<ol style="list-style-type: lower-alpha">
<li>Start the import wizard using: <code>File -&gt; Import Dataset -&gt; From Text (readr) ...</code> and input the above web URL. Click the update button near the top to cause the wizard to preview the result.</li>
<li>Save the generated code to your Rmarkdown file and show the first few rows using the <code>head()</code> command.</li>
</ol></li>
</ol>
<!--chapter:end:02_Intro_to_DataFrames.Rmd-->
</div>
</div>
<div id="graphing" class="section level1 hasAnchor" number="3">
<h1 class="hasAnchor"><span class="header-section-number">3</span> Graphing<a href="#graphing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter you will learn more about the <code>ggplot2</code> package, part of the <code>tidyverse</code> suite of packages.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>Dr. Sonderegger’s Video Companion: <a href="https://youtu.be/eJT9EdiWlEg">Video Lecture</a>.</p>
<div id="introduction-to-ggplot2-graphics" class="section level2 hasAnchor" number="3.1">
<h2 class="hasAnchor"><span class="header-section-number">3.1</span> Introduction to ggplot2 graphics<a href="#introduction-to-ggplot2-graphics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are three major “systems” of making graphs in R. The basic plotting commands in R are quite effective but the commands do not have a way of being combined in easy ways, often requiring loops or functions to produce complex multi-layered graphs. Lattice graphics (which the <code>mosaic</code> package uses) makes it possible to create some quite complicated graphs but it is very difficult to make non-standard graphs. The package we will focus on here, <code>ggplot2</code>, tries to not anticipate what the user wants to do, but rather provide the mechanisms for pulling together different graphical concepts and the user gets to decide which elements to combine. This will allow a user to create almost any graphic of interest.</p>
<p>To make the most of <code>ggplot2</code> it is important to wrap your mind around “The Grammar of Graphics”. Briefly, the act of building a graph can be broken down into three steps.</p>
<ol style="list-style-type: decimal">
<li><p>Define what data set we are using.</p></li>
<li><p>What is the major relationship we wish to examine?</p></li>
<li><p>In what way should we present that relationship? These relationships can be presented in multiple ways, and the process of creating a good graph relies on building layers upon layers of information.</p></li>
</ol>
<p>For example, after preparing a proper data frame for the analysis, we may want to present a linear model result including both the data, best-fit line, and other statistical intervals (confidence, prediction). We might start with printing the raw data as a scatter graphic. We can then add additional layers such as an overlay of the regression line over the top of the scatter. We can then continue this thinking for as many layers as we want, producing a final graphic that conveys important information clearly.</p>
<p>By producing code that outputs these graphics, we can then introduce small changes as needed to improve them as our needs grow. Although the first version of the graph may take some time to prepare, once code is stored in a script, it becomes easy to update and improve the graphic over time. This is an essential part of work that is done in research laboratories or for publications, and being able to easily handle the updates needed to a graphic can not only save time, but help you prepare the exact graphic needed to tell your story!</p>
<p>Next, it should be noted that <code>ggplot2</code> is designed to act on data frames. It is actually hard to just draw three data points and for simple graphs it might be easier to use the base graphing system in R. However for any real data analysis project, the data will already be in a data frame and this is not an annoyance. Throughout this textbook, you will become very comfortable with formatting data into data frames.</p>
<p>These notes are sufficient for creating simple graphs using <code>ggplot2</code>, but are not intended to be exhaustive. There are many places online to get help with <code>ggplot2</code>. One very nice resource is the website, <a href="http://www.cookbook-r.com/Graphs/">http://www.cookbook-r.com/Graphs/</a>, which gives much of the information available in the textbook <code>R Graphics Cookbook</code> which I highly recommend. Second is just using Google to solve your problems and see what you can find on websites such as StackExchange. As you become more advanced in your knowledge of preparing figures through <code>ggplot2</code>, generative AI sources such as chatGPT can help produce the syntax outline that you can then manipulate to create the exact graphic of interest.</p>
<p>One way that <code>ggplot2</code> makes it easy to form very complicated graphs is that it provides a large number of basic building blocks that, when stacked upon each other, can produce extremely complicated graphs. A full list is available at <a href="https://ggplot2.tidyverse.org/reference/">https://ggplot2.tidyverse.org/reference/</a>. The following list gives some idea of different building blocks that are most commonly used. These different geometries offer different ways to display the relationship between variables and can be combined in many interesting ways. We will explore several geometries in this chapter and future graphing chapters.</p>
<table>
<colgroup>
<col width="19%" />
<col width="55%" />
<col width="25%" />
</colgroup>
<thead>
<tr class="header">
<th>Geom</th>
<th>Description</th>
<th>Required Aesthetics</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>geom_histogram</code></td>
<td>A histogram</td>
<td><code>x</code></td>
</tr>
<tr class="even">
<td><code>geom_bar</code></td>
<td>A barplot (y is number of rows)</td>
<td><code>x</code></td>
</tr>
<tr class="odd">
<td><code>geom_col</code></td>
<td>A barplot (y is given by a column)</td>
<td><code>x, y</code></td>
</tr>
<tr class="even">
<td><code>geom_density</code></td>
<td>A density plot of data. (smoothed histogram)</td>
<td><code>x</code></td>
</tr>
<tr class="odd">
<td><code>geom_boxplot</code></td>
<td>Boxplots</td>
<td><code>x, y</code></td>
</tr>
<tr class="even">
<td><code>geom_line</code></td>
<td>Draw a line (after sorting x-values)</td>
<td><code>x, y</code></td>
</tr>
<tr class="odd">
<td><code>geom_path</code></td>
<td>Draw a line (without sorting x-values)</td>
<td><code>x, y</code></td>
</tr>
<tr class="even">
<td><code>geom_point</code></td>
<td>Draw points (for a scatterplot)</td>
<td><code>x, y</code></td>
</tr>
<tr class="odd">
<td><code>geom_smooth</code></td>
<td>Add a ribbon that summarizes a scatterplot</td>
<td><code>x, y</code></td>
</tr>
<tr class="even">
<td><code>geom_ribbon</code></td>
<td>Enclose a region, and color the interior</td>
<td><code>ymin, ymax</code></td>
</tr>
<tr class="odd">
<td><code>geom_errorbar</code></td>
<td>Error bars</td>
<td><code>ymin, ymax</code></td>
</tr>
<tr class="even">
<td><code>geom_text</code></td>
<td>Add text to a graph (with box)</td>
<td><code>x, y, label</code></td>
</tr>
<tr class="odd">
<td><code>geom_label</code></td>
<td>Add text to a graph (without box)</td>
<td><code>x, y, label</code></td>
</tr>
<tr class="even">
<td><code>geom_tile</code></td>
<td>Create Heat map</td>
<td><code>x, y, fill</code></td>
</tr>
</tbody>
</table>
<p>A graph can be built up layer by layer, where:</p>
<ul>
<li>Each layer corresponds to a geometry (<code>geom</code>), each of which requires a data set and a mapping between an aesthetic (<code>aes</code>) and a column of the data set.
<ul>
<li>If you don’t specify the data or aesthetic within a geometry, then the layer inherits everything defined in the primary <code>ggplot()</code> command.</li>
<li>You can have different data sets for each layer!</li>
</ul></li>
<li>Layers can be added with a <code>+</code>, or you can define two plots and add them together (second one over-writes anything that conflicts).</li>
</ul>
</div>
<div id="basic-graphs" class="section level2 hasAnchor" number="3.2">
<h2 class="hasAnchor"><span class="header-section-number">3.2</span> Basic Graphs<a href="#basic-graphs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="scatterplots" class="section level3 hasAnchor" number="3.2.1">
<h3 class="hasAnchor"><span class="header-section-number">3.2.1</span> Scatterplots<a href="#scatterplots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To start with, we’ll make a very simple scatterplot using the <code>iris</code> data set. The <code>iris</code> data set contains observations on three species of iris plants where we’ve measured the length and width of both the petals and sepals. We will make a scatterplot of <code>Sepal.Length</code> versus <code>Petal.Length</code>, which are two columns in the data set. First, lets recall how to load a data set into our local environment. We then show the structure (<code>str</code>) of the data set to understand its data types and get a clear listing of the variables present in the data frame</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a><span class="fu">data</span>(iris)  <span class="co"># load the iris data set that comes with R</span></span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a><span class="fu">str</span>(iris)   <span class="co"># what columns do we have to play with...</span></span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    150 obs. of  5 variables:
##  $ Sepal.Length: num  5.1 4.9 4.7 4.6 5 5.4 4.6 5 4.4 4.9 ...
##  $ Sepal.Width : num  3.5 3 3.2 3.1 3.6 3.9 3.4 3.4 2.9 3.1 ...
##  $ Petal.Length: num  1.4 1.4 1.3 1.5 1.4 1.7 1.4 1.5 1.4 1.5 ...
##  $ Petal.Width : num  0.2 0.2 0.2 0.2 0.2 0.4 0.3 0.2 0.2 0.1 ...
##  $ Species     : Factor w/ 3 levels &quot;setosa&quot;,&quot;versicolor&quot;,..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
<p>We then make our first graphic using a single line of ggplot2 syntax.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data=</span>iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length) ) <span class="sc">+</span>  </span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a>    <span class="fu">geom_point</span>(  ) </span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-33-1.png" width="672" /></p>
<ol style="list-style-type: decimal">
<li>All ggplot graphics start with the <code>ggplot()</code> command.</li>
<li>The data set we wish to use is specified using <code>data=iris</code>.</li>
<li>The relationship we want to explore is <code>x=Sepal.Length</code> and <code>y=Petal.Length</code>. This means the x-axis will be the Sepal Length and the y-axis will be the Petal Length. To use data directly from the initial data frame, we must always include this mapping within the <code>aes()</code> command.</li>
<li>The way we want to display this relationship is through graphing 1 point for every observation (scatter). Thus we map this information into the scatter graph geometry known as <code>geom_point()</code>.</li>
</ol>
<p>We can define other attributes that might reflect other aspects of the data. For example, we might want for the color of the data point to change dynamically based on the species of iris. We can update our graph by including a second aesthetic (<code>aes()</code>) within the <code>geom_point()</code> specifically. Below we add a color option based on the species of iris. Notice below that by coloring the graph by species, we gain significant new information regarding how differences between the iris species.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data=</span>iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length) ) <span class="sc">+</span>  </span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="fu">aes</span>(<span class="at">color=</span>Species) )</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-34-1.png" width="672" /></p>
<p>Let’s take a moment to think about the <code>aes()</code> command inside the previous section of code, which can be quite mysterious to new users. The way to think about the <code>aes()</code> is that it gives you a way to define relationships that are dependent on the data frame (here <code>data=iris</code>). In the previous graph, the x-value and y-value for each point was defined dynamically by the data, as was the color. If we just wanted all the data points to be colored blue and larger, then the following code would do that</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a><span class="fu">ggplot</span>( <span class="at">data=</span>iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length) ) <span class="sc">+</span>  </span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a>    <span class="fu">geom_point</span>( <span class="at">color=</span><span class="st">&#39;blue&#39;</span>, <span class="at">size=</span><span class="dv">4</span> )</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-35-1.png" width="672" /></p>
<p>The important part isn’t that color and size were defined in the <code>geom_point()</code> but that they were defined outside of an <code>aes()</code> function! Notice though by removing the dependence to the species, we have lost the ability to see how different each species behaves!</p>
<p>A few quick notes on the use of aesthetics:</p>
<ol style="list-style-type: decimal">
<li>Anything set inside an <code>aes()</code> command will be of the form <code>attribute=Column_Name</code> and will change based on the data. We must always use the <code>aes()</code> command to extract information from the data frame.</li>
<li>Anything set outside an <code>aes()</code> command will be in the form <code>attribute=value</code> and will be fixed. This is used for static information that doesn’t depend on the data frame.</li>
</ol>
</div>
<div id="box-plots" class="section level3 hasAnchor" number="3.2.2">
<h3 class="hasAnchor"><span class="header-section-number">3.2.2</span> Box Plots<a href="#box-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Boxplots are a common way to show a categorical variable on the x-axis and continuous on the y-axis. Lets evaluate the distribution of <code>Petal.Length</code> versus the <code>Species</code> of iris. The syntax works very similar to above, but now we will map the information into a boxplot geometry.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Species, <span class="at">y=</span>Petal.Length)) <span class="sc">+</span></span>
<span id="cb88-2"><a href="#cb88-2" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()  </span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>The boxes show the <span class="math inline">\(25^{th}\)</span>, <span class="math inline">\(50^{th}\)</span>, and <span class="math inline">\(75^{th}\)</span> percentile and the lines coming off the box extend to the smallest and largest non-outlier observation. Boxplots are important for viewing information across different categorical groupings, and are often related to ANOVA-type statistical analyses. We will explore boxplots further in later chapters, as they are very common in all fields!</p>
</div>
</div>
<div id="faceting" class="section level2 hasAnchor" number="3.3">
<h2 class="hasAnchor"><span class="header-section-number">3.3</span> Faceting<a href="#faceting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The goal with faceting is to make many panels of graphics where each panel represents the same relationship between variables, but something changes between each panel. For example using the <code>iris</code> data set we could look at the relationship between <code>Sepal.Length</code> and <code>Petal.Length</code> again, but now instead of placing all information with color on a single graph, we can make one panel per species. Faceting allows for the introduction of even more variables within a single graph!</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb89-2"><a href="#cb89-2" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length)) <span class="sc">+</span></span>
<span id="cb89-3"><a href="#cb89-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb89-4"><a href="#cb89-4" tabindex="-1"></a>  <span class="co"># facet_grid( cols = vars(Species) ) # using vars() to dictate columns</span></span>
<span id="cb89-5"><a href="#cb89-5" tabindex="-1"></a>  <span class="co"># facet_grid( rows = vars(Species) ) #using vars() to dictate rows</span></span>
<span id="cb89-6"><a href="#cb89-6" tabindex="-1"></a>  <span class="fu">facet_grid</span>( . <span class="sc">~</span> Species ) <span class="co"># Formula notation y ~ x</span></span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>The line <code>facet_grid( formula )</code> tells <code>ggplot2</code> to make panels, and the formula tells how to orient the panels. In R, formulas are always interpreted in the order <code>y ~ x</code>. Because I want the species to change as we go across a page (horizontally, commonly called the x-direction on a 2D-graph), but don’t have anything I want to change vertically (y-direction) we use <code>. ~ Species</code> to represent that. If we had wanted three graphs stacked vertically instead, we could use <code>Species ~ .</code>. Additional code is provided that allows the user to more specifically define columns (<code>cols = vars(Species)</code>). This syntax provides more control over the x- and y-direction, but the formula notation should become more familiar with experience in R.</p>
<p>For a second example, we look at a data set that examines the amount a waiter was tipped by 244 different parties. Covariates that were measured include the day of the week, size of the party, total amount of the bill, amount tipped, whether there were smokers in the group and the gender of the person paying the bill. Like always, lets load the data and explore the variables a bit, here we output the first 6 rows using the <code>head()</code> function.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a><span class="fu">data</span>(tips, <span class="at">package=</span><span class="st">&#39;reshape&#39;</span>)</span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a><span class="fu">head</span>(tips)</span></code></pre></div>
<pre><code>##   total_bill  tip    sex smoker day   time size
## 1      16.99 1.01 Female     No Sun Dinner    2
## 2      10.34 1.66   Male     No Sun Dinner    3
## 3      21.01 3.50   Male     No Sun Dinner    3
## 4      23.68 3.31   Male     No Sun Dinner    2
## 5      24.59 3.61 Female     No Sun Dinner    4
## 6      25.29 4.71   Male     No Sun Dinner    4</code></pre>
<p>It is easy to look at the relationship between the size of the bill and the percent tipped. We use the flexible syntax of R to calculate the percent tip directly within the <code>aes()</code> command. We then plot the total bill against the tip/total_bill ratio (or percent tipped).</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a><span class="fu">ggplot</span>(tips, <span class="fu">aes</span>(<span class="at">x =</span> total_bill, <span class="at">y =</span> tip <span class="sc">/</span> total_bill )) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>Next we investigate if there is a difference in tipping percent based on gender or day of the week by plotting this relationship for each combination of gender and day.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="fu">ggplot</span>(tips, <span class="fu">aes</span>(<span class="at">x =</span> total_bill, <span class="at">y =</span> tip <span class="sc">/</span> total_bill, <span class="at">color=</span>time )) <span class="sc">+</span></span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a>  <span class="fu">geom_point</span>( ) <span class="sc">+</span></span>
<span id="cb93-3"><a href="#cb93-3" tabindex="-1"></a>  <span class="co"># facet_grid( day ~ sex )  # changing orientation emphasizes certain comparisons!</span></span>
<span id="cb93-4"><a href="#cb93-4" tabindex="-1"></a>  <span class="fu">facet_grid</span>( sex <span class="sc">~</span> day )</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>It doesn’t seem there is much difference between the genders, but we would like to investigate the relation to day of week further. Sometimes we want multiple rows and columns of the facets, but there is only one categorical variable with many levels. Rather than making the graph grow very long either horizontally or vertically, we use <code>facet_wrap()</code> which takes a one-sided formula and will wrap in both the x- and y-directions automatically.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a><span class="fu">ggplot</span>(tips, <span class="fu">aes</span>(<span class="at">x =</span> total_bill, <span class="at">y =</span> tip <span class="sc">/</span> total_bill )) <span class="sc">+</span></span>
<span id="cb94-2"><a href="#cb94-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb94-3"><a href="#cb94-3" tabindex="-1"></a>  <span class="co"># facet_grid( . ~ day)  # Four graphs in a row, Too Squished left/right!</span></span>
<span id="cb94-4"><a href="#cb94-4" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( <span class="sc">~</span> day )   <span class="co"># spread graphs out both left/right and up/down.</span></span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-41-1.png" width="672" /></p>
<p>Finally we can allow the x and y scales to vary between the panels by setting “free”, “free_x”, or “free_y”. In the following code, the y-axis scale changes for each day in the data set.</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a><span class="fu">ggplot</span>(tips, <span class="fu">aes</span>(<span class="at">x =</span> total_bill, <span class="at">y =</span> tip <span class="sc">/</span> total_bill )) <span class="sc">+</span></span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a>  <span class="fu">facet_wrap</span>( . <span class="sc">~</span> day, <span class="at">scales=</span><span class="st">&quot;free_y&quot;</span> )</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-42-1.png" width="672" /></p>
</div>
<div id="annotation" class="section level2 hasAnchor" number="3.4">
<h2 class="hasAnchor"><span class="header-section-number">3.4</span> Annotation<a href="#annotation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="axis-labels-and-titles" class="section level3 hasAnchor" number="3.4.1">
<h3 class="hasAnchor"><span class="header-section-number">3.4.1</span> Axis Labels and Titles<a href="#axis-labels-and-titles" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To make a graph more understandable, it is necessary to tweak the axis labels and add a main title and such. Lets return to the iris data set example, but improve the quality of our scatter graph. The code below introduces lots of new syntax that changes the written text in many areas of the graph. You could either call the <code>labs()</code> command repeatedly with each label, or you could provide multiple arguments to just one <code>labs()</code> call. For readability, the lines have been separated in the code below.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="co"># Assign the graph to the object &#39;p&#39; allowing us to add more later.</span></span>
<span id="cb96-2"><a href="#cb96-2" tabindex="-1"></a>P <span class="ot">&lt;-</span></span>
<span id="cb96-3"><a href="#cb96-3" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="at">data=</span>iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length, <span class="at">color=</span>Species) ) <span class="sc">+</span>  </span>
<span id="cb96-4"><a href="#cb96-4" tabindex="-1"></a>  <span class="fu">geom_point</span>( ) <span class="sc">+</span></span>
<span id="cb96-5"><a href="#cb96-5" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">title=</span><span class="st">&#39;Sepal Length vs Petal Length&#39;</span> ) <span class="sc">+</span></span>
<span id="cb96-6"><a href="#cb96-6" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">x=</span><span class="st">&quot;Sepal Length (cm)&quot;</span>, <span class="at">y=</span><span class="st">&quot;Petal Length (cm)&quot;</span> ) <span class="sc">+</span></span>
<span id="cb96-7"><a href="#cb96-7" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">color=</span><span class="st">&quot;Species Name&quot;</span>)  <span class="sc">+</span> </span>
<span id="cb96-8"><a href="#cb96-8" tabindex="-1"></a>  <span class="fu">labs</span>( <span class="at">caption =</span> <span class="st">&quot;Iris data from Edgar Anderson (1935)&quot;</span> )</span>
<span id="cb96-9"><a href="#cb96-9" tabindex="-1"></a></span>
<span id="cb96-10"><a href="#cb96-10" tabindex="-1"></a><span class="co"># Print out the plot</span></span>
<span id="cb96-11"><a href="#cb96-11" tabindex="-1"></a>P</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-43-1.png" width="672" /></p>
</div>
<div id="text-labels" class="section level3 hasAnchor" number="3.4.2">
<h3 class="hasAnchor"><span class="header-section-number">3.4.2</span> Text Labels<a href="#text-labels" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One way to improve the clarity of a graph is to remove the legend and, instead, label the points directly on the graph. For example, we could instead have the species names near the cloud of data points for the species.</p>
<p>Usually our annotations aren’t stored in the data frame that contains our data of interest. So we need to either create a new (usually small) data frame that contains all the information needed to create the annotation or we need to provide all necessary information within the syntax. It is encouraged to make additional, smaller data frames, that store auxiliary information such as annotations as these can be easily changed without interfering with the syntax making the graphs. Either way, we need to specify the <code>x</code> and <code>y</code> coordinates, and the <code>label</code> to be printed, as well as any other attribute that is set in the global <code>aes()</code> command. That means if <code>color</code> has been set globally, the annotation layer also needs to address the <code>color</code> attribute.</p>
<div id="using-a-data-frame" class="section level4 hasAnchor" number="3.4.2.1">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.1</span> Using a data frame<a href="#using-a-data-frame" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To do this in ggplot, we need to make a data frame that has the columns <code>Sepal.Length</code> and <code>Petal.Length</code> so that we can specify where each label should go, as well as the label that we want to print. This is essentially indicating where on the x-y graph the text should be located. Also, because color is matched to the <code>Species</code> column, this small data set should also have a the <code>Species</code> column.</p>
<p>This step always requires a bit of fussing with the graph because the text size and location should be chosen based on the size of the output graphic and if I rescale the image it often looks awkward. Typically I leave this step until the figure is being prepared for final publication.</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a><span class="co"># create another data frame that has the text labels I want to add to the graph.</span></span>
<span id="cb97-2"><a href="#cb97-2" tabindex="-1"></a>annotation.data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb97-3"><a href="#cb97-3" tabindex="-1"></a>  <span class="at">Sepal.Length =</span> <span class="fu">c</span>(<span class="fl">4.5</span>,  <span class="fl">6.5</span>,  <span class="fl">7.0</span>),  <span class="co"># Figured out the label location by eye.</span></span>
<span id="cb97-4"><a href="#cb97-4" tabindex="-1"></a>  <span class="at">Petal.Length =</span> <span class="fu">c</span>(<span class="fl">2.25</span>, <span class="fl">3.75</span>, <span class="fl">6.5</span>),  <span class="co"># If I rescale the graph, I would redo this step.</span></span>
<span id="cb97-5"><a href="#cb97-5" tabindex="-1"></a>  <span class="at">Species =</span> <span class="fu">c</span>(<span class="st">&#39;setosa&#39;</span>, <span class="st">&#39;versicolor&#39;</span>, <span class="st">&#39;virginica&#39;</span>),</span>
<span id="cb97-6"><a href="#cb97-6" tabindex="-1"></a>  <span class="at">Text =</span> <span class="fu">c</span>(<span class="st">&#39;SETOSA&#39;</span>, <span class="st">&#39;VERSICOLOR&#39;</span>, <span class="st">&#39;VIRGINICA&#39;</span>)</span>
<span id="cb97-7"><a href="#cb97-7" tabindex="-1"></a>)</span>
<span id="cb97-8"><a href="#cb97-8" tabindex="-1"></a></span>
<span id="cb97-9"><a href="#cb97-9" tabindex="-1"></a><span class="co"># Use the previous plot I created, along with the </span></span>
<span id="cb97-10"><a href="#cb97-10" tabindex="-1"></a><span class="co"># aes() options already defined.</span></span>
<span id="cb97-11"><a href="#cb97-11" tabindex="-1"></a>P <span class="sc">+</span></span>
<span id="cb97-12"><a href="#cb97-12" tabindex="-1"></a>  <span class="fu">geom_text</span>( <span class="at">data=</span>annotation.data, <span class="fu">aes</span>(<span class="at">label=</span>Text), <span class="at">size=</span><span class="fl">2.5</span>) <span class="sc">+</span>   <span class="co"># write the labels</span></span>
<span id="cb97-13"><a href="#cb97-13" tabindex="-1"></a>  <span class="fu">theme</span>( <span class="at">legend.position =</span> <span class="st">&#39;none&#39;</span> )                               <span class="co"># remove the legend</span></span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-44-1.png" width="672" /></p>
</div>
<div id="setting-attributes-in-line" class="section level4 hasAnchor" number="3.4.2.2">
<h4 class="hasAnchor"><span class="header-section-number">3.4.2.2</span> Setting attributes in-line<a href="#setting-attributes-in-line" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Instead of creating a new data frame, we could just add a new layer and set all of the graph attributes manually. To do this, we have to have one layer for each text we want to add to the graph. The <code>annotate()</code> function takes a geometry layer type, here we use the <code>geom_text</code> layer to place the information on the graph. We must provide all necessary inputs for each line, but by doing this work manual we can avoid the annoyance of building a data frame for the label information.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>P <span class="sc">+</span></span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>, <span class="at">x=</span><span class="fl">4.5</span>, <span class="at">y=</span><span class="fl">2.25</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">color=</span><span class="st">&#39;#F8766D&#39;</span>, <span class="at">label=</span><span class="st">&#39;SETOSA&#39;</span>     ) <span class="sc">+</span></span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>, <span class="at">x=</span><span class="fl">6.5</span>, <span class="at">y=</span><span class="fl">3.75</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">color=</span><span class="st">&#39;#00BA38&#39;</span>, <span class="at">label=</span><span class="st">&#39;VERSICOLOR&#39;</span> ) <span class="sc">+</span></span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;text&#39;</span>, <span class="at">x=</span><span class="fl">7.0</span>, <span class="at">y=</span><span class="fl">6.50</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">color=</span><span class="st">&#39;#619CFF&#39;</span>, <span class="at">label=</span><span class="st">&#39;VIRGINICA&#39;</span>  ) <span class="sc">+</span></span>
<span id="cb98-5"><a href="#cb98-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;none&#39;</span>)</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-45-1.png" width="672" /></p>
<p>Finally there is a <code>geom_label</code> layer that draws a nice box around what you want to print.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a>P <span class="sc">+</span></span>
<span id="cb99-2"><a href="#cb99-2" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;label&#39;</span>, <span class="at">x=</span><span class="fl">4.5</span>, <span class="at">y=</span><span class="fl">2.25</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">color=</span><span class="st">&#39;#F8766D&#39;</span>, <span class="at">label=</span><span class="st">&#39;SETOSA&#39;</span>     ) <span class="sc">+</span></span>
<span id="cb99-3"><a href="#cb99-3" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;label&#39;</span>, <span class="at">x=</span><span class="fl">6.5</span>, <span class="at">y=</span><span class="fl">3.50</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">color=</span><span class="st">&#39;#00BA38&#39;</span>, <span class="at">label=</span><span class="st">&#39;VERSICOLOR&#39;</span> ) <span class="sc">+</span></span>
<span id="cb99-4"><a href="#cb99-4" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;label&#39;</span>, <span class="at">x=</span><span class="fl">7.0</span>, <span class="at">y=</span><span class="fl">6.75</span>, <span class="at">size=</span><span class="dv">6</span>, <span class="at">color=</span><span class="st">&#39;#619CFF&#39;</span>, <span class="at">label=</span><span class="st">&#39;VIRGINICA&#39;</span>  ) <span class="sc">+</span></span>
<span id="cb99-5"><a href="#cb99-5" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&#39;none&#39;</span>)</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-46-1.png" width="672" /></p>
<p>My recommendation is to just set the <code>x</code>, <code>y</code>, and <code>label</code> attributes manually inside an <code>annotate()</code> call if you have one or two annotations to print on the graph. If you have many annotations to print, then create a data frame that contains all of the required information and use <code>data=</code> argument.</p>
</div>
</div>
</div>
<div id="Exercises_IntroGraphing" class="section level2 hasAnchor" number="3.5">
<h2 class="hasAnchor"><span class="header-section-number">3.5</span> Exercises<a href="#Exercises_IntroGraphing" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Examine the data set <code>trees</code>, which should already be pre-loaded. Look at the help file using <code>?trees</code> for more information about this data set. We wish to build a scatter plot that compares the height and girth of these cherry trees to the volume of lumber that was produced.</p>
<ol style="list-style-type: lower-alpha">
<li>Create a graph using <code>ggplot2</code> with Height on the x-axis, Volume on the y-axis, and Girth as the either the size of the data point or the color of the data point. Which do you think is a more intuitive representation?</li>
<li>Add appropriate labels for the main title and the x and y axes.</li>
<li>The R-squared value for a regression through these points is 0.36 and the p-value for the statistical significance of height is 0.00038. Add text labels “R-squared = 0.36” and “p-value = 0.0004” somewhere on the graph.</li>
</ol></li>
<li><p>Consider the following small data set that represents the number of times per day my wife played “Ring around the Rosy” with my daughter relative to the number of days since she has learned this game. The column <code>yhat</code> represents the best fitting line through the data, and <code>lwr</code> and <code>upr</code> represent a 95% confidence interval for the predicted value on that day. <em>Because these questions ask you to produce several graphs and evaluate which is better and why, please include each graph and response with each sub-question.</em></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a>Rosy <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a>  <span class="at">times =</span> <span class="fu">c</span>(<span class="dv">15</span>, <span class="dv">11</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">5</span>, <span class="dv">2</span>, <span class="dv">3</span>),</span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a>  <span class="at">day   =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>,</span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a>  <span class="at">yhat  =</span> <span class="fu">c</span>(<span class="fl">14.36</span>, <span class="fl">12.29</span>, <span class="fl">10.21</span>, <span class="fl">8.14</span>, <span class="fl">6.07</span>, <span class="fl">4.00</span>,  <span class="fl">1.93</span>),</span>
<span id="cb100-5"><a href="#cb100-5" tabindex="-1"></a>  <span class="at">lwr   =</span> <span class="fu">c</span>( <span class="fl">9.54</span>,  <span class="fl">8.5</span>,   <span class="fl">7.22</span>, <span class="fl">5.47</span>, <span class="fl">3.08</span>, <span class="fl">0.22</span>, <span class="sc">-</span><span class="fl">2.89</span>),</span>
<span id="cb100-6"><a href="#cb100-6" tabindex="-1"></a>  <span class="at">upr   =</span> <span class="fu">c</span>(<span class="fl">19.18</span>, <span class="fl">16.07</span>, <span class="fl">13.2</span>, <span class="fl">10.82</span>, <span class="fl">9.06</span>, <span class="fl">7.78</span>,  <span class="fl">6.75</span>))</span></code></pre></div>
<ol style="list-style-type: lower-alpha">
<li><p>Using <code>ggplot()</code> and <code>geom_point()</code>, create a scatterplot with <code>day</code> along the x-axis and <code>times</code> along the y-axis.</p></li>
<li><p>Add a line to the graph where the x-values are the <code>day</code> values but now the y-values are the predicted values which we’ve called <code>yhat</code>. Notice that you have to set the aesthetic <code>y=times</code> for the points and <code>y=yhat</code> for the line. Because each <code>geom_</code> will accept an <code>aes()</code> command, you can specify the <code>y</code> attribute to be different for different layers of the graph.</p></li>
<li><p>Add a ribbon that represents the confidence region of the regression line. The <code>geom_ribbon()</code> function requires an <code>x</code>, <code>ymin</code>, and <code>ymax</code> columns to be defined. For examples of using <code>geom_ribbon()</code> see the online documentation: <a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html">https://ggplot2.tidyverse.org/reference/geom_ribbon.html</a>.</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" tabindex="-1"></a><span class="fu">ggplot</span>(Rosy, <span class="fu">aes</span>(<span class="at">x=</span>day)) <span class="sc">+</span></span>
<span id="cb101-2"><a href="#cb101-2" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>times)) <span class="sc">+</span></span>
<span id="cb101-3"><a href="#cb101-3" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>(<span class="at">y=</span>yhat)) <span class="sc">+</span></span>
<span id="cb101-4"><a href="#cb101-4" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>( <span class="fu">aes</span>(<span class="at">ymin=</span>lwr, <span class="at">ymax=</span>upr), <span class="at">fill=</span><span class="st">&#39;salmon&#39;</span>)</span></code></pre></div></li>
<li><p>What happened when you added the ribbon? Did some points get hidden? If so, why?</p></li>
<li><p>Reorder the statements that created the graph so that the ribbon is on the bottom and the data points are on top and the regression line is visible.</p></li>
<li><p>The color of the ribbon fill is ugly. Use Google to find a list of named colors available to <code>ggplot2</code>. For example, I googled “ggplot2 named colors” and found the following link: <a href="http://sape.inf.usi.ch/quick-reference/ggplot2/colour">http://sape.inf.usi.ch/quick-reference/ggplot2/colour</a>. Choose a color for the fill that is pleasing to you.</p></li>
<li><p>Add labels for the x-axis and y-axis that are appropriate along with a main title.</p></li>
</ol></li>
<li><p>We’ll next make some density plots that relate several factors towards the birth weight of a child. <em>Because these questions ask you to produce several graphs and evaluate which is better and why, please include each graph and response with each sub-question.</em></p>
<ol style="list-style-type: lower-alpha">
<li><p>The <code>MASS</code> package contains a data set called <code>birthwt</code> which contains information about 189 babies and their mothers. In particular there are columns for the mother’s race and smoking status during the pregnancy. Load the <code>birthwt</code> by either using the <code>data()</code> command or loading the <code>MASS</code> library.</p></li>
<li><p>Read the help file for the data set using <code>MASS::birthwt</code>. The covariates <code>race</code> and <code>smoke</code> are not stored in a user friendly manner. For example, smoking status is labeled using a 0 or a 1. Because it is not obvious which should represent that the mother smoked, we’ll add better labels to the <code>race</code> and <code>smoke</code> variables. For more information about dealing with factors and their levels, see the <code>Factors</code> chapter in these notes.</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;birthwt&#39;</span>, <span class="at">package=</span><span class="st">&#39;MASS&#39;</span>)</span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a>birthwt <span class="ot">&lt;-</span> birthwt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a>  <span class="at">race  =</span> <span class="fu">factor</span>(race,  <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;White&#39;</span>,<span class="st">&#39;Black&#39;</span>,<span class="st">&#39;Other&#39;</span>)),</span>
<span id="cb102-5"><a href="#cb102-5" tabindex="-1"></a>  <span class="at">smoke =</span> <span class="fu">factor</span>(smoke, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;No Smoke&#39;</span>, <span class="st">&#39;Smoke&#39;</span>)))</span></code></pre></div></li>
<li><p>Graph a histogram of the birth weights <code>bwt</code> using <code>ggplot(birthwt, aes(x=bwt)) + geom_histogram()</code>.</p></li>
<li><p>Make separate graphs that denote whether a mother smoked during pregnancy by appending <code>+ facet_grid()</code> command to your original graphing command.</p></li>
<li><p>Perhaps race matters in relation to smoking. Make our grid of graphs vary with smoking status changing vertically, and race changing horizontally (that is the formula in <code>facet_grid()</code> should have smoking be the y variable and race as the x).</p></li>
<li><p>Remove <code>race</code> from the facet grid, (so go back to the graph you had in part d). I’d like to next add an estimated density line to the graphs, but to do that, I need to first change the y-axis to be density (instead of counts), which we do by using <code>aes(y=..density..)</code> in the <code>ggplot()</code> aesthetics command.</p></li>
<li><p>Next we can add the estimated smooth density using the <code>geom_density()</code> command.</p></li>
<li><p>To really make this look nice, lets change the fill color of the histograms to be something less dark, lets use <code>fill='cornsilk'</code> and <code>color='grey60'</code>. To play with different colors that have names, check out the following: <a href="https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/">https://www.datanovia.com/en/blog/awesome-list-of-657-r-color-names/</a>.</p></li>
<li><p>Change the order in which the histogram and the density line are added to the plot. Does it matter and which do you prefer?</p></li>
<li><p>Finally consider if you should have the histograms side-by-side or one on top of the other (i.e. <code>. ~ smoke</code> or <code>smoke ~ .</code>). Which do you think better displays the decrease in mean birth weight and why?</p></li>
</ol></li>
<li><p>Load the data set <code>ChickWeight</code>, which comes pre-loaded in R, and get the background on the data set by reading the manual page <code>?ChickWeight</code>. <em>Because these questions ask you to produce several graphs and evaluate which is better and why, please include each graph and response with each sub-question.</em></p>
<ol style="list-style-type: lower-alpha">
<li><p>Produce a separate scatter plot of weight vs age for each chick. Use color to distinguish the four different <code>Diet</code> treatments. <em>Note, this question should produce 50 separate graphs! If the graphs are too squished you should consider how to arrange them so that the graphs wrap to a new row of graphs in the resulting output figure. The results are messy!</em></p></li>
<li><p>We could examine these data by producing a scatter plot for each diet. Most of the code below is readable, but if we don’t add the <code>group</code> aesthetic the lines would not connect the dots for each Chick but would instead connect the dots across different chicks.</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a><span class="fu">data</span>(ChickWeight)</span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a><span class="fu">ggplot</span>(ChickWeight, <span class="fu">aes</span>(<span class="at">x=</span>Time, <span class="at">y=</span>weight, <span class="at">group=</span>Chick )) <span class="sc">+</span></span>
<span id="cb103-3"><a href="#cb103-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4" tabindex="-1"></a>  <span class="fu">facet_grid</span>( <span class="sc">~</span> Diet) </span></code></pre></div>
<p><em>Notice in the code chunk above, if you copied from the online source code you must remove the <code>eval=FALSE</code> in the chunk header. This option allows the code to be displayed, but it won’t be run and no plot will be produced in your final output document. So when you ask, why don’t I see a plot?, I’ll reminder you of this statement!</em></p></li>
</ol></li>
</ol>
<!--chapter:end:03_Intro_to_Graphing.Rmd-->
</div>
</div>
<div id="data-wrangling" class="section level1 hasAnchor" number="4">
<h1 class="hasAnchor"><span class="header-section-number">4</span> Data Wrangling<a href="#data-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter we will focus on the introduction of the <code>dplyr</code> package, part of the <code>tidyverse</code> suite of packages.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>Dr. Sonderegger’s Video Companion: <a href="https://youtu.be/99Q7AunWuk0">Video Lecture</a>.</p>
<div id="introduction-to-dplyr-and-the-pipe-command" class="section level2 hasAnchor" number="4.1">
<h2 class="hasAnchor"><span class="header-section-number">4.1</span> Introduction to dplyr and the pipe command<a href="#introduction-to-dplyr-and-the-pipe-command" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Many of the tools to manipulate data frames in R were written without a consistent syntax and are difficult use together. To remedy this, Hadley Wickham (the writer of <code>ggplot2</code>) introduced a package called <code>plyr</code> which was quite useful. As with many projects, his first version was good, but not great, and he introduced an improved version that works exclusively with data frames called <code>dplyr</code> which we will investigate. The package <code>dplyr</code> strives to provide a convenient and consistent set of functions to handle the most common data frame manipulations, and a mechanism for chaining these operations together to perform complex tasks.</p>
<p>Dr. Wickham has put together a very nice introduction to the package that explains in more detail how the various pieces work and I encourage you to review it at some point: <a href="https://cran.rstudio.com/web/packages/dplyr/vignettes/dplyr.html">dplyr introduction</a>.</p>
<p>One of the aspects about the <code>data.frame</code> object is that R does some simplification for you, but it does not do it in a consistent manner. Somewhat obnoxiously, character strings are always converted to factors and sub-setting might return a <code>data.frame</code> or a <code>vector</code> or a <code>scalar</code>. This is fine at the command line, but can be problematic when programming. Furthermore, many operations are pretty slow using <code>data.frame</code>. To get around this, Dr. Wickham introduced a modified version of the <code>data.frame</code> called a <code>tibble</code>. A <code>tibble</code> is a <code>data.frame</code> but
with a few extra bits. For now we can ignore the differences, outside knowing that each handles computations and data types in slightly different ways.</p>
<p>This chapter will see us begin the use of the pipe <code>%&gt;%</code> command. The pipe command <code>%&gt;%</code> allows for very readable code with easy work flow. As of R 4.1.0, a native pipe command <code>|&gt;</code> was introduced with similar functionality, but this book will continue to focus on the pipes introduced in the <code>magrittr</code> package and widely used with <code>tidyverse</code> functions. The idea is that the <code>%&gt;%</code> operator works by translating the command <code>a %&gt;% f()</code> to the expression <code>f(a)</code>. This operator works on any function. The beauty of the pipe operator comes when you have a suite of functions that takes input arguments of the same type as their output.</p>
<p>For example, if we wanted to start with <code>x</code>, and first apply function <code>f()</code>, then <code>g()</code>, and then <code>h()</code>, the usual R command would be <code>h(g(f(x)))</code> which is hard to read and interpret because you have to start reading at the <em>innermost</em> set of parentheses. Using the pipe command <code>%&gt;%</code>, this sequence of operations becomes <code>x %&gt;% f() %&gt;% g() %&gt;% h()</code>. This type of thinking, sometimes referred to as <code>tidyverse</code> philosophy, allows one to think more directly about what you want to execute next, rather than having to continually nest your expressions. This makes work, such as exploratory data analysis, feel much more comfortable and intuitive than traditional nested programming. Piping will become more intuitive the more it is used, and has a variety of operations to simplify work.</p>
<table>
<thead>
<tr class="header">
<th align="center">Written</th>
<th align="center">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><code>a %&gt;% f(b)</code></td>
<td align="center"><code>f(a,b)</code></td>
</tr>
<tr class="even">
<td align="center"><code>b %&gt;% f(a, .)</code></td>
<td align="center"><code>f(a, b)</code></td>
</tr>
<tr class="odd">
<td align="center"><code>x %&gt;% f() %&gt;% g()</code></td>
<td align="center"><code>g( f(x) )</code></td>
</tr>
</tbody>
</table>
<p>Here is an example of how piping might expand our thinking of a calculation.</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="co"># This code is not particularly readable because</span></span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a><span class="co"># the order of summing vs taking absolute value isn&#39;t </span></span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a><span class="co"># completely obvious. </span></span>
<span id="cb105-4"><a href="#cb105-4" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">abs</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>)))</span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a><span class="co"># But using the pipe function, it is blatantly obvious</span></span>
<span id="cb107-2"><a href="#cb107-2" tabindex="-1"></a><span class="co"># what order the operations are done in. </span></span>
<span id="cb107-3"><a href="#cb107-3" tabindex="-1"></a><span class="fu">c</span>( <span class="sc">-</span><span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="co"># take a vector of values</span></span>
<span id="cb107-4"><a href="#cb107-4" tabindex="-1"></a>  <span class="fu">abs</span>()  <span class="sc">%&gt;%</span>      <span class="co"># take the absolute value of each</span></span>
<span id="cb107-5"><a href="#cb107-5" tabindex="-1"></a>  <span class="fu">sum</span>()           <span class="co"># add them up.</span></span></code></pre></div>
<pre><code>## [1] 2</code></pre>
<p>In <code>dplyr</code>, all the functions below take a <em>data set as its first argument</em> and <em>outputs an appropriately modified data set</em>. This will allow me to chain together commands in a readable fashion. For a more precise reasoning why using pipes in your code is superior, consider the following set of function calls that describes my morning routine. In this case, each function takes a person as an input and an appropriately modified person as an output object:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a><span class="fu">drive</span>(<span class="fu">drive</span>(<span class="fu">eat_breakfast</span>(<span class="fu">shave</span>(<span class="fu">clean</span>(<span class="fu">get_out_of_bed</span>(<span class="fu">wake_up</span>(me), <span class="at">side=</span><span class="st">&#39;right&#39;</span>), </span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a><span class="at">method=</span><span class="st">&#39;shower&#39;</span>), <span class="at">location=</span><span class="st">&#39;face&#39;</span>), <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>)), </span>
<span id="cb109-3"><a href="#cb109-3" tabindex="-1"></a><span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>), <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>The problem with code like this is that the function call parameters are far away from the function name. So that the function <code>drive()</code> which has a parameter <code>location='NAU'</code> has the two pieces that are not intuitively linked. The same set of function calls using a pipe command, keeps the function name and function parameters <em>together</em> in a much more readable format:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a>me <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" tabindex="-1"></a>  <span class="fu">wake_up</span>() <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" tabindex="-1"></a>  <span class="fu">get_out_of_bed</span>(<span class="at">side=</span><span class="st">&#39;right&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-4"><a href="#cb110-4" tabindex="-1"></a>  <span class="fu">clean</span>( <span class="at">method=</span><span class="st">&#39;shower&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-5"><a href="#cb110-5" tabindex="-1"></a>  <span class="fu">shave</span>( <span class="at">location=</span><span class="st">&#39;face&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-6"><a href="#cb110-6" tabindex="-1"></a>  <span class="fu">eat_breakfast</span>( <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb110-7"><a href="#cb110-7" tabindex="-1"></a>  <span class="fu">drive</span>( <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-8"><a href="#cb110-8" tabindex="-1"></a>  <span class="fu">drive</span>( <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>By piping the commands together, it is both easier to read, but also easier to <em>modify</em>. Imagine if I am running late and decide to skip the shower and shave. Then all I have to do is comment out those two steps like so:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a>me <span class="sc">%&gt;%</span></span>
<span id="cb111-2"><a href="#cb111-2" tabindex="-1"></a>  <span class="fu">wake_up</span>() <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3" tabindex="-1"></a>  <span class="fu">get_out_of_bed</span>(<span class="at">side=</span><span class="st">&#39;right&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-4"><a href="#cb111-4" tabindex="-1"></a>  <span class="co"># clean( method=&#39;shower&#39;) %&gt;%</span></span>
<span id="cb111-5"><a href="#cb111-5" tabindex="-1"></a>  <span class="co"># shave( location=&#39;face&#39;) %&gt;%</span></span>
<span id="cb111-6"><a href="#cb111-6" tabindex="-1"></a>  <span class="fu">eat_breakfast</span>( <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb111-7"><a href="#cb111-7" tabindex="-1"></a>  <span class="fu">drive</span>( <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-8"><a href="#cb111-8" tabindex="-1"></a>  <span class="fu">drive</span>( <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>This works so elegantly because the function call and its parameters are together instead of being spread apart and containing all the prior steps. If you wanted to comment out these steps in the first nested statement it is a mess. You end up re-writing the code so that one command is on a single line, but the function call and its parameters are still obnoxiously spread apart and I have to comment out <em>four</em> lines of code and I have to make sure the parameters I comment out are the right ones. Indenting the functions makes that easier, but this is still unpleasant and prone to error. Below is the messy result of doing such an operation without pipes.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a><span class="fu">drive</span>(</span>
<span id="cb112-2"><a href="#cb112-2" tabindex="-1"></a>  <span class="fu">drive</span>(</span>
<span id="cb112-3"><a href="#cb112-3" tabindex="-1"></a>    <span class="fu">eat_breakfast</span>(</span>
<span id="cb112-4"><a href="#cb112-4" tabindex="-1"></a>      <span class="co"># shave(</span></span>
<span id="cb112-5"><a href="#cb112-5" tabindex="-1"></a>      <span class="co">#   clean(</span></span>
<span id="cb112-6"><a href="#cb112-6" tabindex="-1"></a>          <span class="fu">get_out_of_bed</span>(</span>
<span id="cb112-7"><a href="#cb112-7" tabindex="-1"></a>            <span class="fu">wake_up</span>(me), </span>
<span id="cb112-8"><a href="#cb112-8" tabindex="-1"></a>          <span class="at">side=</span><span class="st">&#39;right&#39;</span>), </span>
<span id="cb112-9"><a href="#cb112-9" tabindex="-1"></a>      <span class="co">#   method=&#39;shower&#39;), </span></span>
<span id="cb112-10"><a href="#cb112-10" tabindex="-1"></a>      <span class="co"># location=&#39;face&#39;), </span></span>
<span id="cb112-11"><a href="#cb112-11" tabindex="-1"></a>    <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>)), </span>
<span id="cb112-12"><a href="#cb112-12" tabindex="-1"></a>  <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>), </span>
<span id="cb112-13"><a href="#cb112-13" tabindex="-1"></a><span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>The final way that you might have traditionally written this code without the pipe operator is by saving the output objects of each step:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a>me2 <span class="ot">&lt;-</span> <span class="fu">wake_up</span>(me)</span>
<span id="cb113-2"><a href="#cb113-2" tabindex="-1"></a>me3 <span class="ot">&lt;-</span> <span class="fu">get_out_of_bed</span>(me2, <span class="at">side=</span><span class="st">&#39;right&#39;</span>) </span>
<span id="cb113-3"><a href="#cb113-3" tabindex="-1"></a>me4 <span class="ot">&lt;-</span> <span class="fu">clean</span>(me3, <span class="at">method=</span><span class="st">&#39;shower&#39;</span>) </span>
<span id="cb113-4"><a href="#cb113-4" tabindex="-1"></a>me5 <span class="ot">&lt;-</span> <span class="fu">shave</span>(me4, <span class="at">location=</span><span class="st">&#39;face&#39;</span>) </span>
<span id="cb113-5"><a href="#cb113-5" tabindex="-1"></a>me6 <span class="ot">&lt;-</span> <span class="fu">eat_breakfast</span>(me5, <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>))</span>
<span id="cb113-6"><a href="#cb113-6" tabindex="-1"></a>me7 <span class="ot">&lt;-</span> <span class="fu">drive</span>(me6, <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>) </span>
<span id="cb113-7"><a href="#cb113-7" tabindex="-1"></a>me8 <span class="ot">&lt;-</span> <span class="fu">drive</span>(me7, <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>But now to remove the clean/shave steps, we have to ALSO remember to update the <code>eat_breakfast()</code> to use the appropriate <code>me</code> variable.</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a>me2 <span class="ot">&lt;-</span> <span class="fu">wake_up</span>(me)</span>
<span id="cb114-2"><a href="#cb114-2" tabindex="-1"></a>me3 <span class="ot">&lt;-</span> <span class="fu">get_out_of_bed</span>(me2, <span class="at">side=</span><span class="st">&#39;right&#39;</span>) </span>
<span id="cb114-3"><a href="#cb114-3" tabindex="-1"></a><span class="co"># me4 &lt;- clean(me3, method=&#39;shower&#39;) </span></span>
<span id="cb114-4"><a href="#cb114-4" tabindex="-1"></a><span class="co"># me5 &lt;- shave(me4, location=&#39;face&#39;) </span></span>
<span id="cb114-5"><a href="#cb114-5" tabindex="-1"></a>me6 <span class="ot">&lt;-</span> <span class="fu">eat_breakfast</span>(me3, <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>))  <span class="co"># This was also updated!</span></span>
<span id="cb114-6"><a href="#cb114-6" tabindex="-1"></a>me7 <span class="ot">&lt;-</span> <span class="fu">drive</span>(me6, <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>) </span>
<span id="cb114-7"><a href="#cb114-7" tabindex="-1"></a>me8 <span class="ot">&lt;-</span> <span class="fu">drive</span>(me7, <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>When it comes time to add the clean/shave steps back in, it is far too easy to forget to update <code>eat_breakfast()</code> command as well</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>me2 <span class="ot">&lt;-</span> <span class="fu">wake_up</span>(me)</span>
<span id="cb115-2"><a href="#cb115-2" tabindex="-1"></a>me3 <span class="ot">&lt;-</span> <span class="fu">get_out_of_bed</span>(me2, <span class="at">side=</span><span class="st">&#39;right&#39;</span>) </span>
<span id="cb115-3"><a href="#cb115-3" tabindex="-1"></a>me4 <span class="ot">&lt;-</span> <span class="fu">clean</span>(me3, <span class="at">method=</span><span class="st">&#39;shower&#39;</span>)</span>
<span id="cb115-4"><a href="#cb115-4" tabindex="-1"></a>me5 <span class="ot">&lt;-</span> <span class="fu">shave</span>(me4, <span class="at">location=</span><span class="st">&#39;face&#39;</span>)</span>
<span id="cb115-5"><a href="#cb115-5" tabindex="-1"></a>me6 <span class="ot">&lt;-</span> <span class="fu">eat_breakfast</span>(me3, <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>))  <span class="co"># forgot to update this!</span></span>
<span id="cb115-6"><a href="#cb115-6" tabindex="-1"></a>me7 <span class="ot">&lt;-</span> <span class="fu">drive</span>(me6, <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>) </span>
<span id="cb115-7"><a href="#cb115-7" tabindex="-1"></a>me8 <span class="ot">&lt;-</span> <span class="fu">drive</span>(me7, <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>So to prevent having that problem, programmers will often just overwrite the same object.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">wake_up</span>(me)</span>
<span id="cb116-2"><a href="#cb116-2" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">get_out_of_bed</span>(me, <span class="at">side=</span><span class="st">&#39;right&#39;</span>) </span>
<span id="cb116-3"><a href="#cb116-3" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">clean</span>(me, <span class="at">method=</span><span class="st">&#39;shower&#39;</span>)</span>
<span id="cb116-4"><a href="#cb116-4" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">shave</span>(me, <span class="at">location=</span><span class="st">&#39;face&#39;</span>)</span>
<span id="cb116-5"><a href="#cb116-5" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">eat_breakfast</span>(me, <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>))</span>
<span id="cb116-6"><a href="#cb116-6" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">drive</span>(me, <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>) </span>
<span id="cb116-7"><a href="#cb116-7" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="fu">drive</span>(me, <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>This has other inherent problems if objects become updated in a different order, and making many objects like the code above is often the best practice when writing new scripts. Aside from still having to write <code>me</code> so often, the original object <code>me</code> has been overwritten immediately. To write and test the next step in the code chunk, I have to remember to run whatever code originally produced the <code>me</code> object. That is really easy to forget to do and this can induce a <em>lot</em> of frustration. So this results in creating a <code>me_X</code> variable for each code chunk. So we’ll still have
obnoxious numbers of temporary variables. When I add/remove new chunks, I have to be careful to use the right temporary variables.</p>
<p>With the pipe operator, I typically have a work flow where I keep adding steps and debugging without overwriting my initial input object. Only once the code-chunk is completely debugged and I’m perfectly happy with it, will I finally save the output and overwrite the <code>me</code> object. This simplifies my writing/debugging process and removes any redundancy in object names.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a>me <span class="ot">&lt;-</span> </span>
<span id="cb117-2"><a href="#cb117-2" tabindex="-1"></a>  me <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" tabindex="-1"></a>  <span class="fu">wake_up</span>() <span class="sc">%&gt;%</span></span>
<span id="cb117-4"><a href="#cb117-4" tabindex="-1"></a>  <span class="fu">get_out_of_bed</span>(<span class="at">side=</span><span class="st">&#39;right&#39;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-5"><a href="#cb117-5" tabindex="-1"></a>  <span class="co"># clean( method=&#39;shower&#39;) %&gt;%</span></span>
<span id="cb117-6"><a href="#cb117-6" tabindex="-1"></a>  <span class="co"># shave( location=&#39;face&#39;) %&gt;%</span></span>
<span id="cb117-7"><a href="#cb117-7" tabindex="-1"></a>  <span class="fu">eat_breakfast</span>( <span class="at">what=</span><span class="fu">c</span>(<span class="st">&#39;cereal&#39;</span>,<span class="st">&#39;coffee&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb117-8"><a href="#cb117-8" tabindex="-1"></a>  <span class="fu">drive</span>( <span class="at">location=</span><span class="st">&quot;Kid&#39;s School&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb117-9"><a href="#cb117-9" tabindex="-1"></a>  <span class="fu">drive</span>( <span class="at">location=</span><span class="st">&#39;NAU&#39;</span>)</span></code></pre></div>
<p>So the pipe operator allows us to keep the function call and parameters together and prevents us from having to name/store all the intermediate results. As a result I make fewer programming mistakes and that saves me time and frustration. I find that most of the programming I do these days includes the use of lots of pipes (often called a pipe-line), and I encounter far less programming frustrations.</p>
</div>
<div id="common-dplyr-verbs" class="section level2 hasAnchor" number="4.2">
<h2 class="hasAnchor"><span class="header-section-number">4.2</span> Common dplyr Verbs<a href="#common-dplyr-verbs" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The foundational operations to perform on a data set are:</p>
<table>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">Adding rows</th>
<th align="left">Adds to a data set</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>add_rows()</code></td>
<td align="left">Add an additional single row of data, specified by cell.</td>
</tr>
<tr class="even">
<td align="right"><code>bind_rows()</code></td>
<td align="left">Add additional row(s) of data, specified by the added data table.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">Subsetting</th>
<th align="left">Returns a data set with particular columns or rows</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>select()</code></td>
<td align="left">Selecting a subset of columns by name or column number. Helper functions such as <code>starts_with()</code>, <code>ends_with()</code>, and <code>contains()</code> allows you pick columns that have certain attributes in their column names.</td>
</tr>
<tr class="even">
<td align="right"><code>filter()</code></td>
<td align="left">Selecting a subset of rows from a data frame based on logical expressions.</td>
</tr>
<tr class="odd">
<td align="right"><code>slice()</code></td>
<td align="left">Selecting a subset of rows by row number. There are a few variants that allow for common tasks to such as <code>slice_head()</code> <code>slice_tail()</code> and <code>slice_sample()</code></td>
</tr>
<tr class="even">
<td align="right"><code>drop_na()</code></td>
<td align="left">Remove rows that contain any missing values.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">Sorting</th>
<th align="left">Returns a data table with the rows sorted according to a particular column(s).</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>arrange()</code></td>
<td align="left">Re-ordering the rows of a data frame. The <code>desc()</code> function can be used on the selected column to reverse the sort direction.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">Update/Add columns</th>
<th align="left">Returns a data table updated and/or new column(s).</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>mutate()</code></td>
<td align="left">Add a new column that is some function of other columns. This function is used with an <code>ifelse()</code> command for updating particular cells and <code>across()</code> to apply some function to a variety of columns.</td>
</tr>
</tbody>
</table>
<table>
<colgroup>
<col width="25%" />
<col width="75%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">Summarize</th>
<th align="left">Returns a data table with many rows into summarized into one row.</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right"><code>summarise()</code></td>
<td align="left">Calculate some summary statistic of a column of data. This collapses a set of rows into fewer (often one) rows.</td>
</tr>
</tbody>
</table>
<p>Each of these operations is a function in the package <code>dplyr</code>. These functions all have a similar calling syntax, the first argument is a data set, subsequent arguments describe what to do with the input data frame and you can refer to the columns without using the <code>df$column</code> notation. All of these functions will return a data set.</p>
<p>To demonstrate all of these actions, we will consider a tiny data set of a gradebook of doctors at a Sacred Heart Hospital.</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" tabindex="-1"></a><span class="co"># Create a tiny data frame that is easy to see what is happening</span></span>
<span id="cb118-2"><a href="#cb118-2" tabindex="-1"></a>Mentors <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb118-3"><a href="#cb118-3" tabindex="-1"></a>  <span class="sc">~</span>l.name, <span class="sc">~</span>Gender, <span class="sc">~</span>Exam1, <span class="sc">~</span>Exam2, <span class="sc">~</span>Final,</span>
<span id="cb118-4"><a href="#cb118-4" tabindex="-1"></a>  <span class="st">&#39;Cox&#39;</span>,     <span class="st">&#39;M&#39;</span>,     <span class="fl">93.2</span>,   <span class="fl">98.3</span>,     <span class="fl">96.4</span>,</span>
<span id="cb118-5"><a href="#cb118-5" tabindex="-1"></a>  <span class="st">&#39;Kelso&#39;</span>,   <span class="st">&#39;M&#39;</span>,     <span class="fl">80.7</span>,   <span class="fl">82.8</span>,     <span class="fl">81.1</span>)</span>
<span id="cb118-6"><a href="#cb118-6" tabindex="-1"></a>Residents <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb118-7"><a href="#cb118-7" tabindex="-1"></a>  <span class="sc">~</span>l.name, <span class="sc">~</span>Gender, <span class="sc">~</span>Exam1, <span class="sc">~</span>Exam2, <span class="sc">~</span>Final,</span>
<span id="cb118-8"><a href="#cb118-8" tabindex="-1"></a>  <span class="st">&#39;Dorian&#39;</span>,  <span class="st">&#39;M&#39;</span>,     <span class="fl">89.3</span>,   <span class="fl">70.2</span>,   <span class="fl">85.7</span>,</span>
<span id="cb118-9"><a href="#cb118-9" tabindex="-1"></a>  <span class="st">&#39;Turk&#39;</span>,    <span class="st">&#39;M&#39;</span>,     <span class="fl">70.9</span>,   <span class="fl">85.5</span>,   <span class="fl">92.2</span>)</span></code></pre></div>
</div>
<div id="adding-new-rows-and-columns" class="section level2 hasAnchor" number="4.3">
<h2 class="hasAnchor"><span class="header-section-number">4.3</span> Adding new rows and columns<a href="#adding-new-rows-and-columns" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="add_row" class="section level3 hasAnchor" number="4.3.1">
<h3 class="hasAnchor"><span class="header-section-number">4.3.1</span> add_row()<a href="#add_row" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Suppose that we want to add a row to our data set. We can give it as much or as little information as we want and any missing information will be denoted as missing using a <code>NA</code> which stands for <em>N</em>ot <em>A</em>vailable. Here we add partial information for a third Resident.</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a>Residents  <span class="sc">%&gt;%</span> </span>
<span id="cb119-2"><a href="#cb119-2" tabindex="-1"></a>  <span class="fu">add_row</span>( <span class="at">l.name=</span><span class="st">&#39;Reid&#39;</span>, <span class="at">Exam1=</span><span class="fl">95.3</span>, <span class="at">Exam2=</span><span class="fl">92.0</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Dorian M       89.3  70.2  85.7
## 2 Turk   M       70.9  85.5  92.2
## 3 Reid   &lt;NA&gt;    95.3  92    NA</code></pre>
<p>Notice that the command only added information to the columns provided and filled the rest with <code>NA</code>. Because we didn’t assign the result of our previous calculation to any object name, R just printed the result. Instead, lets add all of Dr Reid’s information and save the result by <em>overwriting</em> the <code>Residents</code> data frame with the new version.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a>Residents <span class="ot">&lt;-</span> Residents <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2" tabindex="-1"></a>  <span class="fu">add_row</span>( <span class="at">l.name=</span><span class="st">&#39;Reid&#39;</span>, <span class="at">Gender=</span><span class="st">&#39;F&#39;</span>, <span class="at">Exam1=</span><span class="fl">95.3</span>, <span class="at">Exam2=</span><span class="fl">92.0</span>, <span class="at">Final=</span><span class="fl">100.0</span>)</span>
<span id="cb121-3"><a href="#cb121-3" tabindex="-1"></a>Residents</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Dorian M       89.3  70.2  85.7
## 2 Turk   M       70.9  85.5  92.2
## 3 Reid   F       95.3  92   100</code></pre>
<p>This produces a new version of the <code>Residents</code> object properly updated with all of Dr. Reid’s information. We can now use the <code>Residents</code> data frame in later calculations.</p>
</div>
<div id="bind_rows" class="section level3 hasAnchor" number="4.3.2">
<h3 class="hasAnchor"><span class="header-section-number">4.3.2</span> bind_rows()<a href="#bind_rows" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To combine two data frames together, we’ll bind them together using <code>bind_rows()</code>. We just need to specify the order to stack them.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a><span class="co"># now to combine two data frames by stacking Mentors first and then Residents</span></span>
<span id="cb123-2"><a href="#cb123-2" tabindex="-1"></a>grades <span class="ot">&lt;-</span> Mentors <span class="sc">%&gt;%</span> </span>
<span id="cb123-3"><a href="#cb123-3" tabindex="-1"></a>  <span class="fu">bind_rows</span>(Residents)</span>
<span id="cb123-4"><a href="#cb123-4" tabindex="-1"></a>grades</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cox    M       93.2  98.3  96.4
## 2 Kelso  M       80.7  82.8  81.1
## 3 Dorian M       89.3  70.2  85.7
## 4 Turk   M       70.9  85.5  92.2
## 5 Reid   F       95.3  92   100</code></pre>
<p>Notice though that if the information of <code>Mentor</code> or <code>Resident</code> was important to retain, we no longer kept this knowledge. We may have wanted to introduce another column to keep track of the <code>Type</code> of doctor if this was important auxiliary information to retain.</p>
</div>
</div>
<div id="subsetting" class="section level2 hasAnchor" number="4.4">
<h2 class="hasAnchor"><span class="header-section-number">4.4</span> Subsetting<a href="#subsetting" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>These function allows you select certain columns and rows of a data frame.</p>
<div id="select-select-columns" class="section level3 hasAnchor" number="4.4.1">
<h3 class="hasAnchor"><span class="header-section-number">4.4.1</span> select(): select columns<a href="#select-select-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often you only want to work with a small number of columns of a data frame and want to be able to <em>select</em> a subset of columns or perhaps remove a subset. The function to do that is <code>dplyr::select()</code>. I could select the Exam columns by hand, or by using an extension of the <code>:</code> operator.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a><span class="co"># select( grades,  Exam1, Exam2 )   # from `grades`, select columns Exam1, Exam2</span></span>
<span id="cb125-2"><a href="#cb125-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( Exam1, Exam2 )   <span class="co"># Exam1 and Exam2</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   Exam1 Exam2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  93.2  98.3
## 2  80.7  82.8
## 3  89.3  70.2
## 4  70.9  85.5
## 5  95.3  92</code></pre>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( Exam1<span class="sc">:</span>Final )    <span class="co"># Columns Exam1 through Final</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   Exam1 Exam2 Final
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  93.2  98.3  96.4
## 2  80.7  82.8  81.1
## 3  89.3  70.2  85.7
## 4  70.9  85.5  92.2
## 5  95.3  92   100</code></pre>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( <span class="sc">-</span>Exam1 )         <span class="co"># Negative indexing by name drops a column</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 4
##   l.name Gender Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;
## 1 Cox    M       98.3  96.4
## 2 Kelso  M       82.8  81.1
## 3 Dorian M       70.2  85.7
## 4 Turk   M       85.5  92.2
## 5 Reid   F       92   100</code></pre>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span> )            <span class="co"># Can select column by column position</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   l.name Gender
##   &lt;chr&gt;  &lt;chr&gt; 
## 1 Cox    M     
## 2 Kelso  M     
## 3 Dorian M     
## 4 Turk   M     
## 5 Reid   F</code></pre>
<p>The <code>select()</code> command has a few other tricks. There are functional calls that describe the columns you wish to select that take advantage of pattern matching. I generally can get by with <code>starts_with()</code>, <code>ends_with()</code>, and <code>contains()</code>, but there is a final operator <code>matches()</code> that takes a regular expression.</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( <span class="fu">starts_with</span>(<span class="st">&#39;Exam&#39;</span>) )   <span class="co"># Exam1 and Exam2</span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 2
##   Exam1 Exam2
##   &lt;dbl&gt; &lt;dbl&gt;
## 1  93.2  98.3
## 2  80.7  82.8
## 3  89.3  70.2
## 4  70.9  85.5
## 5  95.3  92</code></pre>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&#39;Exam&#39;</span>,<span class="st">&#39;F&#39;</span>)) ) <span class="co"># All three exams </span></span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   Exam1 Exam2 Final
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  93.2  98.3  96.4
## 2  80.7  82.8  81.1
## 3  89.3  70.2  85.7
## 4  70.9  85.5  92.2
## 5  95.3  92   100</code></pre>
<p>The <code>select</code> function allows you to include multiple selector helpers. The <a href="https://tidyselect.r-lib.org/reference/language.html">help file</a> for <code>tidyselect</code> package describes a few other interesting selection helper functions. One final one is the <code>where()</code> command which will apply a function to each column and return the columns in which the values will evaluate to TRUE. This is particularly handy for selecting all numeric columns or all columns that are character strings.</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" tabindex="-1"></a><span class="co"># select only the numerical numerical columns</span></span>
<span id="cb137-2"><a href="#cb137-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( <span class="fu">where</span>(is.numeric) )</span></code></pre></div>
<pre><code>## # A tibble: 5 × 3
##   Exam1 Exam2 Final
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1  93.2  98.3  96.4
## 2  80.7  82.8  81.1
## 3  89.3  70.2  85.7
## 4  70.9  85.5  92.2
## 5  95.3  92   100</code></pre>
<p>We could also ask to select both the numeric columns and all columns that are character strings.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" tabindex="-1"></a><span class="co"># select numerical and character columns</span></span>
<span id="cb139-2"><a href="#cb139-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">select</span>( <span class="fu">where</span>(is.numeric), <span class="fu">where</span>(is.character) )</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   Exam1 Exam2 Final l.name Gender
##   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt; 
## 1  93.2  98.3  96.4 Cox    M     
## 2  80.7  82.8  81.1 Kelso  M     
## 3  89.3  70.2  85.7 Dorian M     
## 4  70.9  85.5  92.2 Turk   M     
## 5  95.3  92   100   Reid   F</code></pre>
<p>Notice that the order which we placed our selection is the new order of the output data frame. Be mindful of these consequences, but if you properly use <code>dplyr</code> functionality, the column positions will not be as critical to important calculations.</p>
<p>The <code>dplyr::select()</code> function is quite handy, but there are several other packages out there that have a <code>select</code> function and we can get into trouble with loading other packages with the same function names. If I encounter the <code>select</code> function behaving in a weird manner or complaining about an input argument, my first remedy is to be explicit about it is the <code>dplyr::select()</code> function by appending the package name at the start. This was introduced in Chapter 1 and is known as <em>masking</em>.</p>
</div>
<div id="filter-select-rows-with-logicals" class="section level3 hasAnchor" number="4.4.2">
<h3 class="hasAnchor"><span class="header-section-number">4.4.2</span> filter(): select rows with logicals<a href="#filter-select-rows-with-logicals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is common to want to select particular rows where we have some logical expression to pick the rows.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" tabindex="-1"></a><span class="co"># select students with Final grades greater than 90</span></span>
<span id="cb141-2"><a href="#cb141-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Final <span class="sc">&gt;</span> <span class="dv">90</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cox    M       93.2  98.3  96.4
## 2 Turk   M       70.9  85.5  92.2
## 3 Reid   F       95.3  92   100</code></pre>
<p>You can have multiple logical expressions to select rows and they will be logically combined so that only rows that satisfy all of the conditions are selected. The logicals are joined together using <code>&amp;</code> (and) operator or the <code>|</code> (or) operator and you may explicitly use other logicals. For example, a factor column type might be used to select rows where type is either one or two via the following: <code>type==1 | type==2</code>. I prefer reading the command <code>==</code> as <em>identical to</em>, and is an important logical operator when working with factors.</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" tabindex="-1"></a><span class="co"># select students with Final grades above 90 and</span></span>
<span id="cb143-2"><a href="#cb143-2" tabindex="-1"></a><span class="co"># average score also above 90</span></span>
<span id="cb143-3"><a href="#cb143-3" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Final <span class="sc">&gt;</span> <span class="dv">90</span>, ((Exam1 <span class="sc">+</span> Exam2 <span class="sc">+</span> Final)<span class="sc">/</span><span class="dv">3</span>) <span class="sc">&gt;</span> <span class="dv">90</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cox    M       93.2  98.3  96.4
## 2 Reid   F       95.3  92   100</code></pre>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" tabindex="-1"></a><span class="co"># we could also use an &quot;and&quot; condition</span></span>
<span id="cb145-2"><a href="#cb145-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Final <span class="sc">&gt;</span> <span class="dv">90</span> <span class="sc">&amp;</span> ((Exam1 <span class="sc">+</span> Exam2 <span class="sc">+</span> Final)<span class="sc">/</span><span class="dv">3</span>) <span class="sc">&gt;</span> <span class="dv">90</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cox    M       93.2  98.3  96.4
## 2 Reid   F       95.3  92   100</code></pre>
</div>
<div id="slice-select-rows-with-numerics." class="section level3 hasAnchor" number="4.4.3">
<h3 class="hasAnchor"><span class="header-section-number">4.4.3</span> slice(): Select rows with numerics.<a href="#slice-select-rows-with-numerics." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When you want to filter rows based on row number, this is called slicing.</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" tabindex="-1"></a><span class="co"># grab the first 2 rows</span></span>
<span id="cb147-2"><a href="#cb147-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">slice</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cox    M       93.2  98.3  96.4
## 2 Kelso  M       80.7  82.8  81.1</code></pre>
<p>There are a few other slice variants that are useful. <code>slice_head()</code> and <code>slice_tail</code> grab the first and last few rows. The <code>slice_sample()</code> allows us to randomly grab table rows.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" tabindex="-1"></a><span class="co"># sample with replacement, number of rows is 100% of the original number of rows</span></span>
<span id="cb149-2"><a href="#cb149-2" tabindex="-1"></a><span class="co"># This is super helpful for bootstrapping code</span></span>
<span id="cb149-3"><a href="#cb149-3" tabindex="-1"></a>grades <span class="sc">%&gt;%</span></span>
<span id="cb149-4"><a href="#cb149-4" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">prop=</span><span class="dv">1</span>, <span class="at">replace=</span><span class="cn">TRUE</span>)  </span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Turk   M       70.9  85.5  92.2
## 2 Kelso  M       80.7  82.8  81.1
## 3 Dorian M       89.3  70.2  85.7
## 4 Cox    M       93.2  98.3  96.4
## 5 Cox    M       93.2  98.3  96.4</code></pre>
<p>There are also methods for using logicals within a <code>slice()</code>, but this becomes much more like a <code>filter()</code>. I tend to only use <code>slice()</code> when I have used some other <code>dyplr</code> functionality to properly selected the rows of interest. Its best to just use <code>filter()</code> in most cases where particular rows are needed, rather than using the numerical values that might require someone to ‘count’ the rows explicitly.</p>
</div>
<div id="arrange-sort-data" class="section level3 hasAnchor" number="4.4.4">
<h3 class="hasAnchor"><span class="header-section-number">4.4.4</span> arrange(): sort data<a href="#arrange-sort-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We often need to re-order the rows of a data frame. For example, we might wish to take our grade book and sort the rows by the average score, or perhaps alphabetically. The <code>arrange()</code> function does exactly that. The first argument
is the data frame to re-order, and the subsequent arguments are the columns to sort on. The order of the sorting column determines the precedent: the first sorting column is first used and the second sorting column is only used to break ties.</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(l.name)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Cox    M       93.2  98.3  96.4
## 2 Dorian M       89.3  70.2  85.7
## 3 Kelso  M       80.7  82.8  81.1
## 4 Reid   F       95.3  92   100  
## 5 Turk   M       70.9  85.5  92.2</code></pre>
<p>The default sorting is in ascending order, so to sort the grades with the highest scoring person in the first row, we must tell arrange to do it in descending order using <code>desc(column.name)</code>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(<span class="fu">desc</span>(Final))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Reid   F       95.3  92   100  
## 2 Cox    M       93.2  98.3  96.4
## 3 Turk   M       70.9  85.5  92.2
## 4 Dorian M       89.3  70.2  85.7
## 5 Kelso  M       80.7  82.8  81.1</code></pre>
<p>We can also order a data frame by multiple columns.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" tabindex="-1"></a><span class="co"># Arrange by Gender first, then within each gender, order by Exam2</span></span>
<span id="cb155-2"><a href="#cb155-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">arrange</span>(Gender, <span class="fu">desc</span>(Exam2))  </span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   l.name Gender Exam1 Exam2 Final
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 Reid   F       95.3  92   100  
## 2 Cox    M       93.2  98.3  96.4
## 3 Turk   M       70.9  85.5  92.2
## 4 Kelso  M       80.7  82.8  81.1
## 5 Dorian M       89.3  70.2  85.7</code></pre>
</div>
<div id="mutate-update-and-create-new-columns" class="section level3 hasAnchor" number="4.4.5">
<h3 class="hasAnchor"><span class="header-section-number">4.4.5</span> mutate(): Update and Create New Columns<a href="#mutate-update-and-create-new-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The mutate command either creates a <em>new</em> column in the data frame or <em>updates</em> an already existing column. It is common that we need to create a new column that is some function of the old columns. In the <code>dplyr</code> package, this is a <code>mutate</code> command. To do this, we give a <code>mutate( NewColumn = Function of Old Columns )</code> command. You can do multiple
calculations within the same <code>mutate()</code> command, and you can even refer to columns that were created in the same <code>mutate()</code> command. Below shows the power of a <code>mutate()</code> command by calculating the average of the exams and making grade cut-offs based on the exam averages.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" tabindex="-1"></a>grades <span class="ot">&lt;-</span> grades <span class="sc">%&gt;%</span> </span>
<span id="cb157-2"><a href="#cb157-2" tabindex="-1"></a>  <span class="fu">mutate</span>( </span>
<span id="cb157-3"><a href="#cb157-3" tabindex="-1"></a>    <span class="at">average =</span> (Exam1 <span class="sc">+</span> Exam2 <span class="sc">+</span> Final)<span class="sc">/</span><span class="dv">3</span>,</span>
<span id="cb157-4"><a href="#cb157-4" tabindex="-1"></a>    <span class="at">grade =</span> <span class="fu">cut</span>(average, <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">60</span>, <span class="dv">70</span>, <span class="dv">80</span>, <span class="dv">90</span>, <span class="dv">100</span>),  <span class="co"># cut takes numeric variable</span></span>
<span id="cb157-5"><a href="#cb157-5" tabindex="-1"></a>                         <span class="fu">c</span>( <span class="st">&#39;F&#39;</span>,<span class="st">&#39;D&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;A&#39;</span>))    <span class="co"># and makes a factor</span></span>
<span id="cb157-6"><a href="#cb157-6" tabindex="-1"></a>  )</span>
<span id="cb157-7"><a href="#cb157-7" tabindex="-1"></a></span>
<span id="cb157-8"><a href="#cb157-8" tabindex="-1"></a>grades</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   l.name Gender Exam1 Exam2 Final average grade
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;
## 1 Cox    M       93.2  98.3  96.4    96.0 A    
## 2 Kelso  M       80.7  82.8  81.1    81.5 B    
## 3 Dorian M       89.3  70.2  85.7    81.7 B    
## 4 Turk   M       70.9  85.5  92.2    82.9 B    
## 5 Reid   F       95.3  92   100      95.8 A</code></pre>
<p>If we want to update some column information we will also use the <code>mutate()</code> command, but we need some mechanism to select the rows to change, while keeping all the other row values the same. The functions <code>if_else()</code> and <code>case_when()</code> are ideal for this task. The <code>if_else</code> syntax is <code>if_else( logical.expression, TrueValue, FalseValue )</code>. For each row of the table, the logical expression will be evaluated, and if the expression is TRUE, the <code>TrueValue</code> is selected, otherwise <code>FalseValue</code> is. We can use this to update a score in our gradebook.</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" tabindex="-1"></a><span class="co"># Update Dr Reid&#39;s Final Exam score to 98, and leave everybody else&#39;s alone.</span></span>
<span id="cb159-2"><a href="#cb159-2" tabindex="-1"></a>grades <span class="ot">&lt;-</span> grades <span class="sc">%&gt;%</span></span>
<span id="cb159-3"><a href="#cb159-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Final =</span> <span class="fu">if_else</span>(l.name <span class="sc">==</span> <span class="st">&#39;Reid&#39;</span>, <span class="dv">98</span>, Final ) )</span>
<span id="cb159-4"><a href="#cb159-4" tabindex="-1"></a>grades</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   l.name Gender Exam1 Exam2 Final average grade
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;
## 1 Cox    M       93.2  98.3  96.4    96.0 A    
## 2 Kelso  M       80.7  82.8  81.1    81.5 B    
## 3 Dorian M       89.3  70.2  85.7    81.7 B    
## 4 Turk   M       70.9  85.5  92.2    82.9 B    
## 5 Reid   F       95.3  92    98      95.8 A</code></pre>
<p>We could also use this to modify all the rows. For example, perhaps we want to change the <code>gender</code> column information to have levels <code>Male</code> and <code>Female</code>.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" tabindex="-1"></a><span class="co"># Update the Gender column labels</span></span>
<span id="cb161-2"><a href="#cb161-2" tabindex="-1"></a>grades <span class="ot">&lt;-</span> grades <span class="sc">%&gt;%</span></span>
<span id="cb161-3"><a href="#cb161-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Gender =</span> <span class="fu">if_else</span>(Gender <span class="sc">==</span> <span class="st">&#39;M&#39;</span>, <span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span> ) )</span>
<span id="cb161-4"><a href="#cb161-4" tabindex="-1"></a>grades</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   l.name Gender Exam1 Exam2 Final average grade
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;
## 1 Cox    Male    93.2  98.3  96.4    96.0 A    
## 2 Kelso  Male    80.7  82.8  81.1    81.5 B    
## 3 Dorian Male    89.3  70.2  85.7    81.7 B    
## 4 Turk   Male    70.9  85.5  92.2    82.9 B    
## 5 Reid   Female  95.3  92    98      95.8 A</code></pre>
<p>To do something similar for the case where we have 3 or more categories, we could use the <code>if_else()</code> command repeatedly to address each category level separately. However this is annoying to do because the <code>ifelse</code> command is limited to just two cases, it would be nice if there was a generalization to multiple categories. The <code>dplyr::case_when()</code> function is that generalization. The syntax is <code>case_when( logicalExpression1~Value1, logicalExpression2~Value2, ... )</code>. We can have as many <code>LogicalExpression ~ Value</code> pairs as we want.</p>
<p>Consider the following data frame that has name, gender, and political party affiliation of six individuals. In this example, we’ve coded male/female as 1/0 and political party as 1,2,3 for democratic, republican, and independent.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" tabindex="-1"></a>people <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb163-2"><a href="#cb163-2" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;Barack&#39;</span>,<span class="st">&#39;Michelle&#39;</span>, <span class="st">&#39;George&#39;</span>, <span class="st">&#39;Laura&#39;</span>, <span class="st">&#39;Bernie&#39;</span>, <span class="st">&#39;Deborah&#39;</span>),</span>
<span id="cb163-3"><a href="#cb163-3" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb163-4"><a href="#cb163-4" tabindex="-1"></a>  <span class="at">party =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb163-5"><a href="#cb163-5" tabindex="-1"></a>)</span>
<span id="cb163-6"><a href="#cb163-6" tabindex="-1"></a>people</span></code></pre></div>
<pre><code>##       name gender party
## 1   Barack      1     1
## 2 Michelle      0     1
## 3   George      1     2
## 4    Laura      0     2
## 5   Bernie      1     3
## 6  Deborah      0     3</code></pre>
<p>Now we’ll update the gender and party columns to code these columns in a readable fashion, handling a variable with many levels using the <code>case_when()</code> functionality.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" tabindex="-1"></a>people <span class="ot">&lt;-</span> people <span class="sc">%&gt;%</span></span>
<span id="cb165-2"><a href="#cb165-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">gender =</span> <span class="fu">if_else</span>( gender <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&#39;Female&#39;</span>, <span class="st">&#39;Male&#39;</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb165-3"><a href="#cb165-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">party =</span> <span class="fu">case_when</span>( party <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&#39;Democratic&#39;</span>, </span>
<span id="cb165-4"><a href="#cb165-4" tabindex="-1"></a>                             party <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&#39;Republican&#39;</span>, </span>
<span id="cb165-5"><a href="#cb165-5" tabindex="-1"></a>                             party <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&#39;Independent&#39;</span>,</span>
<span id="cb165-6"><a href="#cb165-6" tabindex="-1"></a>                             <span class="cn">TRUE</span>       <span class="sc">~</span> <span class="st">&#39;None Stated&#39;</span> ) )</span>
<span id="cb165-7"><a href="#cb165-7" tabindex="-1"></a>people</span></code></pre></div>
<pre><code>##       name gender       party
## 1   Barack   Male  Democratic
## 2 Michelle Female  Democratic
## 3   George   Male  Republican
## 4    Laura Female  Republican
## 5   Bernie   Male Independent
## 6  Deborah Female Independent</code></pre>
<p>Often the last case is a catch all case where the logical expression will ALWAYS evaluate to TRUE and this is the value for all other input.</p>
<p>In the above case, we are transforming the variable into a character string. If we had already transformed <code>party</code> into a factor, we could have used the command <code>forcats::fct_recode()</code> function instead. See the Factors chapter in this book for more information about factors.</p>
</div>
<div id="across-modify-multiple-columns" class="section level3 hasAnchor" number="4.4.6">
<h3 class="hasAnchor"><span class="header-section-number">4.4.6</span> across(): Modify Multiple Columns<a href="#across-modify-multiple-columns" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We often find that we want to modify multiple columns at once. For example in the grades, we might want to round the exams so that we don’t have to deal with any decimal points. To do this, we need to have some code to: 1) select the desired columns, 2) indicate the function to use, and 3) combine those. The <code>dplyr::across()</code> function is designed to do this. The <code>across</code> function will work within a <code>mutate</code> or <code>summarise()</code> function.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span></span>
<span id="cb167-2"><a href="#cb167-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="fu">across</span>(         <span class="co"># Pick any of the following column selection tricks...</span></span>
<span id="cb167-3"><a href="#cb167-3" tabindex="-1"></a>    <span class="co">#c(&#39;Exam1&#39;,&#39;Exam2&#39;,&#39;Final&#39;),        # Specify columns explicitly</span></span>
<span id="cb167-4"><a href="#cb167-4" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&#39;Exam&#39;</span>, <span class="st">&#39;Final&#39;</span>)),    <span class="co"># anything that select can use...</span></span>
<span id="cb167-5"><a href="#cb167-5" tabindex="-1"></a>    <span class="co"># where(is.numeric),                # If a column has a specific type..</span></span>
<span id="cb167-6"><a href="#cb167-6" tabindex="-1"></a>    <span class="co"># Exam1:Final,                      # Or via a range notation</span></span>
<span id="cb167-7"><a href="#cb167-7" tabindex="-1"></a>    round,                <span class="co"># The function I want to use</span></span>
<span id="cb167-8"><a href="#cb167-8" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">0</span>            <span class="co"># additional arguments sent into round()</span></span>
<span id="cb167-9"><a href="#cb167-9" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   l.name Gender Exam1 Exam2 Final average grade
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;
## 1 Cox    Male      93    98    96    96.0 A    
## 2 Kelso  Male      81    83    81    81.5 B    
## 3 Dorian Male      89    70    86    81.7 B    
## 4 Turk   Male      71    86    92    82.9 B    
## 5 Reid   Female    95    92    98    95.8 A</code></pre>
<p>In most of the code examples you’ll find online, this is usually written in a single line of code. To clarify the work above, here is a single line of code that executes the rounding of the indicated columns.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span></span>
<span id="cb169-2"><a href="#cb169-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&#39;Exam&#39;</span>, <span class="st">&#39;Final&#39;</span>)),  round, <span class="at">digits =</span> <span class="dv">0</span>))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   l.name Gender Exam1 Exam2 Final average grade
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;
## 1 Cox    Male      93    98    96    96.0 A    
## 2 Kelso  Male      81    83    81    81.5 B    
## 3 Dorian Male      89    70    86    81.7 B    
## 4 Turk   Male      71    86    92    82.9 B    
## 5 Reid   Female    95    92    98    95.8 A</code></pre>
<p>As before, any <code>select</code> helper function will work. Here, we can round all numerical columns with a using <code>across()</code> and selecting all numerical columns with the <code>where()</code> selector.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="#cb171-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="at">digits=</span><span class="dv">0</span> ))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 7
##   l.name Gender Exam1 Exam2 Final average grade
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;fct&gt;
## 1 Cox    Male      93    98    96      96 A    
## 2 Kelso  Male      81    83    81      82 B    
## 3 Dorian Male      89    70    86      82 B    
## 4 Turk   Male      71    86    92      83 B    
## 5 Reid   Female    95    92    98      96 A</code></pre>
<p>In earlier versions of <code>dplyr</code> there was no <code>across</code> function, but instead there where variants of <code>mutate</code> and <code>summarise</code> such as <code>mutate_if()</code> that would apply the desired function to some set of columns. However these made some pretty strong assumptions about what a user was likely to want to do and, as a result, lacked the flexibility to handle more complicated scenarios. Those scoped variant functions have been superseded and users are encouraged to use the <code>across</code> function.</p>
<p><strong>In the most updated version of <code>dplyr</code></strong> the <code>across()</code> function is considered depreciated. This will cause some of the code above to cast warnings, but the code will still work. I have removed these warnings from display above, but please be aware that the <code>across()</code> function can still be used as presented above, but that newly developed <code>dplyr</code> functionality will force you into a new, less ambiguous, method to selecting multiple columns.</p>
<div id="create-a-new-column-using-many-columns" class="section level4 hasAnchor" number="4.4.6.1">
<h4 class="hasAnchor"><span class="header-section-number">4.4.6.1</span> Create a new column using many columns<a href="#create-a-new-column-using-many-columns" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Often we have many many columns in the data frame and we want to utilize all of them to create a summary statistic. There are several ways to do this, but it is easiest to utilize the <code>rowwise()</code> and <code>c_across()</code> commands.</p>
<p>The command <code>dplyr::rowwise()</code> causes subsequent actions to be performed <em>rowwise</em> instead of the default of <em>columnwise</em>. <code>rowwise()</code> is actually a special form of <code>group_by()</code> which creates a unique group for each row. The function <code>dplyr::c_across()</code> allows you to use all the <code>select</code> style tricks for picking columns.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="#cb173-1" tabindex="-1"></a>grades <span class="sc">%&gt;%</span></span>
<span id="cb173-2"><a href="#cb173-2" tabindex="-1"></a>  <span class="fu">select</span>(l.name<span class="sc">:</span>Final) <span class="sc">%&gt;%</span>   <span class="co"># remove the previously calculated average &amp; grade</span></span>
<span id="cb173-3"><a href="#cb173-3" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb173-4"><a href="#cb173-4" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">average =</span> <span class="fu">mean</span>( <span class="fu">c_across</span>( <span class="co"># Pick any of the following column selection tricks...</span></span>
<span id="cb173-5"><a href="#cb173-5" tabindex="-1"></a>    <span class="co"># c(&#39;Exam1&#39;,&#39;Exam2&#39;,&#39;Final&#39;)        # Specify columns explicitly</span></span>
<span id="cb173-6"><a href="#cb173-6" tabindex="-1"></a>    <span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&#39;Exam&#39;</span>, <span class="st">&#39;Final&#39;</span>))     <span class="co"># anything that select can use...</span></span>
<span id="cb173-7"><a href="#cb173-7" tabindex="-1"></a>    <span class="co"># where(is.numeric)                 # If a column has a specific type..</span></span>
<span id="cb173-8"><a href="#cb173-8" tabindex="-1"></a>    <span class="co"># Exam1:Final                       # Or via a range notation</span></span>
<span id="cb173-9"><a href="#cb173-9" tabindex="-1"></a>  )))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Rowwise: 
##   l.name Gender Exam1 Exam2 Final average
##   &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
## 1 Cox    Male    93.2  98.3  96.4    96.0
## 2 Kelso  Male    80.7  82.8  81.1    81.5
## 3 Dorian Male    89.3  70.2  85.7    81.7
## 4 Turk   Male    70.9  85.5  92.2    82.9
## 5 Reid   Female  95.3  92    98      95.1</code></pre>
<p>Because <code>rowwise()</code> is a special form of grouping, to exit the row-wise calculations, call <code>ungroup()</code>. We need only ever <code>ungroup()</code> our work if we plan to continue the calculation from that object.</p>
</div>
</div>
<div id="summarise-create-new-summary-data-frame" class="section level3 hasAnchor" number="4.4.7">
<h3 class="hasAnchor"><span class="header-section-number">4.4.7</span> summarise(): create new summary data frame<a href="#summarise-create-new-summary-data-frame" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>By itself, this function is quite boring, but will become useful later on. Its purpose is to calculate summary statistics using any or all of the data columns. Notice that we get to chose the name of the new column. The way to think about this is that we are collapsing information stored in multiple rows into a single row of values.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb175-1"><a href="#cb175-1" tabindex="-1"></a><span class="co"># calculate the mean of exam 1</span></span>
<span id="cb175-2"><a href="#cb175-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">mean.E1=</span><span class="fu">mean</span>(Exam1) )</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   mean.E1
##     &lt;dbl&gt;
## 1    85.9</code></pre>
<p>We could calculate multiple summary statistics if we like.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" tabindex="-1"></a><span class="co"># calculate the mean and standard deviation </span></span>
<span id="cb177-2"><a href="#cb177-2" tabindex="-1"></a>grades <span class="sc">%&gt;%</span> <span class="fu">summarise</span>( <span class="at">mean.E1=</span><span class="fu">mean</span>(Exam1), </span>
<span id="cb177-3"><a href="#cb177-3" tabindex="-1"></a>                      <span class="at">stddev.E1=</span><span class="fu">sd</span>(Exam1))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   mean.E1 stddev.E1
##     &lt;dbl&gt;     &lt;dbl&gt;
## 1    85.9      10.1</code></pre>
</div>
</div>
<div id="group-split-and-combine" class="section level2 hasAnchor" number="4.5">
<h2 class="hasAnchor"><span class="header-section-number">4.5</span> Group, Split, and Combine<a href="#group-split-and-combine" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="group_by-calculations-on-grouped-variables" class="section level3 hasAnchor" number="4.5.1">
<h3 class="hasAnchor"><span class="header-section-number">4.5.1</span> group_by(): calculations on grouped variables<a href="#group_by-calculations-on-grouped-variables" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Aside from unifying the syntax behind the common operations, the major strength of the <code>dplyr</code> package is the ability to split a data frame into a bunch of sub data frames, apply a sequence of one or more of the operations we just described, and then combine results back together. We’ll consider data from an experiment from spinning wool into yarn. This experiment considered two different types of wool (A or B) and three different levels of tension on the thread. The response variable is the number of breaks in the resulting yarn. For each of the 6 <code>wool:tension</code> combinations, there are 9 replicated observations.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" tabindex="-1"></a><span class="fu">data</span>(warpbreaks)</span>
<span id="cb179-2"><a href="#cb179-2" tabindex="-1"></a><span class="fu">str</span>(warpbreaks)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    54 obs. of  3 variables:
##  $ breaks : num  26 30 54 25 70 52 51 26 67 18 ...
##  $ wool   : Factor w/ 2 levels &quot;A&quot;,&quot;B&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ tension: Factor w/ 3 levels &quot;L&quot;,&quot;M&quot;,&quot;H&quot;: 1 1 1 1 1 1 1 1 1 2 ...</code></pre>
<p><img src="444_files/figure-html/unnamed-chunk-92-1.png" width="672" /></p>
<p>The first we must do is to create a data frame with additional information about how to break the data into sub data frames. In this case, I want to break the data up into the 6 wool-by-tension combinations. Initially we will just figure out how many rows are in each wool-by-tension combination.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="#cb181-1" tabindex="-1"></a><span class="co"># group_by:  what variable(s) shall we group on.</span></span>
<span id="cb181-2"><a href="#cb181-2" tabindex="-1"></a><span class="co"># n() is a function that returns how many rows are in the </span></span>
<span id="cb181-3"><a href="#cb181-3" tabindex="-1"></a><span class="co">#   currently selected sub data frame</span></span>
<span id="cb181-4"><a href="#cb181-4" tabindex="-1"></a><span class="co"># .groups tells R to drop the grouping structure after doing the summarize step</span></span>
<span id="cb181-5"><a href="#cb181-5" tabindex="-1"></a>warpbreaks <span class="sc">%&gt;%</span> </span>
<span id="cb181-6"><a href="#cb181-6" tabindex="-1"></a>  <span class="fu">group_by</span>( wool, tension) <span class="sc">%&gt;%</span>                   <span class="co"># grouping</span></span>
<span id="cb181-7"><a href="#cb181-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>(), <span class="at">.groups=</span><span class="st">&#39;drop&#39;</span>)             <span class="co"># how many in each group</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 3
##   wool  tension     n
##   &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;
## 1 A     L           9
## 2 A     M           9
## 3 A     H           9
## 4 B     L           9
## 5 B     M           9
## 6 B     H           9</code></pre>
<p>The <code>group_by</code> function takes a data.frame and returns the same data.frame, but with some extra information so that any subsequent function acts on each unique combination defined in the <code>group_by</code>. If you wish to remove this behavior, use <code>group_by()</code> or <code>ungroup()</code> to reset the grouping to have no grouping variable.</p>
<p>The <code>summarise()</code> function collapses many rows into fewer rows. a single row and therefore it is natural to update the grouping structure during the call to<code>summarise</code>. The options are to <code>drop</code> grouping completely, <code>drop_last</code> to drop the last level of grouping, <code>keep</code> the same grouping structure, or turn every row into its own group with <code>rowwise</code>.</p>
<p>For several years <code>dplyr</code> did not require the <code>.groups</code> option because <code>summarise</code> only allowed for single row results. In version <code>1.0.0</code>, a change was made to allow <code>summarise</code> to only collapse the group to <em>fewer</em> rows and that means the choice of resulting grouping should be thought about. While the default behavior to <code>drop_last</code> if all the results have 1 row makes sense, the user really should specify what the resulting grouping should be.</p>
<p>Using the same <code>summarise</code> function, we could calculate the group mean and standard deviation for each wool-by-tension group.</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="#cb183-1" tabindex="-1"></a>summary_table <span class="ot">&lt;-</span> </span>
<span id="cb183-2"><a href="#cb183-2" tabindex="-1"></a>  warpbreaks <span class="sc">%&gt;%</span> </span>
<span id="cb183-3"><a href="#cb183-3" tabindex="-1"></a>  <span class="fu">group_by</span>(wool, tension) <span class="sc">%&gt;%</span></span>
<span id="cb183-4"><a href="#cb183-4" tabindex="-1"></a>  <span class="fu">summarize</span>( <span class="at">n           =</span> <span class="fu">n</span>() ,             <span class="co"># I added some formatting to show the</span></span>
<span id="cb183-5"><a href="#cb183-5" tabindex="-1"></a>             <span class="at">mean.breaks =</span> <span class="fu">mean</span>(breaks),     <span class="co"># reader I am calculating several</span></span>
<span id="cb183-6"><a href="#cb183-6" tabindex="-1"></a>             <span class="at">sd.breaks   =</span> <span class="fu">sd</span>(breaks),       <span class="co"># statistics.</span></span>
<span id="cb183-7"><a href="#cb183-7" tabindex="-1"></a>             <span class="at">.groups =</span> <span class="st">&#39;drop&#39;</span>)               <span class="co"># drop all grouping structure</span></span>
<span id="cb183-8"><a href="#cb183-8" tabindex="-1"></a>summary_table</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   wool  tension     n mean.breaks sd.breaks
##   &lt;fct&gt; &lt;fct&gt;   &lt;int&gt;       &lt;dbl&gt;     &lt;dbl&gt;
## 1 A     L           9        44.6     18.1 
## 2 A     M           9        24        8.66
## 3 A     H           9        24.6     10.3 
## 4 B     L           9        28.2      9.86
## 5 B     M           9        28.8      9.43
## 6 B     H           9        18.8      4.89</code></pre>
<p>If instead of summarizing each split, we might want to just do some calculation and the output should have the same number of rows as the input data frame. In this case I’ll tell <code>dplyr</code> that we are mutating the data frame instead of
summarizing it. For example, suppose that I want to calculate the residual value <span class="math display">\[e_{ijk}=y_{ijk}-\bar{y}_{ij\cdot}\]</span> where <span class="math inline">\(\bar{y}_{ij\cdot}\)</span> is the mean of each <code>wool:tension</code> combination.</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="#cb185-1" tabindex="-1"></a>warpbreaks <span class="sc">%&gt;%</span> </span>
<span id="cb185-2"><a href="#cb185-2" tabindex="-1"></a>   <span class="fu">group_by</span>(wool, tension) <span class="sc">%&gt;%</span>                 <span class="co"># group by wool:tension</span></span>
<span id="cb185-3"><a href="#cb185-3" tabindex="-1"></a>   <span class="fu">mutate</span>(<span class="at">resid =</span> breaks <span class="sc">-</span> <span class="fu">mean</span>(breaks)) <span class="sc">%&gt;%</span>   <span class="co"># mean(breaks) of the group!</span></span>
<span id="cb185-4"><a href="#cb185-4" tabindex="-1"></a>   <span class="fu">head</span>(  )                                    <span class="co"># show the first couple of rows</span></span></code></pre></div>
<pre><code>## # A tibble: 6 × 4
## # Groups:   wool, tension [1]
##   breaks wool  tension  resid
##    &lt;dbl&gt; &lt;fct&gt; &lt;fct&gt;    &lt;dbl&gt;
## 1     26 A     L       -18.6 
## 2     30 A     L       -14.6 
## 3     54 A     L         9.44
## 4     25 A     L       -19.6 
## 5     70 A     L        25.4 
## 6     52 A     L         7.44</code></pre>
</div>
</div>
<div id="Exercises_IntroDataWrangling" class="section level2 hasAnchor" number="4.6">
<h2 class="hasAnchor"><span class="header-section-number">4.6</span> Exercises<a href="#Exercises_IntroDataWrangling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>The data set <code>ChickWeight</code> tracks the weights of 48 baby chickens (chicks) feed four different diets.
<ol style="list-style-type: lower-alpha">
<li><p>Load the data set using</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="#cb187-1" tabindex="-1"></a><span class="fu">data</span>(ChickWeight)</span></code></pre></div></li>
<li><p>Look at the help files for the description of the columns.</p></li>
</ol>
<ol start="3" style="list-style-type: lower-alpha">
<li>Remove all the observations except for observations from day 10 or day 20. The tough part in this instruction is distinguishing between “and” and “or”. Obviously there are no observations that occur from both day 10 AND day 20. Google ‘R logical operators’ to get an introduction to those, but the short answer is that and is <code>&amp;</code> and or is <code>|</code>.</li>
<li>Calculate the mean and standard deviation of the chick weights for each diet group on days 10 and 20.</li>
</ol></li>
<li>The OpenIntro textbook on statistics includes a data set on body dimensions.
<ol style="list-style-type: lower-alpha">
<li><p>Load the file using</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" tabindex="-1"></a>Body <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&#39;http://www.openintro.org/stat/data/bdims.csv&#39;</span>)</span></code></pre></div></li>
<li><p>The column <code>sex</code> is coded as a 1 if the individual is male and 0 if female. This is a non-intuitive labeling system. Create a new column <code>sex.MF</code> that uses labels Male and Female. Use this column for the rest of
the problem. <em>Hint: The <code>ifelse()</code> command will be very convenient here.</em></p></li>
<li><p>The columns <code>wgt</code> and <code>hgt</code> measure weight and height in kilograms and centimeters (respectively). Use these to calculate the Body Mass Index (BMI) for each individual where
<span class="math display">\[BMI=\frac{Weight\,(kg)}{\left[Height\,(m)\right]^{2}}\]</span>
Be mindful of the units used in the BMI calculation. Some unit conversion is required.</p></li>
<li><p>Double check that your calculated BMI column is correct by examining the summary statistics of the column (e.g. <code>summary(Body)</code>). BMI values should be between 18 to 40 or so. Did you make an error in your calculation?<br />
</p></li>
<li><p>The function <code>cut</code> takes a vector of continuous numerical data and creates a factor based on your given cut-points.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="#cb189-1" tabindex="-1"></a><span class="co"># Define a continuous vector to convert to a factor</span></span>
<span id="cb189-2"><a href="#cb189-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb189-3"><a href="#cb189-3" tabindex="-1"></a></span>
<span id="cb189-4"><a href="#cb189-4" tabindex="-1"></a><span class="co"># divide range of x into three groups of equal length</span></span>
<span id="cb189-5"><a href="#cb189-5" tabindex="-1"></a><span class="fu">cut</span>(x, <span class="at">breaks=</span><span class="dv">3</span>)</span></code></pre></div>
<pre><code>##  [1] (0.991,4] (0.991,4] (0.991,4] (0.991,4] (4,7]     (4,7]     (4,7]    
##  [8] (7,10]    (7,10]    (7,10]   
## Levels: (0.991,4] (4,7] (7,10]</code></pre>
<div class="sourceCode" id="cb191"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" tabindex="-1"></a><span class="co"># divide x into four groups, where I specify all 5 break points </span></span>
<span id="cb191-2"><a href="#cb191-2" tabindex="-1"></a><span class="fu">cut</span>(x, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">2.5</span>, <span class="fl">5.0</span>, <span class="fl">7.5</span>, <span class="dv">10</span>))</span></code></pre></div>
<pre><code>##  [1] (0,2.5]  (0,2.5]  (2.5,5]  (2.5,5]  (2.5,5]  (5,7.5]  (5,7.5]  (7.5,10]
##  [9] (7.5,10] (7.5,10]
## Levels: (0,2.5] (2.5,5] (5,7.5] (7.5,10]</code></pre>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" tabindex="-1"></a><span class="co"># (0,2.5] (2.5,5] means 2.5 is included in first group</span></span>
<span id="cb193-2"><a href="#cb193-2" tabindex="-1"></a><span class="co"># right=FALSE changes this to make 2.5 included in the second  </span></span>
<span id="cb193-3"><a href="#cb193-3" tabindex="-1"></a></span>
<span id="cb193-4"><a href="#cb193-4" tabindex="-1"></a><span class="co"># divide x into 3 groups, but give them a nicer</span></span>
<span id="cb193-5"><a href="#cb193-5" tabindex="-1"></a><span class="co"># set of group names</span></span>
<span id="cb193-6"><a href="#cb193-6" tabindex="-1"></a><span class="fu">cut</span>(x, <span class="at">breaks=</span><span class="dv">3</span>, <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&#39;Low&#39;</span>,<span class="st">&#39;Medium&#39;</span>,<span class="st">&#39;High&#39;</span>))</span></code></pre></div>
<pre><code>##  [1] Low    Low    Low    Low    Medium Medium Medium High   High   High  
## Levels: Low Medium High</code></pre>
<p>Create a new column of in the data frame that divides the age into decades (10-19, 20-29, 30-39, etc). Notice the oldest person in the study is 67.</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" tabindex="-1"></a>Body <span class="ot">&lt;-</span> Body <span class="sc">%&gt;%</span></span>
<span id="cb195-2"><a href="#cb195-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Age.Grp =</span> <span class="fu">cut</span>(age,</span>
<span id="cb195-3"><a href="#cb195-3" tabindex="-1"></a>                        <span class="at">breaks=</span><span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">20</span>,<span class="dv">30</span>,<span class="dv">40</span>,<span class="dv">50</span>,<span class="dv">60</span>,<span class="dv">70</span>),</span>
<span id="cb195-4"><a href="#cb195-4" tabindex="-1"></a>                        <span class="at">right=</span><span class="cn">FALSE</span>))</span></code></pre></div></li>
</ol></li>
</ol>
<ol start="6" style="list-style-type: lower-alpha">
<li>Find the average BMI for each <code>Sex.MF</code> by <code>Age.Grp</code> combination.</li>
</ol>
<ol start="3" style="list-style-type: decimal">
<li><p>Suppose we have a data frame with the following two variables:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="#cb196-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb196-2"><a href="#cb196-2" tabindex="-1"></a>  <span class="sc">~</span>SubjectID, <span class="sc">~</span>Outcome,</span>
<span id="cb196-3"><a href="#cb196-3" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&#39;good&#39;</span>,</span>
<span id="cb196-4"><a href="#cb196-4" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&#39;good&#39;</span>,</span>
<span id="cb196-5"><a href="#cb196-5" tabindex="-1"></a>  <span class="dv">1</span>, <span class="st">&#39;good&#39;</span>,</span>
<span id="cb196-6"><a href="#cb196-6" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&#39;good&#39;</span>,</span>
<span id="cb196-7"><a href="#cb196-7" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&#39;bad&#39;</span>, </span>
<span id="cb196-8"><a href="#cb196-8" tabindex="-1"></a>  <span class="dv">2</span>, <span class="st">&#39;good&#39;</span>,</span>
<span id="cb196-9"><a href="#cb196-9" tabindex="-1"></a>  <span class="dv">3</span>, <span class="st">&#39;bad&#39;</span>,</span>
<span id="cb196-10"><a href="#cb196-10" tabindex="-1"></a>  <span class="dv">4</span>, <span class="st">&#39;good&#39;</span>,</span>
<span id="cb196-11"><a href="#cb196-11" tabindex="-1"></a>  <span class="dv">4</span>, <span class="st">&#39;good&#39;</span>)</span></code></pre></div></li>
</ol>
<p>The <code>SubjectID</code> represents a particular individual that has had multiple measurements. What we want to know is what proportion of individuals were consistently <code>good</code> for all outcomes they had observed. So in our toy example set, subjects <code>1</code> and <code>4</code> where consistently good, so our answer should be <span class="math inline">\(50\%\)</span>. <em>Hint: The steps below help understand the thinking behind coding this answer.</em></p>
<ol style="list-style-type: lower-alpha">
<li><p>As a first step, we will summarize each subject with a column denotes if all the subject’s observations were <code>good</code>. This should result in a column of TRUE/FALSE values with one row for each subject. <em>The <code>all()</code> function should be quite useful here. The corresponding <code>any()</code> function is also useful to know about.</em>.</p></li>
<li><p>Calculate the proportion of subjects that where consistently good by calculating the <code>mean()</code> of the TRUE/FALSE values. <em>This works because TRUE/FALSE values are converted to 1/0 values and then averaged.</em></p></li>
</ol>
<!--chapter:end:04_Intro_to_Data_Wrangling.Rmd-->
</div>
</div>
<div id="statistical-models" class="section level1 hasAnchor" number="5">
<h1 class="hasAnchor"><span class="header-section-number">5</span> Statistical Models<a href="#statistical-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter we will focus on the introduction of the <code>broom</code> package, part of the <code>tidyverse</code> suite of packages. In general, packages used for working with model information are known as the <code>tidymodels</code> suite of packages.</p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" tabindex="-1"></a><span class="co"># Remember all of these packages can be loaded by just loading tidyverse instead!</span></span>
<span id="cb197-2"><a href="#cb197-2" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb197-3"><a href="#cb197-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb197-4"><a href="#cb197-4" tabindex="-1"></a><span class="fu">library</span>(broom)</span></code></pre></div>
<p>Dr. Sonderegger’s Video Companion: <a href="https://youtu.be/9RCo2ByHTgY">Video Lecture</a> that accompanies this chapter.</p>
<div id="introduction-to-simple-statistical-models" class="section level2 hasAnchor" number="5.1">
<h2 class="hasAnchor"><span class="header-section-number">5.1</span> Introduction to Simple Statistical Models<a href="#introduction-to-simple-statistical-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While R is a full programming language, it was first developed by statisticians for statisticians. There are several functions to do common statistical tests but because those functions were developed early in R’s history, there is some inconsistency in how those functions work. There have been some attempts to standardize modeling object interfaces, but there will always be a little weirdness. This chapter introduces you to how to build basic linear models with R and extract and use information through the <code>broom</code> package.</p>
<div id="formula-notation" class="section level3 hasAnchor" number="5.1.1">
<h3 class="hasAnchor"><span class="header-section-number">5.1.1</span> Formula Notation<a href="#formula-notation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Most statistical modeling functions rely on a formula based interface. The primary purpose is to provide a consistent way to designate which columns in a data frame are the response variable and which are the explanatory variables. In particular the notation is</p>
<p><span class="math display">\[
\underbrace{y}_{\textrm{LHS response}} \;\;\;
\underbrace{\sim}_{\textrm{is a function of}} \;\;\;
\underbrace{x}_{\textrm{RHS explanatory}}
\]</span></p>
<p>Mathematicians often refer to these terms as the <em>Left Hand Side</em> (LHS) and <em>Right Hand Side</em> (RHS). The LHS is always the response and the RHS contains the explanatory variables. In R, the LHS is usually just a single variable in the data. However, the RHS can contain multiple variables with the possibility for complex relationships.</p>
<table>
<colgroup>
<col width="36%" />
<col width="63%" />
</colgroup>
<tbody>
<tr class="odd">
<td><strong>Right Hand Side Terms</strong></td>
<td>Meaning</td>
</tr>
<tr class="even">
<td><code>x1 + x2</code></td>
<td>Both <code>x1</code> and <code>x2</code> are additive explanatory variables.
In this format, we are adding only the <em>main effects</em>
of the <code>x1</code> and <code>x2</code> variables.</td>
</tr>
<tr class="odd">
<td><code>x1:x2</code></td>
<td>This is the interaction term between <code>x1</code> and <code>x2</code></td>
</tr>
<tr class="even">
<td><code>x1 * x2</code></td>
<td>Whenever we add an interaction term to a model,
we want to also have the main effects. So this is a
short cut for adding the main effect of <code>x1</code> and <code>x2</code>
and also the interaction term <code>x1:x2</code>.</td>
</tr>
<tr class="odd">
<td><code>(x1 + x2 + x3)^2</code></td>
<td>This is the main effects of <code>x1</code>, <code>x2</code>, and <code>x3</code> and
also <em>all</em> of the second order interactions.</td>
</tr>
<tr class="even">
<td><code>poly(x, degree=2)</code></td>
<td>This fits the degree 2 polynomial. When fit like this,
R produces an orthogonal basis for the polynomial,
which is more computationally stable, but won’t be
appropriate for interpreting the polynomial
coefficients.</td>
</tr>
<tr class="odd">
<td><code>poly(x, degree=2, raw=TRUE)</code></td>
<td>This fits the degree 2 polynomial using
<span class="math inline">\(\beta_0 + \beta_1 x + \beta_2 x^2\)</span> and the polynomial
polynomial coefficients are suitable for
interpretation.</td>
</tr>
<tr class="even">
<td><code>I( x^2 )</code></td>
<td><em>Ignore</em> the usual rules for interpreting formulas
and do the mathematical calculation. This is not
necessary for things like <code>sqrt(x)</code> or <code>log(x)</code> but
required if there is a conflict between mathematics
and the formula interpretation. This is not commonly
used in modern statistical analysis.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="basic-models" class="section level2 hasAnchor" number="5.2">
<h2 class="hasAnchor"><span class="header-section-number">5.2</span> Basic Models<a href="#basic-models" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The most common statistical models are generally referred to as <em>linear models</em> and the R function for creating a linear model is <code>lm()</code>. This section will introduce how to fit the model using a data frame as well as how to fit very specific t-test models. This book can only introduce you to the concepts of linear modeling, and for further information, students are encouraged to take STA 477, STA 570, and/or STA 571.</p>
<div id="t-tests" class="section level3 hasAnchor" number="5.2.1">
<h3 class="hasAnchor"><span class="header-section-number">5.2.1</span> t-tests<a href="#t-tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>There are several variants on t-tests depending on the question of interest, but they all require a continuous response and a categorical explanatory variable with two levels. If there is an obvious pairing between an observation in the first level of the explanatory variable with an observation in the second level, then it is a <em>paired</em> t-test, otherwise it is a <em>two-sample</em> t-test. There are other variants of the t-test not described here, which lead way to the more general statistical modeling structure known as <em>ANOVA</em>.</p>
<div id="two-sample-t-tests" class="section level4 hasAnchor" number="5.2.1.1">
<h4 class="hasAnchor"><span class="header-section-number">5.2.1.1</span> Two Sample t-tests<a href="#two-sample-t-tests" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>First we’ll import data from the <code>Lock5Data</code> package that gives SAT scores and gender from 343 students in an introductory statistics class. We’ll also recode the <code>CodedSex</code> column to be more descriptive than 0 or 1. We’ll do a t-test to examine if there is evidence that males and females have a different SAT score at the college where these data were collected.</p>
<p>We should be familiar with some of the syntax below after Chapters 1 - 4, and we are starting to see how the statistical programming structure within R builds upon itself. The code chunk below imports the <em>GPAbySex</em> data set from the <code>Lock5Data</code> package, uses some <code>dplyr</code> functionality to mutate in a new easy-to-interpret <em>Gender</em> variable, and then produces a <code>ggplot2</code> graphic for a visualization of the t-test as side-by-side boxplots.</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb198-1"><a href="#cb198-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;GPAbySex&#39;</span>, <span class="at">package=</span><span class="st">&#39;Lock5Data&#39;</span>)</span>
<span id="cb198-2"><a href="#cb198-2" tabindex="-1"></a>GPAbySex <span class="ot">&lt;-</span> GPAbySex <span class="sc">%&gt;%</span></span>
<span id="cb198-3"><a href="#cb198-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Gender =</span> <span class="fu">ifelse</span>(CodedSex <span class="sc">==</span> <span class="dv">1</span>, <span class="st">&#39;Male&#39;</span>, <span class="st">&#39;Female&#39;</span>))</span>
<span id="cb198-4"><a href="#cb198-4" tabindex="-1"></a><span class="fu">ggplot</span>(GPAbySex, <span class="fu">aes</span>(<span class="at">x=</span>Gender, <span class="at">y=</span>SAT)) <span class="sc">+</span></span>
<span id="cb198-5"><a href="#cb198-5" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-104-1.png" width="672" /></p>
<p>We’ll use the function <code>t.test()</code> using the formula interface for specifying the response and the explanatory variables. The usual practice should be to save the output of the <code>t.test</code> function call (typically as an object named <code>model</code> or <code>model_1</code> or similar). Once the model has been fit, all of the important quantities have been calculated and saved and we just need to ask for them. Unfortunately, the base functions in R don’t make this particularly easy, but the <code>tidymodels</code> group of packages for building statistical models allows us to wrap all of the important information into a data frame with one row. In this case we will use the <code>broom::tidy()</code> function to extract all the important information from the resulting model object.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">t.test</span>(SAT <span class="sc">~</span> Gender, <span class="at">data=</span>GPAbySex) <span class="co"># Run default two-sample t-test</span></span>
<span id="cb199-2"><a href="#cb199-2" tabindex="-1"></a><span class="fu">print</span>(model) <span class="co"># print the summary information to the screen</span></span></code></pre></div>
<pre><code>## 
##  Welch Two Sample t-test
## 
## data:  SAT by Gender
## t = -1.4135, df = 323.26, p-value = 0.1585
## alternative hypothesis: true difference in means between group Female and group Male is not equal to 0
## 95 percent confidence interval:
##  -44.382840   7.270083
## sample estimates:
## mean in group Female   mean in group Male 
##             1195.702             1214.258</code></pre>
<div class="sourceCode" id="cb201"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(model) <span class="co"># all that information as a data frame</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 10
##   estimate estimate1 estimate2 statistic p.value parameter conf.low conf.high
##      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1    -18.6     1196.     1214.     -1.41   0.158      323.    -44.4      7.27
##   method                  alternative
##   &lt;chr&gt;                   &lt;chr&gt;      
## 1 Welch Two Sample t-test two.sided</code></pre>
<p>In the <code>t.test</code> function, the default behavior is to perform a test with a two-sided alternative and to calculate a 95% confidence interval. Those can be adjusted using the <code>alternative</code> and <code>conf.level</code> arguments. See the help
documentation for <code>t.test()</code> function to see how to adjust those.</p>
<p>The <code>t.test</code> function can also be used without using a formula by inputting a vector of response variables for the first group and a vector of response variables for the second. The following results in the same model as the formula based interface. With our budding knowledge of data frames, doing such steps is often MORE work then necessary. However, it is good to see how work is done outside of a data frame structure, although it is highly encouraged to learn the formula notation introduced above. To do the t-test without formulas and a data frame, we create two vectors that represent the STA scores of Males and SAT scores of females.</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" tabindex="-1"></a>male_SATs   <span class="ot">&lt;-</span> GPAbySex <span class="sc">%&gt;%</span> <span class="fu">filter</span>( Gender <span class="sc">==</span>   <span class="st">&#39;Male&#39;</span> ) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(SAT)</span>
<span id="cb203-2"><a href="#cb203-2" tabindex="-1"></a>female_SATs <span class="ot">&lt;-</span> GPAbySex <span class="sc">%&gt;%</span> <span class="fu">filter</span>( Gender <span class="sc">==</span> <span class="st">&#39;Female&#39;</span> ) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(SAT)</span>
<span id="cb203-3"><a href="#cb203-3" tabindex="-1"></a></span>
<span id="cb203-4"><a href="#cb203-4" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">t.test</span>( female_SATs, male_SATs ) <span class="co"># provide each vector for the t-test</span></span>
<span id="cb203-5"><a href="#cb203-5" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">tidy</span>(model) <span class="co"># all that information as a data frame</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 10
##   estimate estimate1 estimate2 statistic p.value parameter conf.low conf.high
##      &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;
## 1    -18.6     1196.     1214.     -1.41   0.158      323.    -44.4      7.27
##   method                  alternative
##   &lt;chr&gt;                   &lt;chr&gt;      
## 1 Welch Two Sample t-test two.sided</code></pre>
<p>You can see that using vectors produces the same output as the formula notation. It is important to note that the order in which the vectors are given matters, and switch the order will change the sign of many of the estimates, but not the results/conclusions of the test. The order for using formula notation is inherent to the ordering of the explanatory variable, which by default for <code>characters</code> is set to alphabetical order. This made the formula notation t-test use <code>Female</code> as the reference group, and thus for the above vector-based answer, I placed the Female SAT score first, so that the answers would agree. Vector notation is also important to learn as there are some cases, such as the paired t-tests introduced below, that don’t have a ‘nice’ way to write a simple formula to conduct the test.</p>
<p>To be clear of the results of the testing of GPA by Gender, the resulting t-test from the available <code>Lock5Data</code> suggest there is no evidence for a difference in SAT scores between Male and Female students.</p>
</div>
<div id="paired-t-tests" class="section level4 hasAnchor" number="5.2.1.2">
<h4 class="hasAnchor"><span class="header-section-number">5.2.1.2</span> Paired t-tests<a href="#paired-t-tests" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In a paired t-test, there is some mechanism for pairing observations in the two categories. For example, perhaps we observe the maximum weight lifted by a strongman competitor while wearing a weight belt vs not wearing the belt. Then we look at the difference between the weights lifted for each athlete. In the example we’ll look at here, we have the ages of 100 randomly selected married heterosexual couples from St. Lawerence County, NY. For any given man in the study, the obvious woman to compare his age to is his wife’s. So a paired test makes sense to perform. Below we do our usual steps of loading data and doing a brief exploratory analysis via a scatter graph of the Husband and Wife ages.</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&#39;MarriageAges&#39;</span>, <span class="at">package=</span><span class="st">&#39;Lock5Data&#39;</span>)</span>
<span id="cb205-2"><a href="#cb205-2" tabindex="-1"></a><span class="fu">str</span>(MarriageAges)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    105 obs. of  2 variables:
##  $ Husband: int  53 38 46 30 31 26 29 48 65 29 ...
##  $ Wife   : int  50 34 44 36 23 31 25 51 46 26 ...</code></pre>
<div class="sourceCode" id="cb207"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" tabindex="-1"></a><span class="fu">ggplot</span>(MarriageAges, <span class="fu">aes</span>(<span class="at">x=</span>Husband, <span class="at">y=</span>Wife)) <span class="sc">+</span></span>
<span id="cb207-2"><a href="#cb207-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">x=</span><span class="st">&quot;Husband&#39;s Age&quot;</span>, <span class="at">y=</span><span class="st">&quot;Wife&#39;s Age&quot;</span>)</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-107-1.png" width="672" /></p>
<p>To do a paired t-test, all we need to do is calculate the difference in age for each couple and pass that into the <code>t.test()</code> function. This is a great use for the functionality of <code>dplyr</code>.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb208-1"><a href="#cb208-1" tabindex="-1"></a>MarriageAges <span class="ot">&lt;-</span> MarriageAges <span class="sc">%&gt;%</span></span>
<span id="cb208-2"><a href="#cb208-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Age_Diff =</span> Husband <span class="sc">-</span> Wife)</span>
<span id="cb208-3"><a href="#cb208-3" tabindex="-1"></a></span>
<span id="cb208-4"><a href="#cb208-4" tabindex="-1"></a><span class="fu">t.test</span>( MarriageAges<span class="sc">$</span>Age_Diff)</span></code></pre></div>
<pre><code>## 
##  One Sample t-test
## 
## data:  MarriageAges$Age_Diff
## t = 5.8025, df = 104, p-value = 7.121e-08
## alternative hypothesis: true mean is not equal to 0
## 95 percent confidence interval:
##  1.861895 3.795248
## sample estimates:
## mean of x 
##  2.828571</code></pre>
<p>The above shows the simple t-test output from R, but we could do the typical steps of saving the model to an object and extracting information with <code>broom::tidy()</code>. Alternatively, we could pass the vector of Husband ages and the vector of Wife ages into the <code>t.test()</code> function and tell it that the data is paired so that the first husband is paired with the first wife.</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb210-1"><a href="#cb210-1" tabindex="-1"></a><span class="fu">t.test</span>( MarriageAges<span class="sc">$</span>Husband, MarriageAges<span class="sc">$</span>Wife, <span class="at">paired=</span><span class="cn">TRUE</span> )</span></code></pre></div>
<pre><code>## 
##  Paired t-test
## 
## data:  MarriageAges$Husband and MarriageAges$Wife
## t = 5.8025, df = 104, p-value = 7.121e-08
## alternative hypothesis: true mean difference is not equal to 0
## 95 percent confidence interval:
##  1.861895 3.795248
## sample estimates:
## mean difference 
##        2.828571</code></pre>
<p>Either way that the function is called, the <code>broom::tidy()</code> function could convert the printed output into a nice data frame which can then be used in further analysis. To be clear of the results of the test above, based on the <code>Lock5Data</code> provided, there is significant evidence that the Husband is older than the Wife, and on average the difference in age is 2.8 years.</p>
</div>
</div>
<div id="lm-objects" class="section level3 hasAnchor" number="5.2.2">
<h3 class="hasAnchor"><span class="header-section-number">5.2.2</span> lm objects<a href="#lm-objects" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The general linear model function <code>lm</code> is more widely used than <code>t.test</code> because <code>lm</code> can be made to perform a t-test and the general linear model allows for fitting more than one explanatory variable and those variables could be either categorical or continuous. Think of <code>lm</code> as the flexible way to build more complex linear models, but that doesn’t mean it couldn’t be used for even simple testing like a t-test!</p>
<p>The general work-flow will be to:</p>
<ol style="list-style-type: decimal">
<li>Visualize the data</li>
<li>Call <code>lm()</code> using a formula to specify the model to fit.</li>
<li>Save the results of the <code>lm()</code> to an object (<code>model</code>, <code>myModel</code>, etc.)</li>
<li>Use accessor functions to ask for pertinent quantities that have already been calculated.</li>
<li>Store prediction values and model confidence intervals for each data point in the original data frame.</li>
<li>Graph the original data along with prediction values and model confidence intervals.</li>
</ol>
<p>To explore this topic we’ll use the <code>iris</code> data set to fit a regression model to predict petal length using sepal length. The <code>iris</code> set is part of the base R package and doesn’t require prior loading to use. Lets start with a visualization <code>Sepal.Length</code> and <code>Petal.Length</code> colored by <code>species</code>. This graph should look very familiar from Chapter 3!</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length, <span class="at">color=</span>Species)) <span class="sc">+</span></span>
<span id="cb212-2"><a href="#cb212-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() </span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-110-1.png" width="672" /></p>
<p>We will now explore a more complex model, often referred to as an interaction model. In this case, we will attempt to build a predictive model of <code>Petal.Length</code> based on the observed <code>Sepal.Length</code> and <code>species</code> of iris. The formula notation below introduces the interaction term between the categorical variable <code>species</code> and numerical variable <code>Sepal.Length</code>, which in turn will allow each species of iris to have its own slope. We would fit the interaction model as such:</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" tabindex="-1"></a>model.iris <span class="ot">&lt;-</span> <span class="fu">lm</span>( Petal.Length <span class="sc">~</span> Sepal.Length <span class="sc">*</span> Species, <span class="at">data =</span> iris ) </span></code></pre></div>
<p>With the <code>model.iris</code> object saved, we can now explore the results of the model further.</p>
</div>
</div>
<div id="accessor-functions" class="section level2 hasAnchor" number="5.3">
<h2 class="hasAnchor"><span class="header-section-number">5.3</span> Accessor functions<a href="#accessor-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once a model has been fit, we want to obtain a variety of information from the model object. The way that we get most all of this information using base R commands is to call the <code>summary()</code> function which returns a list and then grab whatever we want out of that. Typically for a report, we could just print out all of the summary information and let the reader pick out the information.</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" tabindex="-1"></a><span class="fu">summary</span>(model.iris)</span></code></pre></div>
<pre><code>## 
## Call:
## lm(formula = Petal.Length ~ Sepal.Length * Species, data = iris)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -0.68611 -0.13442 -0.00856  0.15966  0.79607 
## 
## Coefficients:
##                                Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)                      0.8031     0.5310   1.512    0.133    
## Sepal.Length                     0.1316     0.1058   1.244    0.216    
## Speciesversicolor               -0.6179     0.6837  -0.904    0.368    
## Speciesvirginica                -0.1926     0.6578  -0.293    0.770    
## Sepal.Length:Speciesversicolor   0.5548     0.1281   4.330 2.78e-05 ***
## Sepal.Length:Speciesvirginica    0.6184     0.1210   5.111 1.00e-06 ***
## ---
## Signif. codes:  0 &#39;***&#39; 0.001 &#39;**&#39; 0.01 &#39;*&#39; 0.05 &#39;.&#39; 0.1 &#39; &#39; 1
## 
## Residual standard error: 0.2611 on 144 degrees of freedom
## Multiple R-squared:  0.9789, Adjusted R-squared:  0.9781 
## F-statistic:  1333 on 5 and 144 DF,  p-value: &lt; 2.2e-16</code></pre>
<p>There is a lot of information above! It is outside of the scope of the book to describe each of the coefficients in the output summary, but know that all of the output above is critical to properly interpreting the model and understanding the limitations/problems with the model. In general, the interaction model looks very promising and has high significant interaction terms - meaning that the different slopes per species is important to the model!</p>
<p>If we want to make a nice graph that includes the model’s <span class="math inline">\(R^2\)</span> value on it, we need to code some way of grabbing particular bits of information from the model fit and wrestling into a format that we can easily manipulate it. Below is a table of many elements of a model we might want to extract and how to do so with either base R or <code>tidymodels</code> commands. I often find myself using some mixture of the two in real-life work, and thus believe it is important to see how both base R and <code>tidymodels</code> behave at this juncture.</p>
<table style="width:100%;">
<colgroup>
<col width="28%" />
<col width="36%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th align="center">Goal</th>
<th align="left">Base R command</th>
<th align="left"><code>tidymodels</code> version</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">Summary table of Coefficients</td>
<td align="left"><code>summary(model)$coef</code></td>
<td align="left"><code>broom::tidy(model)</code></td>
</tr>
<tr class="even">
<td align="center">Parameter Confidence Intervals</td>
<td align="left"><code>confint(model)</code></td>
<td align="left"><code>broom::tidy(model, conf.int=TRUE)</code></td>
</tr>
<tr class="odd">
<td align="center">Rsq and Adj-Rsq</td>
<td align="left"><code>summary(model)$r.squared</code></td>
<td align="left"><code>broom::glance(model)</code></td>
</tr>
<tr class="even">
<td align="center">Model predictions</td>
<td align="left"><code>predict(model)</code></td>
<td align="left"><code>broom::augment(model, data)</code></td>
</tr>
<tr class="odd">
<td align="center">Model residuals</td>
<td align="left"><code>resid(model)</code></td>
<td align="left"><code>broom::augment(model, data)</code></td>
</tr>
<tr class="even">
<td align="center">Model predictions w/ CI</td>
<td align="left"><code>predict(model, interval='confidence')</code></td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="center">Model predictions w/ PI</td>
<td align="left"><code>predict(model, interval='prediction')</code></td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="center">ANOVA table of model fit</td>
<td align="left"><code>anova(model)</code></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<p>The package <code>broom</code> provides compact data frame based results and has three ways to interact with a model.</p>
<ul>
<li>The <code>tidy</code> command gives a nice table of the model coefficients.</li>
<li>The <code>glance</code> function gives information about how well the model fits the data overall.</li>
<li>The <code>augment</code> function adds the fitted values, residuals, and other diagnostic information to the original data frame used to generate the model. Options for the confidence or prediction intervals can be included using the <code>interval=</code> option for augment (this makes the table to wide for an htlm page).</li>
</ul>
<p>As always, see the help documentation using <code>?augment.lm</code> for more information on using these functions.</p>
<p>With a discussion of these important accessor out of the way, lets look to try and take the resulting output of <code>model.iris</code> and create an informative figure. First, we will want to attach the results of the model to the original iris data set in some fashion. The first method would be to use base R and attach the results of the <span class="math inline">\(95\%\)</span> confidence interval that data frame. This could be done using either the <code>predict()</code> function from base R or the <code>augment()</code> function from <code>broom</code>. To first visualize what these functions do, lets run them without saving objects below.</p>
<p>First, recall what the first few entries of the <code>iris</code> data set look like.</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species
## 1          5.1         3.5          1.4         0.2  setosa
## 2          4.9         3.0          1.4         0.2  setosa
## 3          4.7         3.2          1.3         0.2  setosa
## 4          4.6         3.1          1.5         0.2  setosa
## 5          5.0         3.6          1.4         0.2  setosa
## 6          5.4         3.9          1.7         0.4  setosa</code></pre>
<p>What we would like to do here is attach new columns to this data frame that relate to the resulting model. For this example we will want to attach the <span class="math inline">\(95\%\)</span> confidence interval, which commonly has three parts: 1) <code>fit</code> or <code>fitted.</code>, 2) <code>lwr</code> or <code>.lower</code> and 3) <code>upr</code> or <code>.upper</code>. The <code>fit</code> column refers the the <em>best-fit line</em>, or the expected value of the model without noise. You know this best as ‘the line that runs through the center of the data’. The confidence interval is then extracted in two parts: <code>upr</code> referring to the upper point of the interval and <code>lwr</code> referring to the lower point of the interval.</p>
<p>Lets first use the <code>broom</code> package to calculate this information using the <code>augment()</code> function. The <code>augment()</code> function takes the resulting model, along with the original data frame, and outputs a new data frame with the model information attached.</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">augment</span>(model.iris, iris, <span class="at">interval=</span><span class="st">&#39;confidence&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>## # A tibble: 6 × 13
##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species .fitted .lower
##          &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;       &lt;dbl&gt; &lt;fct&gt;     &lt;dbl&gt;  &lt;dbl&gt;
## 1          5.1         3.5          1.4         0.2 setosa     1.47   1.40
## 2          4.9         3            1.4         0.2 setosa     1.45   1.37
## 3          4.7         3.2          1.3         0.2 setosa     1.42   1.32
## 4          4.6         3.1          1.5         0.2 setosa     1.41   1.30
## 5          5           3.6          1.4         0.2 setosa     1.46   1.39
## 6          5.4         3.9          1.7         0.4 setosa     1.51   1.40
##   .upper  .resid   .hat .sigma  .cooksd .std.resid
##    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;
## 1   1.55 -0.0744 0.0215  0.262 0.000303     -0.288
## 2   1.52 -0.0480 0.0218  0.262 0.000129     -0.186
## 3   1.52 -0.122  0.0354  0.262 0.00138      -0.475
## 4   1.52  0.0914 0.0471  0.262 0.00106       0.359
## 5   1.53 -0.0612 0.0200  0.262 0.000191     -0.237
## 6   1.62  0.186  0.0455  0.262 0.00423       0.730</code></pre>
<p>Notice I am starting to get a bit trickier with my syntax, and as to not explode our screen with data output, I piped to a <code>head()</code> to show only the first 6 rows - remember this does not save the desired result to an object so I cannot use this information for later calculations! Observe that the <code>augment()</code> function includes all the information from the original <code>iris</code> data set, but now also includes columns for the best-fit line and confidence intervals. If <code>augment()</code> has one negative, it might be that it provides too many new columns, each has relevance in a statistical analysis, but for now, we have little use for the <code>.resid</code>, <code>.hat</code>, <code>.sigma</code>, <code>.coodsd</code>, and <code>.std.resid</code> columns. Just know that each of these is important in diagnosing the ‘goodness’ of the model.</p>
<p>We could gather the same information using base R commands through the <code>predict()</code> function. It is important to introduce the <code>predict()</code> function as this shows up in a variety of manners within statistical modeling. We can calculate the information for the confidence interval using the following:</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" tabindex="-1"></a><span class="fu">predict</span>(model.iris, <span class="at">interval=</span><span class="st">&#39;confidence&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code></pre></div>
<pre><code>##        fit      lwr      upr
## 1 1.474373 1.398783 1.549964
## 2 1.448047 1.371765 1.524329
## 3 1.421721 1.324643 1.518798
## 4 1.408558 1.296579 1.520536
## 5 1.461210 1.388211 1.534210
## 6 1.513863 1.403776 1.623950</code></pre>
<p>Notice though that predict doesn’t immediately attach the data to the original data frame. To attach the results of the confidence interval and best-fit line to the original iris data, we need to use some <code>dplyr</code> tools. The code below removes any previously attached <code>fit</code>, <code>lwr</code>, and <code>upr</code> columns, then binds on new columns based on the output of <code>predict()</code>. This is two steps to obtain the same information as the <code>augment()</code> command above, but can be done seamlessly in a pipeline.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" tabindex="-1"></a><span class="co"># Remove any previous model prediction values that I&#39;ve added,</span></span>
<span id="cb222-2"><a href="#cb222-2" tabindex="-1"></a><span class="co"># and then add the model predictions </span></span>
<span id="cb222-3"><a href="#cb222-3" tabindex="-1"></a>iris <span class="ot">&lt;-</span> iris <span class="sc">%&gt;%</span></span>
<span id="cb222-4"><a href="#cb222-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span><span class="fu">matches</span>(<span class="st">&#39;fit&#39;</span>), <span class="sc">-</span><span class="fu">matches</span>(<span class="st">&#39;lwr&#39;</span>), <span class="sc">-</span><span class="fu">matches</span>(<span class="st">&#39;upr&#39;</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb222-5"><a href="#cb222-5" tabindex="-1"></a>  <span class="fu">cbind</span>( <span class="fu">predict</span>(model.iris, <span class="at">newdata=</span>., <span class="at">interval=</span><span class="st">&#39;confidence&#39;</span>) )</span>
<span id="cb222-6"><a href="#cb222-6" tabindex="-1"></a><span class="fu">head</span>(iris)</span></code></pre></div>
<pre><code>##   Sepal.Length Sepal.Width Petal.Length Petal.Width Species      fit      lwr
## 1          5.1         3.5          1.4         0.2  setosa 1.474373 1.398783
## 2          4.9         3.0          1.4         0.2  setosa 1.448047 1.371765
## 3          4.7         3.2          1.3         0.2  setosa 1.421721 1.324643
## 4          4.6         3.1          1.5         0.2  setosa 1.408558 1.296579
## 5          5.0         3.6          1.4         0.2  setosa 1.461210 1.388211
## 6          5.4         3.9          1.7         0.4  setosa 1.513863 1.403776
##        upr
## 1 1.549964
## 2 1.524329
## 3 1.518798
## 4 1.520536
## 5 1.534210
## 6 1.623950</code></pre>
<p>Now that the fitted values that define the regression lines and the associated confidence interval band information have been added to the <code>iris</code> data set, we can now plot the raw data and the regression model predictions.</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">color=</span>Species)) <span class="sc">+</span></span>
<span id="cb224-2"><a href="#cb224-2" tabindex="-1"></a>  <span class="fu">geom_point</span>( <span class="fu">aes</span>(<span class="at">y=</span>Petal.Length) ) <span class="sc">+</span></span>
<span id="cb224-3"><a href="#cb224-3" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>(<span class="at">y=</span>fit) ) <span class="sc">+</span></span>
<span id="cb224-4"><a href="#cb224-4" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>( <span class="fu">aes</span>( <span class="at">ymin=</span>lwr, <span class="at">ymax=</span>upr, <span class="at">fill=</span>Species), <span class="at">alpha=</span>.<span class="dv">3</span> )   <span class="co"># alpha is the ribbon transparency</span></span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-118-1.png" width="672" /></p>
<p>Now to add the R-squared value to the graph, we need to add a simple text layer. To do that, I’ll make a data frame that has the information, and then add the x and y coordinates for where it should go.</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" tabindex="-1"></a>Rsq_string <span class="ot">&lt;-</span> </span>
<span id="cb225-2"><a href="#cb225-2" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">glance</span>(model.iris) <span class="sc">%&gt;%</span></span>
<span id="cb225-3"><a href="#cb225-3" tabindex="-1"></a>  <span class="fu">select</span>(r.squared) <span class="sc">%&gt;%</span></span>
<span id="cb225-4"><a href="#cb225-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r.squared =</span> <span class="fu">round</span>(r.squared, <span class="at">digits=</span><span class="dv">3</span>)) <span class="sc">%&gt;%</span>   <span class="co"># only 3 digits of precision</span></span>
<span id="cb225-5"><a href="#cb225-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">r.squared =</span> <span class="fu">paste</span>(<span class="st">&#39;Rsq =&#39;</span>, r.squared)) <span class="sc">%&gt;%</span>    <span class="co"># append some text before</span></span>
<span id="cb225-6"><a href="#cb225-6" tabindex="-1"></a>  <span class="fu">pull</span>(r.squared)           </span>
<span id="cb225-7"><a href="#cb225-7" tabindex="-1"></a></span>
<span id="cb225-8"><a href="#cb225-8" tabindex="-1"></a><span class="fu">ggplot</span>(iris, <span class="fu">aes</span>(<span class="at">x=</span>Sepal.Length, <span class="at">y=</span>Petal.Length, <span class="at">color=</span>Species)) <span class="sc">+</span></span>
<span id="cb225-9"><a href="#cb225-9" tabindex="-1"></a>  <span class="fu">geom_point</span>(  ) <span class="sc">+</span></span>
<span id="cb225-10"><a href="#cb225-10" tabindex="-1"></a>  <span class="fu">geom_line</span>( <span class="fu">aes</span>(<span class="at">y=</span>fit)  ) <span class="sc">+</span></span>
<span id="cb225-11"><a href="#cb225-11" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>( <span class="fu">aes</span>( <span class="at">ymin=</span>lwr, <span class="at">ymax=</span>upr, <span class="at">fill=</span>Species), <span class="at">alpha=</span>.<span class="dv">3</span> ) <span class="sc">+</span>   <span class="co"># alpha is the ribbon transparency</span></span>
<span id="cb225-12"><a href="#cb225-12" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&#39;label&#39;</span>, <span class="at">label=</span>Rsq_string, <span class="at">x=</span><span class="dv">7</span>, <span class="at">y=</span><span class="dv">2</span>, <span class="at">size=</span><span class="dv">7</span>)</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-119-1.png" width="672" /></p>
</div>
<div id="Exercises_ModelBuilding" class="section level2 hasAnchor" number="5.4">
<h2 class="hasAnchor"><span class="header-section-number">5.4</span> Exercises<a href="#Exercises_ModelBuilding" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li>Using the <code>trees</code> data frame that comes pre-installed in R, we will fit the regression model that uses the tree <code>Height</code> as a predictor to explain the <code>Volume</code> of wood harvested from the tree. We will then plot our model with some of the information of the regression model on the graph.
<ol style="list-style-type: lower-alpha">
<li>Graph the data</li>
<li>Fit a <code>lm</code> model using the command <code>model &lt;- lm(Volume ~ Height, data=trees)</code>.</li>
<li>Print out the table of coefficients with estimate names, estimated value, standard error, and upper and lower 95% confidence intervals.</li>
<li>Add the model fitted values to the <code>trees</code> data frame along with the confidence interval.</li>
<li>Graph the data including now the fitted regression line and confidence interval ribbon.</li>
<li>Add the R-squared value as an annotation to the graph.</li>
</ol></li>
<li>The data set <code>phbirths</code> from the <code>faraway</code> package contains information on birth weight, gestational length, and smoking status of mother. We’ll fit a quadratic model to predict infant birth weight using the gestational time.
<ol style="list-style-type: lower-alpha">
<li><p>Create two scatter plots of gestational length and birth weight, one for each smoking status.</p></li>
<li><p>Remove all the observations that are premature (less than 36 weeks). For the remainder of the problem, only use full-term births (greater than or equal to 36 weeks).</p></li>
<li><p>Fit the quadratic model</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(grams <span class="sc">~</span> <span class="fu">poly</span>(gestate,<span class="dv">2</span>) <span class="sc">*</span> smoke, <span class="at">data=</span>phbirths)</span></code></pre></div></li>
<li><p>Add the model fitted values to the <code>phbirths</code> data frame along with the regression model confidence intervals.</p></li>
<li><p>Improve your graph from part (a) by adding layers for the model fits and confidence interval ribbon for the model fits.</p></li>
<li><p>Create a column for the residuals in the <code>phbirths</code> data set using any of the following:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb227-1"><a href="#cb227-1" tabindex="-1"></a>phbirths<span class="sc">$</span>residuals <span class="ot">=</span> <span class="fu">resid</span>(model)</span>
<span id="cb227-2"><a href="#cb227-2" tabindex="-1"></a>phbirths <span class="ot">&lt;-</span> phbirths <span class="sc">%&gt;%</span> <span class="fu">mutate</span>( <span class="at">residuals =</span> <span class="fu">resid</span>(model) )</span>
<span id="cb227-3"><a href="#cb227-3" tabindex="-1"></a>phbirths <span class="ot">&lt;-</span> broom<span class="sc">::</span><span class="fu">augment</span>(model, phbirths)</span></code></pre></div></li>
<li><p>Create a histogram of the residuals.</p></li>
</ol></li>
</ol>
<!--chapter:end:05_Model_Building.Rmd-->
</div>
</div>
<div id="flow-control" class="section level1 hasAnchor" number="6">
<h1 class="hasAnchor"><span class="header-section-number">6</span> Flow &amp; Control<a href="#flow-control" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this chapter we will study the importance of flow and control in computer programming. Most of the information of this chapter is from base R functionality, but as usual, we will leverage some parts of the <code>tivdyverse</code>.</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p>Dr. Sonderegger’s Video Companion: <a href="https://youtu.be/bPZKP_yYFLo">Video Lecture</a>.</p>
<div id="control-and-flow" class="section level2 hasAnchor" number="6.1">
<h2 class="hasAnchor"><span class="header-section-number">6.1</span> Control and Flow<a href="#control-and-flow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often it is necessary to write scripts that perform different action depending on the data or to automate a task that must be repeated many times. To address these issues we will introduce the <code>if</code> statement and its closely related cousin <code>ifelse</code>. To address repeated tasks we will define two types of loops, a <code>while</code> loop and a <code>for</code> loop.</p>
<p>Although control may not immediately seem important in code, the uses for it become exponentially more important as the complexity of code grows. Control allows an individual to quickly turn on and off features of a function, easily run immense amounts of code with minimal syntax, provide improved functionality by catching errors before they occur, and so many other elements we are slowing growing into throughout this book. Control is the building block to make code that is functional, easy-to-use, and free of erroneous components that may otherwise cause users to struggle to get the desired output.</p>
</div>
<div id="logical-expressions" class="section level2 hasAnchor" number="6.2">
<h2 class="hasAnchor"><span class="header-section-number">6.2</span> Logical Expressions<a href="#logical-expressions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The most common logical expressions are the numerical expressions you have study in a mathematics course and include <code>&lt;</code>, <code>&lt;=</code>, <code>==</code>, <code>!=</code>, <code>&gt;=</code>, <code>&gt;</code>. These are the usual logical comparisons from mathematics, with <code>!=</code> being the <em>not equal</em> comparison. For any logical value or vector of values, the <code>!</code> flips the logical values.</p>
<div class="sourceCode" id="cb229"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>, <span class="at">B=</span><span class="dv">6</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb229-2"><a href="#cb229-2" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   A B
## 1 1 6
## 2 2 5
## 3 3 4
## 4 4 3
## 5 5 2
## 6 6 1</code></pre>
<div class="sourceCode" id="cb231"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="st">`</span><span class="at">A==3?</span><span class="st">`</span>         <span class="ot">=</span>  A <span class="sc">==</span> <span class="dv">3</span>,</span>
<span id="cb231-2"><a href="#cb231-2" tabindex="-1"></a>              <span class="st">`</span><span class="at">A!=3?</span><span class="st">`</span>         <span class="ot">=</span>  A <span class="sc">!=</span> <span class="dv">3</span>,</span>
<span id="cb231-3"><a href="#cb231-3" tabindex="-1"></a>              <span class="st">`</span><span class="at">A&lt;=3?</span><span class="st">`</span>         <span class="ot">=</span>  A <span class="sc">&lt;=</span> <span class="dv">3</span> )</span></code></pre></div>
<pre><code>##   A B A==3? A!=3? A&lt;=3?
## 1 1 6 FALSE  TRUE  TRUE
## 2 2 5 FALSE  TRUE  TRUE
## 3 3 4  TRUE FALSE  TRUE
## 4 4 3 FALSE  TRUE FALSE
## 5 5 2 FALSE  TRUE FALSE
## 6 6 1 FALSE  TRUE FALSE</code></pre>
<p>If we have two (or more) vectors of logical values, we can do two <em>pairwise</em> operations. The “and” operator <code>&amp;</code> will result in a TRUE value if all elements are TRUE. The “or” operator <code>|</code> will result in a TRUE value if any elements are TRUE.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">C =</span> A<span class="sc">&gt;=</span><span class="dv">5</span>,  <span class="at">D =</span> B<span class="sc">&lt;=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span></span>
<span id="cb233-2"><a href="#cb233-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">result1_and =</span> C <span class="sc">&amp;</span> D,  <span class="co">#    C and D both true</span></span>
<span id="cb233-3"><a href="#cb233-3" tabindex="-1"></a>          <span class="at">result2_or =</span> C <span class="sc">|</span> D)   <span class="co">#    C or D true</span></span></code></pre></div>
<pre><code>##   A B     C     D result1_and result2_or
## 1 1 6 FALSE FALSE       FALSE      FALSE
## 2 2 5 FALSE FALSE       FALSE      FALSE
## 3 3 4 FALSE  TRUE       FALSE       TRUE
## 4 4 3 FALSE  TRUE       FALSE       TRUE
## 5 5 2  TRUE  TRUE        TRUE       TRUE
## 6 6 1  TRUE  TRUE        TRUE       TRUE</code></pre>
<p>Next we can summarize a vector of logical values using <code>any()</code>, <code>all()</code>, and <code>which()</code>. <code>any()</code> looks for at least one TRUE, <code>all()</code> requires all elements to be TRUE, <code>which()</code> provides the location of the TRUE elements.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" tabindex="-1"></a><span class="fu">any</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">&lt;=</span> <span class="dv">7</span> )   <span class="co"># Should return TRUE because there are two TRUE results</span></span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" tabindex="-1"></a><span class="fu">all</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">&lt;=</span> <span class="dv">7</span> )   <span class="co"># Should return FALSE because there is at least one FALSE result</span></span></code></pre></div>
<pre><code>## [1] FALSE</code></pre>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" tabindex="-1"></a><span class="fu">which</span>(<span class="dv">6</span><span class="sc">:</span><span class="dv">10</span> <span class="sc">&lt;=</span> <span class="dv">7</span>) <span class="co"># return the indices of the TRUE values</span></span></code></pre></div>
<pre><code>## [1] 1 2</code></pre>
<p>Finally, we often need to figure out if a character string is in some set of values. Here we create a small data frame with a letter index (maybe a indicator or categorical group variable) and assign a random value to each. We can then use the operator <code>%in%</code> to search through the vector <code>Type</code> and return all elements that match elements within our search vector (here we are searching for the <code>A</code> and <code>B</code> categories).</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="#cb241-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">Type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;C&#39;</span>,<span class="st">&#39;D&#39;</span>), <span class="at">times=</span><span class="dv">2</span>), <span class="at">Value=</span><span class="fu">rnorm</span>(<span class="dv">8</span>) )</span>
<span id="cb241-2"><a href="#cb241-2" tabindex="-1"></a>df</span></code></pre></div>
<pre><code>##   Type       Value
## 1    A  0.59402990
## 2    B  0.05041084
## 3    C  0.61352322
## 4    D  0.37585796
## 5    A  1.59620506
## 6    B -1.15972350
## 7    C  0.52400185
## 8    D -0.47470014</code></pre>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="#cb243-1" tabindex="-1"></a><span class="co"># df %&gt;% filter( Type == &#39;A&#39; | Type == &#39;B&#39; )</span></span>
<span id="cb243-2"><a href="#cb243-2" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">filter</span>( Type <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>) )   <span class="co"># Only rows with Type == &#39;A&#39; or Type ==&#39;B&#39;</span></span></code></pre></div>
<pre><code>##   Type       Value
## 1    A  0.59402990
## 2    B  0.05041084
## 3    A  1.59620506
## 4    B -1.15972350</code></pre>
</div>
<div id="decision-statements" class="section level2 hasAnchor" number="6.3">
<h2 class="hasAnchor"><span class="header-section-number">6.3</span> Decision statements<a href="#decision-statements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="simplified-dplyr-wrangling" class="section level3 hasAnchor" number="6.3.1">
<h3 class="hasAnchor"><span class="header-section-number">6.3.1</span> Simplified <code>dplyr</code> wrangling<a href="#simplified-dplyr-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A very common task within a data wrangling pipeline is to create a new column that recodes information in another column. Consider the following data frame that has name, gender, and political party affiliation of six individuals. In this example, we’ve coded male/female as 1/0 and political party as 1,2,3 for democratic, republican, and independent. These codings are not very readable, but this is a common way data is stored, often with a ‘key’ that informs the user what the number codings mean.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="#cb245-1" tabindex="-1"></a>people <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb245-2"><a href="#cb245-2" tabindex="-1"></a>  <span class="at">name =</span> <span class="fu">c</span>(<span class="st">&#39;Barack&#39;</span>,<span class="st">&#39;Michelle&#39;</span>, <span class="st">&#39;George&#39;</span>, <span class="st">&#39;Laura&#39;</span>, <span class="st">&#39;Bernie&#39;</span>, <span class="st">&#39;Deborah&#39;</span>),</span>
<span id="cb245-3"><a href="#cb245-3" tabindex="-1"></a>  <span class="at">gender =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb245-4"><a href="#cb245-4" tabindex="-1"></a>  <span class="at">party =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>)</span>
<span id="cb245-5"><a href="#cb245-5" tabindex="-1"></a>)</span>
<span id="cb245-6"><a href="#cb245-6" tabindex="-1"></a>people</span></code></pre></div>
<pre><code>##       name gender party
## 1   Barack      1     1
## 2 Michelle      0     1
## 3   George      1     2
## 4    Laura      0     2
## 5   Bernie      1     3
## 6  Deborah      0     3</code></pre>
<p>The command <code>ifelse()</code> works quite well within a <code>dplyr::mutate()</code> command and it responds correctly to vectors. We used this briefly in Chapter 4 without much discussion, but are now ready to use this as an important tool to improve the readability of our variable levels. The syntax is <code>ifelse( logical.expression, TrueValue, FalseValue )</code>. The return object of this function is a vector that is appropriately made up of the TRUE and FALSE results. We will see some tricks of this function as we work through the chapter and exercises.</p>
<p>For example, lets take the column <code>gender</code> and for each row test to see if the value is <code>0</code>. If it is, the resulting element is <code>Female</code> otherwise it is <code>Male</code>.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="#cb247-1" tabindex="-1"></a>people <span class="ot">&lt;-</span> people <span class="sc">%&gt;%</span></span>
<span id="cb247-2"><a href="#cb247-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">gender2 =</span> <span class="fu">ifelse</span>( gender <span class="sc">==</span> <span class="dv">0</span>, <span class="st">&#39;Female&#39;</span>, <span class="st">&#39;Male&#39;</span>) )</span>
<span id="cb247-3"><a href="#cb247-3" tabindex="-1"></a>people</span></code></pre></div>
<pre><code>##       name gender party gender2
## 1   Barack      1     1    Male
## 2 Michelle      0     1  Female
## 3   George      1     2    Male
## 4    Laura      0     2  Female
## 5   Bernie      1     3    Male
## 6  Deborah      0     3  Female</code></pre>
<p>To do something similar for the case where we have 3 or more categories, we could use the <code>ifelse()</code> command repeatedly to address each category level separately. However, because the <code>ifelse()</code> command is limited to just two cases, we may have to use it many times, keep track to properly not override previous iterations. In these cases, it is better to use a generalization of the <code>ifelse()</code> function that operates on multiple categories. The <code>dplyr::case_when</code> function is that generalization. The syntax is <code>case_when( logicalExpression1~Value1, logicalExpression2~Value2, ... )</code>. We can have as many <code>LogicalExpression ~ Value</code> pairs as we want. As a note, I often find myself using this when recoding large data sets that contain, for example, many different patient diseases that come with simple codings. When I prepare graphs, I want the proper full names showing, and not just a simple code that may not be obvious to all readers. The <code>case_when()</code> function allows me to accomplish this, and I think of it as a ‘mapping’ that takes many different simple codes and outputs a vector with proper disease names. Below we use the <code>case_when()</code> function to deal with renaming the three political parties.</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="#cb249-1" tabindex="-1"></a>people <span class="ot">&lt;-</span> people <span class="sc">%&gt;%</span></span>
<span id="cb249-2"><a href="#cb249-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">party2 =</span> <span class="fu">case_when</span>( party <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">&#39;Democratic&#39;</span>, </span>
<span id="cb249-3"><a href="#cb249-3" tabindex="-1"></a>                              party <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">&#39;Republican&#39;</span>, </span>
<span id="cb249-4"><a href="#cb249-4" tabindex="-1"></a>                              party <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">&#39;Independent&#39;</span>,</span>
<span id="cb249-5"><a href="#cb249-5" tabindex="-1"></a>                              <span class="cn">TRUE</span>       <span class="sc">~</span> <span class="st">&#39;None Stated&#39;</span> ) )</span>
<span id="cb249-6"><a href="#cb249-6" tabindex="-1"></a>people</span></code></pre></div>
<pre><code>##       name gender party gender2      party2
## 1   Barack      1     1    Male  Democratic
## 2 Michelle      0     1  Female  Democratic
## 3   George      1     2    Male  Republican
## 4    Laura      0     2  Female  Republican
## 5   Bernie      1     3    Male Independent
## 6  Deborah      0     3  Female Independent</code></pre>
<p>Often the last case is a catch all where the logical expression will ALWAYS evaluate to TRUE and this is the value for all other inputs that weren’t properly managed previously. As another alternative to the problem of recoding factor levels, we could use the command <code>forcats::fct_recode()</code> function. Chapter 7 - Factors provides more details about this function, but it operates similarly to the <code>dplyr:case_when()</code>, but specifically for data of the factor type.</p>
</div>
<div id="base-if-else-statements" class="section level3 hasAnchor" number="6.3.2">
<h3 class="hasAnchor"><span class="header-section-number">6.3.2</span> Base <code>if else</code> statements<a href="#base-if-else-statements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>While programming, I often need to perform expressions that are more complicated than what the <code>ifelse()</code> command can do. Remember, the <code>ifelse()</code> command only can produce a vector. For any logic that is more complicated than simply producing an output vector, we’ll need a more flexible approach. The downside is that it is slightly more complicated to use and <em>does not</em> automatically handle vector inputs. The upside is that we can produce long chains of <code>if</code> then <code>else</code> statements, provide significant control over the output.</p>
<p>The general format of an <code>if</code> or an <code>if else</code> is presented below:.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="#cb251-1" tabindex="-1"></a><span class="co"># Simplest version</span></span>
<span id="cb251-2"><a href="#cb251-2" tabindex="-1"></a><span class="cf">if</span>( logical.test ){ <span class="co"># The logical test must be a SINGLE TRUE/FALSE value</span></span>
<span id="cb251-3"><a href="#cb251-3" tabindex="-1"></a>  expression        <span class="co"># The expression could be many lines of code</span></span>
<span id="cb251-4"><a href="#cb251-4" tabindex="-1"></a>}</span>
<span id="cb251-5"><a href="#cb251-5" tabindex="-1"></a></span>
<span id="cb251-6"><a href="#cb251-6" tabindex="-1"></a><span class="co"># Including the optional else</span></span>
<span id="cb251-7"><a href="#cb251-7" tabindex="-1"></a><span class="cf">if</span>( logical.test ){</span>
<span id="cb251-8"><a href="#cb251-8" tabindex="-1"></a>  expression</span>
<span id="cb251-9"><a href="#cb251-9" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb251-10"><a href="#cb251-10" tabindex="-1"></a>  expression</span>
<span id="cb251-11"><a href="#cb251-11" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>else</code> portion is optional and allows you to control what happens if the <code>logical.test</code> returns FALSE. In some cases you might want nothing to happen, in which case no <code>else</code> statement is required. In other cases, you may want to continue exploring possible options or execute a different unique code chunk. The <code>else</code> statement can even be another <code>if</code> command, requiring further logicals to be evaluated prior to output!</p>
<p>Suppose that I have a piece of code that generates a single random variable from the Binomial distribution. This can be thought of as a flipping a coin (a fair coin if we set <code>p = 0.5</code>). We would like to label it head or tails instead of one or zero.</p>
<p>If the <code>logical.test</code> expression inside the <code>if()</code> is evaluates to TRUE, then the subsequent statement is executed. If the <code>logical.test</code> evaluates instead to FALSE, the next statement is skipped. The way the R language is defined, only the first statement after the <code>if()</code> is executed depending on the <code>logical.test</code>. If we want multiple statements to be executed (or skipped), we will wrap those expressions in curly brackets <code>{ }</code>. I find it easier to follow the <code>if else</code> logic when I see the curly brackets so I use them even when there is only one expression to be executed (they are not strictly required, so sometimes I get lazy if the resulting expression is a single line of code). Also notice that the RStudio editor indents the code that might be skipped to try help give you a hint that it will be conditionally evaluated.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" tabindex="-1"></a><span class="co"># Flip the coin, and we get a 0 or 1</span></span>
<span id="cb252-2"><a href="#cb252-2" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">rbinom</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">prob=</span><span class="fl">0.5</span>)</span>
<span id="cb252-3"><a href="#cb252-3" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" tabindex="-1"></a><span class="co"># convert the 0/1 to Tail/Head</span></span>
<span id="cb254-2"><a href="#cb254-2" tabindex="-1"></a><span class="cf">if</span>( result <span class="sc">==</span> <span class="dv">0</span> ){</span>
<span id="cb254-3"><a href="#cb254-3" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="st">&#39;Tail&#39;</span></span>
<span id="cb254-4"><a href="#cb254-4" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Output from the if() statement, this means we saw a Tail! &quot;</span>)</span>
<span id="cb254-5"><a href="#cb254-5" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb254-6"><a href="#cb254-6" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="st">&#39;Head&#39;</span></span>
<span id="cb254-7"><a href="#cb254-7" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&quot;Output ffrom the else() statement, this means we saw a Head!&quot;</span>) </span>
<span id="cb254-8"><a href="#cb254-8" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;Output ffrom the else() statement, this means we saw a Head!&quot;</code></pre>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="#cb256-1" tabindex="-1"></a>result</span></code></pre></div>
<pre><code>## [1] &quot;Head&quot;</code></pre>
<p>Try running the code chunk above many times - the output in the textbook will be completely random if it is showing heads or tails! Notice as you run the code chunk over and over that in the Environment tab in RStudio (default location is the upper right corner), the value of the variable <code>result</code> changes as you execute the code repeatedly.</p>
<p>To provide a more statistically interesting example of when we might use an <code>if else</code> statement, consider the calculation of a p-value in a 1-sample t-test with a two-sided alternative. If you are unfamiliar with this calculation, the area is found based on the ‘sign’ (positive/negative) of the corresponding test statistic. The calculation can be summarized as:</p>
<ul>
<li><p>If the test statistic t is negative, then p-value = <span class="math inline">\(2*P\left(T_{df} \le t \right)\)</span></p></li>
<li><p>If the test statistic t is positive, then p-value = <span class="math inline">\(2*P\left(T_{df} \ge t \right)\)</span>.</p></li>
</ul>
<p>Below provides code that executes the proper calculation by checking the sign of the test statistic (t). You again may want to run this code chunk many times and watch what changes as the value of <code>t</code> changes! You’ll notice that <code>t</code> jumps around the value of zero randomly, being positive or negative with roughly <span class="math inline">\(50\%\)</span> probability, yet the p-value is properly calculated each time! The larger the magnitude of <code>t</code> (that is, the absolute value of <code>t</code>), the smaller the corresponding p-value.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="#cb258-1" tabindex="-1"></a><span class="co"># create some fake data</span></span>
<span id="cb258-2"><a href="#cb258-2" tabindex="-1"></a>n  <span class="ot">&lt;-</span> <span class="dv">20</span>   <span class="co"># suppose this had a sample size of 20</span></span>
<span id="cb258-3"><a href="#cb258-3" tabindex="-1"></a>x  <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean=</span><span class="dv">2</span>, <span class="at">sd=</span><span class="dv">1</span>)</span>
<span id="cb258-4"><a href="#cb258-4" tabindex="-1"></a></span>
<span id="cb258-5"><a href="#cb258-5" tabindex="-1"></a><span class="co"># testing H0: mu = 0  vs Ha: mu =/= 0</span></span>
<span id="cb258-6"><a href="#cb258-6" tabindex="-1"></a>t  <span class="ot">&lt;-</span> ( <span class="fu">mean</span>(x) <span class="sc">-</span> <span class="dv">2</span> ) <span class="sc">/</span> ( <span class="fu">sd</span>(x)<span class="sc">/</span><span class="fu">sqrt</span>(n) )</span>
<span id="cb258-7"><a href="#cb258-7" tabindex="-1"></a>df <span class="ot">&lt;-</span> n<span class="dv">-1</span></span>
<span id="cb258-8"><a href="#cb258-8" tabindex="-1"></a><span class="cf">if</span>( t <span class="sc">&lt;</span> <span class="dv">0</span> ){</span>
<span id="cb258-9"><a href="#cb258-9" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(t, df)</span>
<span id="cb258-10"><a href="#cb258-10" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb258-11"><a href="#cb258-11" tabindex="-1"></a>  p.value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pt</span>(t, df))</span>
<span id="cb258-12"><a href="#cb258-12" tabindex="-1"></a>}</span>
<span id="cb258-13"><a href="#cb258-13" tabindex="-1"></a></span>
<span id="cb258-14"><a href="#cb258-14" tabindex="-1"></a><span class="co"># print the resulting p-value</span></span>
<span id="cb258-15"><a href="#cb258-15" tabindex="-1"></a>p.value</span></code></pre></div>
<pre><code>## [1] 0.9490959</code></pre>
<p>This sort of logic is necessary for the calculation of p-values and something similar is found somewhere inside the <code>t.test()</code> function.</p>
</div>
<div id="nested-if-else-statements" class="section level3 hasAnchor" number="6.3.3">
<h3 class="hasAnchor"><span class="header-section-number">6.3.3</span> Nested <code>if else</code> statements<a href="#nested-if-else-statements" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Finally we can nest <code>if else</code> statements together to allow you to write code that has many different execution routes. The example below random generates a number between 0 and 5 and then strictly rounds UP (this is known as the <code>ceiling()</code>). Depending on the number drawn, the output changes! Again - try it many times to see how ti works, and see how the value of <code>rand.numb</code> changes in the Environment tab of RStudio.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="#cb260-1" tabindex="-1"></a><span class="co"># randomly grab a number between [0,5] and round it up to 1,2,3,4,5</span></span>
<span id="cb260-2"><a href="#cb260-2" tabindex="-1"></a>rand.numb <span class="ot">&lt;-</span> <span class="fu">ceiling</span>( <span class="fu">runif</span>(<span class="dv">1</span>,<span class="dv">0</span>,<span class="dv">5</span>) )  </span>
<span id="cb260-3"><a href="#cb260-3" tabindex="-1"></a><span class="cf">if</span>( rand.numb <span class="sc">==</span> <span class="dv">1</span> ){</span>
<span id="cb260-4"><a href="#cb260-4" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&#39;We got a 1!&#39;</span>)</span>
<span id="cb260-5"><a href="#cb260-5" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>( rand.numb <span class="sc">==</span> <span class="dv">2</span> ){</span>
<span id="cb260-6"><a href="#cb260-6" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&#39;A 2 was observed!&#39;</span>)</span>
<span id="cb260-7"><a href="#cb260-7" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>( rand.numb <span class="sc">==</span> <span class="dv">3</span> ){</span>
<span id="cb260-8"><a href="#cb260-8" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&#39;The number 3 was drawn!&#39;</span>)</span>
<span id="cb260-9"><a href="#cb260-9" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb260-10"><a href="#cb260-10" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">&#39;This was either a 4 or 5, not quite sure!&#39;</span>)</span>
<span id="cb260-11"><a href="#cb260-11" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;A 2 was observed!&quot;</code></pre>
</div>
</div>
<div id="loops" class="section level2 hasAnchor" number="6.4">
<h2 class="hasAnchor"><span class="header-section-number">6.4</span> Loops<a href="#loops" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is often desirable to write code that does the same thing over and over, relieving you of the burden of repetitive tasks. To do this we’ll need a way to tell the computer to repeat some section of code over and over. However, we’ll
more then likely want something small to change each time through the loop. Loops give us a way to execute the same code many times, changing something slightly each ‘iteration’ of the loop, and provide the computer either how many times to run the loop or a condition for when to stop repeating.</p>
<div id="while-loops" class="section level3 hasAnchor" number="6.4.1">
<h3 class="hasAnchor"><span class="header-section-number">6.4.1</span> <code>while</code> Loops<a href="#while-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The basic form of a <code>while</code> loop is as follows:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="#cb262-1" tabindex="-1"></a><span class="co"># while loop with multiple lines to be repeated</span></span>
<span id="cb262-2"><a href="#cb262-2" tabindex="-1"></a><span class="cf">while</span>( logical.test ){</span>
<span id="cb262-3"><a href="#cb262-3" tabindex="-1"></a>  expression1      <span class="co"># you can have as much code here as neccassary!</span></span>
<span id="cb262-4"><a href="#cb262-4" tabindex="-1"></a>  expression2</span>
<span id="cb262-5"><a href="#cb262-5" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Be warned now</strong> that <code>while</code> loops require that the conditions within the <code>logical.test</code> are updated within the loop, in the above this is include as something like <code>expression2</code> changing the value within the <code>logical.test</code>. If this doesn’t happen, then welcome to the world of infinite looping, something we would like to avoid!</p>
<p>The computer will first evaluate the test expression <code>logical.test</code>. If it is TRUE, it will execute the code within the <code>while</code> loop, denoted above as <code>expression1</code> and <code>expression2</code>. When the code within the loop is completed, evaluation returns to the beginning of the <code>while</code> loop and evaluates the <code>logical.test</code> again. If it is still TRUE, the loop will execute again. This continues until the <code>logical.test</code> finally evaluates as FALSE. Hence the warning above. Below is a little code chunk that doubles the value of <code>x</code> each iteration, and eventually <code>x</code> becomes <span class="math inline">\(100\)</span> or greater, and the loop stops. If you run the code chunk below, notice that the final value of <code>x</code> is set to <span class="math inline">\(128\)</span>, which fails the condition <code>x &lt; 100</code>.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="#cb263-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb263-2"><a href="#cb263-2" tabindex="-1"></a><span class="cf">while</span>( x <span class="sc">&lt;</span> <span class="dv">100</span> ){</span>
<span id="cb263-3"><a href="#cb263-3" tabindex="-1"></a>  <span class="fu">print</span>( <span class="fu">paste</span>(<span class="st">&quot;In loop and x is now:&quot;</span>, x) )  <span class="co"># print out current value of x</span></span>
<span id="cb263-4"><a href="#cb263-4" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>x</span>
<span id="cb263-5"><a href="#cb263-5" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;In loop and x is now: 1&quot;
## [1] &quot;In loop and x is now: 2&quot;
## [1] &quot;In loop and x is now: 4&quot;
## [1] &quot;In loop and x is now: 8&quot;
## [1] &quot;In loop and x is now: 16&quot;
## [1] &quot;In loop and x is now: 32&quot;
## [1] &quot;In loop and x is now: 64&quot;</code></pre>
<p>It is very common to forget to update the variable used in the test expression. In that case the test expression will never be FALSE and the computer will never stop. This unfortunate situation is called an <em>infinite loop</em>. Avoid ever letting this happen - you have now been warned twice!</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="#cb265-1" tabindex="-1"></a><span class="co"># Example of an infinite loop!  Do not Run!</span></span>
<span id="cb265-2"><a href="#cb265-2" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb265-3"><a href="#cb265-3" tabindex="-1"></a><span class="cf">while</span>( x <span class="sc">&lt;</span> <span class="dv">10</span> ){</span>
<span id="cb265-4"><a href="#cb265-4" tabindex="-1"></a>  <span class="fu">print</span>(x) <span class="co"># x stays 1 forever and the logical test never fails!</span></span>
<span id="cb265-5"><a href="#cb265-5" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="for-loops" class="section level3 hasAnchor" number="6.4.2">
<h3 class="hasAnchor"><span class="header-section-number">6.4.2</span> <code>for</code> Loops<a href="#for-loops" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Often we know ahead of time exactly how many times we should go through the loop or can control the numbers of times based on the values within a vector of interest. We could use a <code>while</code> loop, but there more specific construct called a <code>for</code> loop that is useful for execution of code a <em>known</em> number of times.</p>
<p>The format of a for loop is as follows:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="#cb266-1" tabindex="-1"></a><span class="cf">for</span>( index <span class="cf">in</span> vector ){</span>
<span id="cb266-2"><a href="#cb266-2" tabindex="-1"></a>  expression1</span>
<span id="cb266-3"><a href="#cb266-3" tabindex="-1"></a>  expression2</span>
<span id="cb266-4"><a href="#cb266-4" tabindex="-1"></a>}</span></code></pre></div>
<p>The <code>index</code> variable will take on each value in <code>vector</code> in succession and the next statement will be evaluated. As always, the statement can be multiple statements wrapped in curly brackets {} and include as much code as neccassary to get the job done. Notice how the statement below changes as the <code>for</code> loop is executed.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="#cb267-1" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> ){</span>
<span id="cb267-2"><a href="#cb267-2" tabindex="-1"></a>  <span class="fu">print</span>( <span class="fu">paste</span>(<span class="st">&quot;In the loop and current value is i =&quot;</span>, i) )</span>
<span id="cb267-3"><a href="#cb267-3" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] &quot;In the loop and current value is i = 1&quot;
## [1] &quot;In the loop and current value is i = 2&quot;
## [1] &quot;In the loop and current value is i = 3&quot;
## [1] &quot;In the loop and current value is i = 4&quot;
## [1] &quot;In the loop and current value is i = 5&quot;</code></pre>
<p>What is happening is that <code>i</code> starts out as the first element of the vector <code>c(1,2,3,4,5)</code>, in this case, <code>i</code> starts out as 1. After <code>i</code> is assigned, the statements in the curly brackets are then evaluated. Once all code within those statements is executed , <code>i</code> is reassigned to the next element of the vector. This process is repeated until <code>i</code> has been assigned to each
element of the given vector. Although traditionally we use <code>i</code> and <code>j</code> and the index variable, R is a flexible language that will allow you to use any <em>object</em> as your iterator.</p>
<p>While the recipe above is the minimal definition of a <code>for</code> loop, there is often a bit more set up to create a <em>result</em> vector or data frame that will store the steps of the <code>for</code> loop. We don’t typically want to print text to the screen, but store the output of a calculation into an object for later use. The code below shows an outline of how we might create a <code>result</code> object that will contain the output of our code.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="#cb269-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span> </span>
<span id="cb269-2"><a href="#cb269-2" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="cn">NULL</span>     <span class="co"># Make a place to store each step of the for loop</span></span>
<span id="cb269-3"><a href="#cb269-3" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>N ){</span>
<span id="cb269-4"><a href="#cb269-4" tabindex="-1"></a>  <span class="co"># Perhaps some code that calculates something</span></span>
<span id="cb269-5"><a href="#cb269-5" tabindex="-1"></a>  result[i] <span class="ot">&lt;-</span>  <span class="co"># something </span></span>
<span id="cb269-6"><a href="#cb269-6" tabindex="-1"></a>}</span></code></pre></div>
<p>We can use this loop to calculate the first <span class="math inline">\(10\)</span> elements of the Fibonacci sequence. Recall that the Fibonacci sequence is defined by <span class="math inline">\(F_{i}=F_{i-1}+F_{i-2}\)</span> with two starting conditions <span class="math inline">\(F_{1}=0\)</span> and <span class="math inline">\(F_{2}=1\)</span>. Although for clarity of the book the object <code>F</code> is output to screen with the <code>print()</code> function, notice by running the code in your own terminal, you will end up with an <code>F</code> object that stores the first <span class="math inline">\(10\)</span> Fibonacci numbers.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="#cb270-1" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">10</span>                <span class="co"># How many Fibonacci numbers to create</span></span>
<span id="cb270-2"><a href="#cb270-2" tabindex="-1"></a>F <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>)         <span class="co"># initialize a vector of zeros</span></span>
<span id="cb270-3"><a href="#cb270-3" tabindex="-1"></a>F[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">0</span>              <span class="co"># F[1]  should be zero</span></span>
<span id="cb270-4"><a href="#cb270-4" tabindex="-1"></a>F[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">1</span>              <span class="co"># F[2]  should be 1</span></span>
<span id="cb270-5"><a href="#cb270-5" tabindex="-1"></a><span class="fu">print</span>(F)               <span class="co"># Show the value of F before the loop </span></span></code></pre></div>
<pre><code>## [1] 0 1</code></pre>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="#cb272-1" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">3</span><span class="sc">:</span>N ){</span>
<span id="cb272-2"><a href="#cb272-2" tabindex="-1"></a>  F[i] <span class="ot">&lt;-</span> F[i<span class="dv">-1</span>] <span class="sc">+</span> F[i<span class="dv">-2</span>] <span class="co"># define based on the prior two values</span></span>
<span id="cb272-3"><a href="#cb272-3" tabindex="-1"></a>  <span class="fu">print</span>(F)                <span class="co"># show F at each step of the loop</span></span>
<span id="cb272-4"><a href="#cb272-4" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## [1] 0 1 1
## [1] 0 1 1 2
## [1] 0 1 1 2 3
## [1] 0 1 1 2 3 5
## [1] 0 1 1 2 3 5 8
## [1]  0  1  1  2  3  5  8 13
## [1]  0  1  1  2  3  5  8 13 21
##  [1]  0  1  1  2  3  5  8 13 21 34</code></pre>
<p>For a more statistical case where we might want to perform a loop, we can consider the creation of the bootstrap estimate of a sampling distribution. The bootstrap distribution is created by repeatedly re-sampling with replacement from our original sample data, running the analysis for each re-sample, and then saving the statistic of interest. This is a very powerful statistical technique that I hope everyone gets to learn in a later course! Here is some code that runs a bootstrap analysis of the mean <code>Height</code> from the <code>trees</code> data set.</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="#cb274-1" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb274-2"><a href="#cb274-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb274-3"><a href="#cb274-3" tabindex="-1"></a></span>
<span id="cb274-4"><a href="#cb274-4" tabindex="-1"></a><span class="co"># bootstrap 5000 resamples from the trees dataset.</span></span>
<span id="cb274-5"><a href="#cb274-5" tabindex="-1"></a>SampDist <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xbar=</span><span class="cn">NULL</span>) <span class="co"># Make a data frame to store the means </span></span>
<span id="cb274-6"><a href="#cb274-6" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>){</span>
<span id="cb274-7"><a href="#cb274-7" tabindex="-1"></a>  <span class="do">## Do some stuff</span></span>
<span id="cb274-8"><a href="#cb274-8" tabindex="-1"></a>  boot.data <span class="ot">&lt;-</span> trees <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">sample_frac</span>(<span class="at">replace=</span><span class="cn">TRUE</span>)  </span>
<span id="cb274-9"><a href="#cb274-9" tabindex="-1"></a>  boot.stat <span class="ot">&lt;-</span> boot.data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">xbar=</span><span class="fu">mean</span>(Height)) <span class="co"># 1x1 data frame</span></span>
<span id="cb274-10"><a href="#cb274-10" tabindex="-1"></a>  </span>
<span id="cb274-11"><a href="#cb274-11" tabindex="-1"></a>  <span class="do">## Save the result as a new row in the output data frame</span></span>
<span id="cb274-12"><a href="#cb274-12" tabindex="-1"></a>  SampDist <span class="ot">&lt;-</span> <span class="fu">rbind</span>( SampDist, boot.stat )</span>
<span id="cb274-13"><a href="#cb274-13" tabindex="-1"></a>}</span>
<span id="cb274-14"><a href="#cb274-14" tabindex="-1"></a></span>
<span id="cb274-15"><a href="#cb274-15" tabindex="-1"></a><span class="co"># Check out the structure of the result</span></span>
<span id="cb274-16"><a href="#cb274-16" tabindex="-1"></a><span class="fu">str</span>(SampDist)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:    5000 obs. of  1 variable:
##  $ xbar: num  75.5 77 76.3 75.8 77.5 ...</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="#cb276-1" tabindex="-1"></a><span class="co"># Plot the output</span></span>
<span id="cb276-2"><a href="#cb276-2" tabindex="-1"></a><span class="fu">ggplot</span>(SampDist, <span class="fu">aes</span>(<span class="at">x=</span>xbar)) <span class="sc">+</span> </span>
<span id="cb276-3"><a href="#cb276-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>( <span class="at">bins =</span> <span class="dv">25</span>, <span class="at">color=</span><span class="st">&#39;black&#39;</span>, <span class="at">fill=</span><span class="st">&#39;grey50&#39;</span>) <span class="sc">+</span></span>
<span id="cb276-4"><a href="#cb276-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&#39;Trees Data: Bootstrap distribution of Mean Height (xbar)&#39;</span>)</span></code></pre></div>
<p><img src="444_files/figure-html/BootstrapExample-1.png" width="672" /></p>
</div>
</div>
<div id="functions" class="section level2 hasAnchor" number="6.5">
<h2 class="hasAnchor"><span class="header-section-number">6.5</span> Functions<a href="#functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>It is very important to be able to define a piece of programming logic that is repeated often. For example, I don’t want to have to always program the mathematical code for calculating the sample variance of a vector of data. Instead I just want to call a function that does everything for me and I don’t have to worry about the details.</p>
<p>While hiding the computational details is nice, fundamentally writing functions allows us to think about our problems at a higher layer of abstraction. For example, most scientists just want to run a t-test on their data and get the appropriate p-value; they want to focus on their problem and not how to conduct the calculation in detail. Another statistical example where functions are important is a bootstrap data analysis where we need to define a function that calculates whatever statistic the research cares about.</p>
<p>The format for defining your own function is</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="#cb277-1" tabindex="-1"></a>function.name <span class="ot">&lt;-</span> <span class="cf">function</span>(arg1, arg2, arg3){</span>
<span id="cb277-2"><a href="#cb277-2" tabindex="-1"></a>  statement1 <span class="co"># likely involving arg1, arg2, and/or arg3</span></span>
<span id="cb277-3"><a href="#cb277-3" tabindex="-1"></a>  statement2 <span class="co"># likely involving arg1, arg2, and/or arg3</span></span>
<span id="cb277-4"><a href="#cb277-4" tabindex="-1"></a>}</span></code></pre></div>
<p>where <code>arg1</code>, <code>arg2</code>, and <code>arg3</code> are the arguments of the function in which the user can change based on their needs. To illustrate how to define your own function, we will define a variance calculating function. The function takes in a vector of values <code>x</code>, which can be of any size and contain any variety of numbers, and outputs the properly calculated sample variance.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="#cb278-1" tabindex="-1"></a><span class="co"># define my function</span></span>
<span id="cb278-2"><a href="#cb278-2" tabindex="-1"></a>my.var <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb278-3"><a href="#cb278-3" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)                <span class="co"># calculate sample size</span></span>
<span id="cb278-4"><a href="#cb278-4" tabindex="-1"></a>  xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)               <span class="co"># calculate sample mean</span></span>
<span id="cb278-5"><a href="#cb278-5" tabindex="-1"></a>  SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>( (x<span class="sc">-</span>xbar)<span class="sc">^</span><span class="dv">2</span> )      <span class="co"># calculate sum of squared error</span></span>
<span id="cb278-6"><a href="#cb278-6" tabindex="-1"></a>  v <span class="ot">&lt;-</span> SSE <span class="sc">/</span> ( n <span class="sc">-</span> <span class="dv">1</span> )          <span class="co"># &quot;average&quot; squared error</span></span>
<span id="cb278-7"><a href="#cb278-7" tabindex="-1"></a>  <span class="fu">return</span>(v)                     <span class="co"># result of function is v</span></span>
<span id="cb278-8"><a href="#cb278-8" tabindex="-1"></a>}</span></code></pre></div>
<p>With our funtion created, we can now feed it any vector of data we would like and obtain the sample variance.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="#cb279-1" tabindex="-1"></a><span class="co"># create a vector that I wish to calculate the variance of</span></span>
<span id="cb279-2"><a href="#cb279-2" tabindex="-1"></a>test.vector <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>)</span>
<span id="cb279-3"><a href="#cb279-3" tabindex="-1"></a></span>
<span id="cb279-4"><a href="#cb279-4" tabindex="-1"></a><span class="co"># calculate the variance using my function</span></span>
<span id="cb279-5"><a href="#cb279-5" tabindex="-1"></a>calculated.var <span class="ot">&lt;-</span> <span class="fu">my.var</span>( test.vector )</span>
<span id="cb279-6"><a href="#cb279-6" tabindex="-1"></a>calculated.var</span></code></pre></div>
<pre><code>## [1] 2.5</code></pre>
<p>Notice that even though I defined my function using <code>x</code> as my vector of data, and passed my function something named <code>test.vector</code>, R does the appropriate renaming. If my function doesn’t modify its input arguments, then R just passes a pointer to the inputs to avoid copying large amounts of data when you call a function. If your function modifies its input, then R will take the input data, copy it, and then pass that new copy to the function. This means that a function cannot modify its arguments. In Computer Science parlance, R does not allow for procedural side effects. Think of the variable <code>x</code> as a placeholder, with it being replaced by whatever gets passed into the function.</p>
<p>When I call a function, it might cause something to happen (e.g. draw a plot); or, it might do some calculations, the result of which is returned by the function, and we might want to save that. Inside a function, if I want the result of some
calculation saved, I <code>return</code> the result as the output of the function. The way I specify this is via the <code>return</code> statement. (Actually R doesn’t completely require this. But the alternative method is less intuitive and I strongly
recommend using the <code>return()</code> statement.)</p>
<p>By writing a function, I can use the same chunk of code repeatedly. This means that I can do all my tedious calculations inside the function and just call the function whenever I want and happily ignore the details. Consider the function <code>t.test()</code> which we have used previously to do all calculations involved in a t-test. We could write a similar function using the following code:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="#cb281-1" tabindex="-1"></a><span class="co"># define my function</span></span>
<span id="cb281-2"><a href="#cb281-2" tabindex="-1"></a>one.sample.t.test <span class="ot">&lt;-</span> <span class="cf">function</span>(input.data, mu0){</span>
<span id="cb281-3"><a href="#cb281-3" tabindex="-1"></a>  n    <span class="ot">&lt;-</span> <span class="fu">length</span>(input.data)</span>
<span id="cb281-4"><a href="#cb281-4" tabindex="-1"></a>  xbar <span class="ot">&lt;-</span> <span class="fu">mean</span>(input.data)</span>
<span id="cb281-5"><a href="#cb281-5" tabindex="-1"></a>  s    <span class="ot">&lt;-</span> <span class="fu">sd</span>(input.data)</span>
<span id="cb281-6"><a href="#cb281-6" tabindex="-1"></a>  t    <span class="ot">&lt;-</span> (xbar <span class="sc">-</span> mu0)<span class="sc">/</span>(s <span class="sc">/</span> <span class="fu">sqrt</span>(n))</span>
<span id="cb281-7"><a href="#cb281-7" tabindex="-1"></a>  <span class="cf">if</span>( t <span class="sc">&lt;</span> <span class="dv">0</span> ){</span>
<span id="cb281-8"><a href="#cb281-8" tabindex="-1"></a>    p.value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">pt</span>(t, <span class="at">df=</span>n<span class="dv">-1</span>)</span>
<span id="cb281-9"><a href="#cb281-9" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb281-10"><a href="#cb281-10" tabindex="-1"></a>    p.value <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">pt</span>(t, <span class="at">df=</span>n<span class="dv">-1</span>))</span>
<span id="cb281-11"><a href="#cb281-11" tabindex="-1"></a>  }</span>
<span id="cb281-12"><a href="#cb281-12" tabindex="-1"></a>  <span class="co"># we haven&#39;t addressed how to print things in a organized </span></span>
<span id="cb281-13"><a href="#cb281-13" tabindex="-1"></a>  <span class="co"># fashion, the following is ugly, but works...</span></span>
<span id="cb281-14"><a href="#cb281-14" tabindex="-1"></a>  <span class="co"># Notice that this function returns a character string</span></span>
<span id="cb281-15"><a href="#cb281-15" tabindex="-1"></a>  <span class="co"># with the necessary information in the string.</span></span>
<span id="cb281-16"><a href="#cb281-16" tabindex="-1"></a>  <span class="co"># This is a great place to make a nice data frame output using Chapter 4 material!</span></span>
<span id="cb281-17"><a href="#cb281-17" tabindex="-1"></a>  <span class="fu">return</span>( <span class="fu">paste</span>(<span class="st">&#39;t =&#39;</span>, <span class="fu">round</span>(t, <span class="at">digits=</span><span class="dv">3</span>), <span class="st">&#39;and p.value =&#39;</span>, <span class="fu">round</span>(p.value, <span class="dv">3</span>)) )</span>
<span id="cb281-18"><a href="#cb281-18" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="#cb282-1" tabindex="-1"></a><span class="co"># create a vector that I wish apply a one-sample t-test on.</span></span>
<span id="cb282-2"><a href="#cb282-2" tabindex="-1"></a>test.data <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>)</span>
<span id="cb282-3"><a href="#cb282-3" tabindex="-1"></a><span class="fu">one.sample.t.test</span>( test.data, <span class="at">mu0=</span><span class="dv">2</span> )</span></code></pre></div>
<pre><code>## [1] &quot;t = 3.157 and p.value = 0.008&quot;</code></pre>
<p>Nearly every function we use to do data analysis is written in a similar fashion. Somebody decided it would be convenient to have a function that did an ANOVA analysis and they wrote something similar to the above function, but is a bit grander in scope. Even if you don’t end up writing any of your own functions, knowing how will help you understand why certain functions you use are designed the way they are.</p>
</div>
<div id="Exercises_FlowControl" class="section level2 hasAnchor" number="6.6">
<h2 class="hasAnchor"><span class="header-section-number">6.6</span> Exercises<a href="#Exercises_FlowControl" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="exercise-1" class="section level3 unnumbered hasAnchor">
<h3 class="unnumbered hasAnchor">Exercise 1<a href="#exercise-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Presidential candidates for the 2020 US election have been coded into a data frame that is available on the github website for this textbook:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="#cb284-1" tabindex="-1"></a>prez <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="st">&#39;https://raw.githubusercontent.com/BuscagliaR/STA_444_v2/main/data-raw/Prez_Candidate_Birthdays&#39;</span>)</span>
<span id="cb284-2"><a href="#cb284-2" tabindex="-1"></a>prez</span></code></pre></div>
<pre><code>## # A tibble: 11 × 5
##    Candidate        Gender Birthday   Party AgeOnElection
##    &lt;chr&gt;            &lt;chr&gt;  &lt;date&gt;     &lt;chr&gt;         &lt;dbl&gt;
##  1 Pete Buttigieg   M      1982-01-19 D                38
##  2 Andrew Yang      M      1975-01-13 D                45
##  3 Juilan Castro    M      1976-09-16 D                44
##  4 Beto O&#39;Rourke    M      1972-09-26 D                48
##  5 Cory Booker      M      1969-04-27 D                51
##  6 Kamala Harris    F      1964-10-20 D                56
##  7 Amy Klobucher    F      1960-05-25 D                60
##  8 Elizabeth Warren F      1949-06-22 D                71
##  9 Donald Trump     M      1946-06-14 R                74
## 10 Joe Biden        M      1942-11-20 D                77
## 11 Bernie Sanders   M      1941-09-08 D                79</code></pre>
<p><strong>a)</strong> Re-code the Gender column to have Male and Female levels. Similarly convert the party variable to be Democratic or Republican. <em>You may write this using a <code>for()</code> loop with an <code>if(){ ... }else{...}</code> structure nested inside, or simply using a <code>mutate()</code> statement with the <code>ifelse()</code> command inside. I believe the second option is MUCH easier.</em></p>
<p><strong>b)</strong> Bernie Sanders was registered as an Independent up until his 2016 presidential run. Change his political party value into ‘Independent’.</p>
</div>
<div id="exercise-2" class="section level3 unnumbered hasAnchor">
<h3 class="unnumbered hasAnchor">Exercise 2<a href="#exercise-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <span class="math inline">\(Uniform\left(a,b\right)\)</span> distribution is defined on x <span class="math inline">\(\in [a,b]\)</span> and represents a random variable that takes on any value of between <code>a</code> and <code>b</code> with equal probability. Technically since there are an infinite number of values between <code>a</code> and <code>b</code>, each value has a probability of 0 of being selected and I should say each interval of width <span class="math inline">\(d\)</span> has equal probability. It has the density function</p>
<p><span class="math display">\[
f\left(x\right)=\begin{cases}
  \frac{1}{b-a} &amp; \;\;\;\;a\le x\le b\\
  0 &amp; \;\;\;\;\textrm{otherwise}
\end{cases}
\]</span></p>
<p>The R function <code>dunif()</code> evaluates this density function for the above defined values of x, a, and b. Somewhere in that function, there is a chunk of code that evaluates the density for arbitrary values of <span class="math inline">\(x\)</span>. Run this code a few times and notice sometimes the result is <span class="math inline">\(0\)</span> and sometimes it is <span class="math inline">\(1/(10-4)=0.16666667\)</span>.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="#cb286-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">4</span>      <span class="co"># The min and max values we will use for this example</span></span>
<span id="cb286-2"><a href="#cb286-2" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10</span>     <span class="co"># Could be anything, but we need to pick something</span></span>
<span id="cb286-3"><a href="#cb286-3" tabindex="-1"></a>    </span>
<span id="cb286-4"><a href="#cb286-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="dv">0</span>,<span class="dv">10</span>)  <span class="co"># one random value between 0 and 10</span></span>
<span id="cb286-5"><a href="#cb286-5" tabindex="-1"></a></span>
<span id="cb286-6"><a href="#cb286-6" tabindex="-1"></a><span class="co"># what is value of f(x) at the randomly selected x value?  </span></span>
<span id="cb286-7"><a href="#cb286-7" tabindex="-1"></a><span class="fu">dunif</span>(x, a, b)</span></code></pre></div>
<pre><code>## [1] 0.1666667</code></pre>
<p>We will write a sequence of statements that utilizes if statements to appropriately calculate the density of <code>x</code>, assuming that <code>a</code>, <code>b</code> , and <code>x</code> are given to you, but your code won’t know if <code>x</code> is between <code>a</code> and <code>b</code>. That is, your code needs to figure out if it is and give either <code>1/(b-a)</code> or <code>0</code>.</p>
<p><strong>a)</strong> We could write a set of <code>if else</code> statements.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="#cb288-1" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb288-2"><a href="#cb288-2" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="dv">10</span></span>
<span id="cb288-3"><a href="#cb288-3" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="dv">0</span>,<span class="dv">10</span>)  <span class="co"># one random value between 0 and 10 </span></span>
<span id="cb288-4"><a href="#cb288-4" tabindex="-1"></a>        </span>
<span id="cb288-5"><a href="#cb288-5" tabindex="-1"></a><span class="cf">if</span>( x <span class="sc">&lt;</span> a ){</span>
<span id="cb288-6"><a href="#cb288-6" tabindex="-1"></a>  result <span class="ot">&lt;-</span> ????      <span class="co"># Replace ???? with something appropriate!</span></span>
<span id="cb288-7"><a href="#cb288-7" tabindex="-1"></a>}<span class="cf">else</span> <span class="cf">if</span>( x <span class="sc">&lt;=</span> b ){</span>
<span id="cb288-8"><a href="#cb288-8" tabindex="-1"></a>  result <span class="ot">&lt;-</span> ????</span>
<span id="cb288-9"><a href="#cb288-9" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb288-10"><a href="#cb288-10" tabindex="-1"></a>  result <span class="ot">&lt;-</span> ????</span>
<span id="cb288-11"><a href="#cb288-11" tabindex="-1"></a>}</span>
<span id="cb288-12"><a href="#cb288-12" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;x=&#39;</span>,<span class="fu">round</span>(x,<span class="at">digits=</span><span class="dv">3</span>), <span class="st">&#39;  result=&#39;</span>, <span class="fu">round</span>(result,<span class="at">digits=</span><span class="dv">3</span>)))</span></code></pre></div>
<p>Replace the <code>????</code> with the appropriate value, either 0 or <span class="math inline">\(1/\left(b-a\right)\)</span>. Run the code repeatedly until you are certain that it is calculating the correct density value.</p>
<p><strong>b)</strong> We could perform the logical comparison all in one comparison. Recall that we can use <code>&amp;</code> to mean “and” and <code>|</code> to mean “or”. In the following two code chunks, replace the <code>???</code> with either <code>&amp;</code> or <code>|</code> to make the appropriate result.</p>
<p><em>i.</em></p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="#cb289-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="dv">0</span>,<span class="dv">10</span>)  <span class="co"># one random value between 0 and 10 </span></span>
<span id="cb289-2"><a href="#cb289-2" tabindex="-1"></a><span class="cf">if</span>( (a<span class="sc">&lt;=</span>x) ??? (x<span class="sc">&lt;=</span>b) ){</span>
<span id="cb289-3"><a href="#cb289-3" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(b<span class="sc">-</span>a)</span>
<span id="cb289-4"><a href="#cb289-4" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb289-5"><a href="#cb289-5" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb289-6"><a href="#cb289-6" tabindex="-1"></a>  }</span>
<span id="cb289-7"><a href="#cb289-7" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;x=&#39;</span>,<span class="fu">round</span>(x,<span class="at">digits=</span><span class="dv">3</span>), <span class="st">&#39;  result=&#39;</span>, <span class="fu">round</span>(result,<span class="at">digits=</span><span class="dv">3</span>)))</span></code></pre></div>
<p><em>ii.</em></p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="#cb290-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="dv">0</span>,<span class="dv">10</span>)  <span class="co"># one random value between 0 and 10 </span></span>
<span id="cb290-2"><a href="#cb290-2" tabindex="-1"></a><span class="cf">if</span>( (x<span class="sc">&lt;</span>a) ??? (b<span class="sc">&lt;</span>x) ){</span>
<span id="cb290-3"><a href="#cb290-3" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb290-4"><a href="#cb290-4" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb290-5"><a href="#cb290-5" tabindex="-1"></a>    result <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>(b<span class="sc">-</span>a)</span>
<span id="cb290-6"><a href="#cb290-6" tabindex="-1"></a>    }</span>
<span id="cb290-7"><a href="#cb290-7" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;x=&#39;</span>,<span class="fu">round</span>(x,<span class="at">digits=</span><span class="dv">3</span>), <span class="st">&#39;  result=&#39;</span>, <span class="fu">round</span>(result,<span class="at">digits=</span><span class="dv">3</span>)))</span></code></pre></div>
<p><em>iii.</em></p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="#cb291-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="at">n=</span><span class="dv">1</span>, <span class="dv">0</span>,<span class="dv">10</span>)  <span class="co"># one random value between 0 and 10 </span></span>
<span id="cb291-2"><a href="#cb291-2" tabindex="-1"></a>result <span class="ot">&lt;-</span> <span class="fu">ifelse</span>( a<span class="sc">&lt;=</span>x <span class="sc">&amp;</span> x<span class="sc">&lt;=</span>b, ???, ??? )</span>
<span id="cb291-3"><a href="#cb291-3" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">&#39;x=&#39;</span>,<span class="fu">round</span>(x,<span class="at">digits=</span><span class="dv">3</span>), <span class="st">&#39;  result=&#39;</span>, <span class="fu">round</span>(result,<span class="at">digits=</span><span class="dv">3</span>)))</span></code></pre></div>
</div>
<div id="exercise-3" class="section level3 unnumbered hasAnchor">
<h3 class="unnumbered hasAnchor">Exercise 3<a href="#exercise-3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>I often want to repeat some section of code some number of times. For example, I might want to create a bunch plots that compare the density of a t-distribution with specified degrees of freedom to a standard normal distribution.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="#cb292-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb292-2"><a href="#cb292-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="dv">5</span></span>
<span id="cb292-3"><a href="#cb292-3" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb292-4"><a href="#cb292-4" tabindex="-1"></a>x.grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length=</span>N)</span>
<span id="cb292-5"><a href="#cb292-5" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( </span>
<span id="cb292-6"><a href="#cb292-6" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(x.grid, x.grid),</span>
<span id="cb292-7"><a href="#cb292-7" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="fu">dnorm</span>(x.grid), <span class="fu">dt</span>(x.grid, df)),</span>
<span id="cb292-8"><a href="#cb292-8" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>( <span class="fu">rep</span>(<span class="st">&#39;Normal&#39;</span>,N), <span class="fu">rep</span>(<span class="st">&#39;T&#39;</span>,N) ) )</span>
<span id="cb292-9"><a href="#cb292-9" tabindex="-1"></a></span>
<span id="cb292-10"><a href="#cb292-10" tabindex="-1"></a><span class="co"># make a nice graph</span></span>
<span id="cb292-11"><a href="#cb292-11" tabindex="-1"></a>myplot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">color=</span>type, <span class="at">linetype=</span>type)) <span class="sc">+</span></span>
<span id="cb292-12"><a href="#cb292-12" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb292-13"><a href="#cb292-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&#39;Std Normal vs t with&#39;</span>, df, <span class="st">&#39;degrees of freedom&#39;</span>))</span>
<span id="cb292-14"><a href="#cb292-14" tabindex="-1"></a></span>
<span id="cb292-15"><a href="#cb292-15" tabindex="-1"></a><span class="co"># actually print the nice graph we made</span></span>
<span id="cb292-16"><a href="#cb292-16" tabindex="-1"></a><span class="fu">print</span>(myplot) </span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-154-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><strong>a)</strong> Use a <code>for</code> loop to create similar graphs for degrees of freedom <span class="math inline">\(2,3,4,\dots,29,30\)</span>.</p>
<p><strong>b)</strong> In retrospect, perhaps we didn’t need to produce all of those. Rewrite your loop so that we only produce graphs for <span class="math inline">\(\left\{ 2,3,4,5,10,15,20,25,30\right\}\)</span> degrees of freedom. <em>Hint: you can just modify the vector in the <code>for</code> statement to include the desired degrees of freedom.</em></p>
</div>
<div id="exercise-4" class="section level3 unnumbered hasAnchor">
<h3 class="unnumbered hasAnchor">Exercise 4<a href="#exercise-4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is very common to run simulation studies to estimate probabilities that are difficult to work out. The game is to roll a pair of 6-sided dice 24 times. If a “double-sixes” comes up on any of the 24 rolls, the player wins. What is the probability of winning?</p>
<p><strong>a)</strong> We can simulate rolling two 6-sided dice using the <code>sample()</code> function with the <code>replace=TRUE</code> option. Read the help file on <code>sample()</code> to see how to sample from the numbers <span class="math inline">\(1,2,\dots,6\)</span>. Sum those two die rolls and save it as <code>throw</code>.</p>
<p><strong>b)</strong> Write a <code>for{}</code> loop that wraps your code from part (a) and then tests if any of the throws of dice summed to 12. Read the help files for the functions <code>any()</code> and <code>all()</code>. Your code should look something like the following:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="#cb293-1" tabindex="-1"></a>throws <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb293-2"><a href="#cb293-2" tabindex="-1"></a><span class="cf">for</span>( i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span> ){</span>
<span id="cb293-3"><a href="#cb293-3" tabindex="-1"></a>  throws[i] <span class="ot">&lt;-</span> ??????  <span class="co"># Your part (a) code goes here</span></span>
<span id="cb293-4"><a href="#cb293-4" tabindex="-1"></a>}</span>
<span id="cb293-5"><a href="#cb293-5" tabindex="-1"></a>game <span class="ot">&lt;-</span> <span class="fu">any</span>( throws <span class="sc">==</span> <span class="dv">12</span> ) <span class="co"># Gives a TRUE/FALSE value</span></span></code></pre></div>
<p><strong>c)</strong> Wrap all of your code from part (b) in <em>another</em> <code>for(){}</code> loop that you run 10,000 times. Save the result of each game in a <code>games</code> vector that will have 10,000 elements that are either TRUE/FALSE depending on the outcome of that game. You’ll need initiallize the <code>games</code> vector to NULL and modify your part (b) code to save the result into some location in the vector <code>games</code>.</p>
<p><strong>d)</strong> Finally, calculate win percentage by taking the average of the <code>games</code> vector.</p>
<!--chapter:end:06_FlowControl.Rmd-->
</div>
</div>
</div>
<div id="factors" class="section level1 hasAnchor" number="7">
<h1 class="hasAnchor"><span class="header-section-number">7</span> Factors<a href="#factors" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="#cb294-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
<p><strong>This chapter is currently being edited!!</strong></p>
<p>Dr. Sonderegger’s Video Companion: <a href="https://youtu.be/ID2hx2ySAEE">Video Lecture</a>.</p>
<p>In R we can store categorical information as either strings or factors. To a casual user, it often doesn’t matter how the information is stored because the modeling and graphing programs happily convert strings into factors whenever necessary. However, a deeper understanding of how factors are stored and manipulated allows a user much finer control in modeling and graphing.</p>
<p>We will be interested in the following broad classes of manipulations:</p>
<div id="edit-factor-labels" class="section level4 unnumbered hasAnchor">
<h4 class="unnumbered hasAnchor">Edit Factor Labels<a href="#edit-factor-labels" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<colgroup>
<col width="38%" />
<col width="61%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Goal</th>
<th align="left"><code>forcats</code> function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Manually change the label(s)</td>
<td align="left"><code>fct_recode(f, new_label = "old_label")</code></td>
</tr>
<tr class="even">
<td align="left">Systematically change all labels</td>
<td align="left"><code>fct_relabel(f, function)</code></td>
</tr>
</tbody>
</table>
</div>
<div id="reorder-levels" class="section level4 unnumbered hasAnchor">
<h4 class="unnumbered hasAnchor">Reorder Levels<a href="#reorder-levels" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<colgroup>
<col width="38%" />
<col width="61%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Goal</th>
<th align="left"><code>forcats</code> function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Set order manually</td>
<td align="left"><code>fct_relevel(f, 'b', 'a', 'c')</code></td>
</tr>
<tr class="even">
<td align="left">Set order based on another vector</td>
<td align="left"><code>fct_reorder(f, x)</code></td>
</tr>
<tr class="odd">
<td align="left">Set order based on which category is most frequent</td>
<td align="left"><code>fct_infreq(f)</code></td>
</tr>
<tr class="even">
<td align="left">Set order based on when they first appear</td>
<td align="left"><code>fct_inorder(f)</code></td>
</tr>
<tr class="odd">
<td align="left">Reverse factor order</td>
<td align="left"><code>fct_rev(f)</code></td>
</tr>
<tr class="even">
<td align="left">Rotate order left or right</td>
<td align="left"><code>fct_shift(f, steps)</code></td>
</tr>
</tbody>
</table>
</div>
<div id="add-or-subtract-levels" class="section level4 unnumbered hasAnchor">
<h4 class="unnumbered hasAnchor">Add or Subtract Levels<a href="#add-or-subtract-levels" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table>
<colgroup>
<col width="37%" />
<col width="62%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Goal</th>
<th align="left"><code>forcats</code> function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Manually select categories to collapse into one</td>
<td align="left"><code>fct_collapse(f, other = c('a','b'))</code></td>
</tr>
<tr class="even">
<td align="left">Add a new factor level</td>
<td align="left"><code>fct_expand(f, 'new level')</code></td>
</tr>
<tr class="odd">
<td align="left">Remove level(s) that don’t occur in the data</td>
<td align="left"><code>fct_drop(f)</code></td>
</tr>
</tbody>
</table>
</div>
<div id="creation-and-structure" class="section level2 hasAnchor" number="7.1">
<h2 class="hasAnchor"><span class="header-section-number">7.1</span> Creation and Structure<a href="#creation-and-structure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R stores factors as a combination of a vector of category labels and vector of integers representing which category a data value belongs to. For example, lets create a vector of data related to soft drinks.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="#cb295-1" tabindex="-1"></a><span class="co"># A vector of character strings.</span></span>
<span id="cb295-2"><a href="#cb295-2" tabindex="-1"></a>drinks <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&#39;DietCoke&#39;</span>, <span class="st">&#39;Coke&#39;</span>, <span class="st">&#39;Coke&#39;</span>, <span class="st">&#39;Sprite&#39;</span>, <span class="st">&#39;Pepsi&#39;</span>)</span>
<span id="cb295-3"><a href="#cb295-3" tabindex="-1"></a><span class="fu">str</span>(drinks)</span></code></pre></div>
<pre><code>##  chr [1:5] &quot;DietCoke&quot; &quot;Coke&quot; &quot;Coke&quot; &quot;Sprite&quot; &quot;Pepsi&quot;</code></pre>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="#cb297-1" tabindex="-1"></a><span class="co"># convert the vector of character strings into a factor vector</span></span>
<span id="cb297-2"><a href="#cb297-2" tabindex="-1"></a>drinks <span class="ot">&lt;-</span> <span class="fu">factor</span>(drinks)</span>
<span id="cb297-3"><a href="#cb297-3" tabindex="-1"></a></span>
<span id="cb297-4"><a href="#cb297-4" tabindex="-1"></a><span class="co"># Levels and Label mapping table</span></span>
<span id="cb297-5"><a href="#cb297-5" tabindex="-1"></a><span class="fu">data.frame</span>( <span class="at">Levels=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">Labels=</span><span class="fu">levels</span>(drinks))</span></code></pre></div>
<pre><code>##   Levels   Labels
## 1      1     Coke
## 2      2 DietCoke
## 3      3    Pepsi
## 4      4   Sprite</code></pre>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="#cb299-1" tabindex="-1"></a><span class="fu">as.integer</span>(drinks) <span class="co"># Print the category assignments</span></span></code></pre></div>
<pre><code>## [1] 2 1 1 4 3</code></pre>
<p>Notice that the factor has levels “Coke”, “DietCoke”, “Pepsi”, and “Sprite” and that the order of these levels is very important because each observation is saved as an <em>integer</em> that denotes which category the observation belongs to. Because it takes less memory to store a single integer instead of a potentially very long character string, factors are much more space efficient than storing the same data as strings.</p>
<p>Whenever we do anything that sorts on this factor, the order of the labels in this mapping table determine the sort orders. In order to modify factor labels and levels, we basically need to modify this mapping table. We can do this using functions in the <code>forcats</code> package.</p>
</div>
<div id="change-labels" class="section level2 hasAnchor" number="7.2">
<h2 class="hasAnchor"><span class="header-section-number">7.2</span> Change Labels<a href="#change-labels" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To demonstrate the <code>forcats</code> functions, we will consider two data sets. The first consists of a data set of a small US highschool with observations for each student that record their year and gender.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="#cb301-1" tabindex="-1"></a>Students <span class="ot">&lt;-</span> </span>
<span id="cb301-2"><a href="#cb301-2" tabindex="-1"></a>  <span class="fu">expand.grid</span>(<span class="at">Year=</span><span class="st">&#39;freshman&#39;</span>, <span class="at">Gender=</span><span class="dv">1</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">23</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-3"><a href="#cb301-3" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Year=</span><span class="st">&#39;freshman&#39;</span>, <span class="at">Gender=</span><span class="dv">0</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">25</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-4"><a href="#cb301-4" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Year=</span><span class="st">&#39;junior&#39;</span>,   <span class="at">Gender=</span><span class="dv">1</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">30</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-5"><a href="#cb301-5" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Year=</span><span class="st">&#39;junior&#39;</span>,   <span class="at">Gender=</span><span class="dv">0</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">32</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-6"><a href="#cb301-6" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Year=</span><span class="st">&#39;senior&#39;</span>,   <span class="at">Gender=</span><span class="dv">1</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">18</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-7"><a href="#cb301-7" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Year=</span><span class="st">&#39;senior&#39;</span>,   <span class="at">Gender=</span><span class="dv">0</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">19</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-8"><a href="#cb301-8" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Year=</span><span class="st">&#39;sophomore&#39;</span>, <span class="at">Gender=</span><span class="dv">1</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb301-9"><a href="#cb301-9" tabindex="-1"></a>  <span class="fu">add_row</span>(<span class="at">Year=</span><span class="st">&#39;sophomore&#39;</span>, <span class="at">Gender=</span><span class="dv">0</span>, <span class="at">rep=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>)</span>
<span id="cb301-10"><a href="#cb301-10" tabindex="-1"></a></span>
<span id="cb301-11"><a href="#cb301-11" tabindex="-1"></a><span class="co"># Variables that are character strings are coerced to factors.</span></span>
<span id="cb301-12"><a href="#cb301-12" tabindex="-1"></a><span class="co"># Variables that are numeric are not, and should be explicitly turned to factors.</span></span>
<span id="cb301-13"><a href="#cb301-13" tabindex="-1"></a>Students <span class="ot">&lt;-</span> Students <span class="sc">%&gt;%</span> </span>
<span id="cb301-14"><a href="#cb301-14" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Gender =</span> <span class="fu">factor</span>(Gender) )</span>
<span id="cb301-15"><a href="#cb301-15" tabindex="-1"></a></span>
<span id="cb301-16"><a href="#cb301-16" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb301-17"><a href="#cb301-17" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> </span>
<span id="cb301-18"><a href="#cb301-18" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-160-1.png" width="672" /></p>
<p>The first thing we ought to consider is how to change the factor labels for <code>Gender</code>. To do this we’ll use the <code>fct_recode()</code> function.</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="#cb302-1" tabindex="-1"></a><span class="co"># Change Gender from 0/1 to Female/Male</span></span>
<span id="cb302-2"><a href="#cb302-2" tabindex="-1"></a>Students <span class="ot">&lt;-</span> Students <span class="sc">%&gt;%</span></span>
<span id="cb302-3"><a href="#cb302-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Gender =</span> <span class="fu">fct_recode</span>(Gender, <span class="st">&#39;Male&#39;</span>   <span class="ot">=</span> <span class="st">&#39;1&#39;</span>),</span>
<span id="cb302-4"><a href="#cb302-4" tabindex="-1"></a>          <span class="at">Gender =</span> <span class="fu">fct_recode</span>(Gender, <span class="st">&#39;Female&#39;</span> <span class="ot">=</span> <span class="st">&#39;0&#39;</span>) )</span>
<span id="cb302-5"><a href="#cb302-5" tabindex="-1"></a></span>
<span id="cb302-6"><a href="#cb302-6" tabindex="-1"></a><span class="co"># Change &quot;Freshman&quot; to &quot;First Year&quot; </span></span>
<span id="cb302-7"><a href="#cb302-7" tabindex="-1"></a>Students <span class="ot">&lt;-</span> Students <span class="sc">%&gt;%</span></span>
<span id="cb302-8"><a href="#cb302-8" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_recode</span>(Year, <span class="st">`</span><span class="at">first year</span><span class="st">`</span> <span class="ot">=</span> <span class="st">&#39;freshman&#39;</span>))</span>
<span id="cb302-9"><a href="#cb302-9" tabindex="-1"></a>  </span>
<span id="cb302-10"><a href="#cb302-10" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb302-11"><a href="#cb302-11" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-161-1.png" width="672" /></p>
<p>We might want to apply some function to all the labels. Perhaps we want to remove white space or perhaps we want to capitalize all the labels. To apply a function to each of the labels, we use the <code>fct_relabel()</code> function.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="#cb303-1" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb303-2"><a href="#cb303-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_relabel</span>(Year, stringr<span class="sc">::</span>str_to_upper) ) <span class="sc">%&gt;%</span></span>
<span id="cb303-3"><a href="#cb303-3" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-162-1.png" width="672" /></p>
</div>
<div id="reorder-levels-1" class="section level2 hasAnchor" number="7.3">
<h2 class="hasAnchor"><span class="header-section-number">7.3</span> Reorder Levels<a href="#reorder-levels-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Once the factor labels are set, the next most common thing to do is to rearrange the factors. In our <code>Students</code> example, the order is messed up because it chose to order them in the same order that they appear in the data set. That is not appropriate and in this case, it makes sense to change the order to the chronological order First Year, Sophmore, Junior, Senior.</p>
<p>To change the ordering manually, we use the <code>fct::relevel()</code> command. This function takes as many levels as you give it and leaves the unaccounted for levels in the same order as they were.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="#cb304-1" tabindex="-1"></a><span class="co"># Seniors first, leave the rest in the order they already were</span></span>
<span id="cb304-2"><a href="#cb304-2" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb304-3"><a href="#cb304-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_relevel</span>(Year, <span class="st">&#39;senior&#39;</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb304-4"><a href="#cb304-4" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-163-1.png" width="672" /></p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="#cb305-1" tabindex="-1"></a><span class="co"># reset all the levels orders</span></span>
<span id="cb305-2"><a href="#cb305-2" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb305-3"><a href="#cb305-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_relevel</span>(Year, <span class="st">&#39;senior&#39;</span>, <span class="st">&#39;junior&#39;</span>,<span class="st">&#39;sophomore&#39;</span>,<span class="st">&#39;first year&#39;</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb305-4"><a href="#cb305-4" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-163-2.png" width="672" /></p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="#cb306-1" tabindex="-1"></a><span class="co"># Reverse order of what I already had</span></span>
<span id="cb306-2"><a href="#cb306-2" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb306-3"><a href="#cb306-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_relevel</span>(Year, <span class="st">&#39;senior&#39;</span>, <span class="st">&#39;junior&#39;</span>,<span class="st">&#39;sophomore&#39;</span>,<span class="st">&#39;first year&#39;</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb306-4"><a href="#cb306-4" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_rev</span>(Year) ) <span class="sc">%&gt;%</span></span>
<span id="cb306-5"><a href="#cb306-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-163-3.png" width="672" /></p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="#cb307-1" tabindex="-1"></a><span class="co"># Sometimes it is useful to rotate using + or - the number of shift steps</span></span>
<span id="cb307-2"><a href="#cb307-2" tabindex="-1"></a><span class="co"># positive values move the first to the end. Negative values move the end to the front.</span></span>
<span id="cb307-3"><a href="#cb307-3" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb307-4"><a href="#cb307-4" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_relevel</span>(Year, <span class="st">&#39;senior&#39;</span>, <span class="st">&#39;junior&#39;</span>,<span class="st">&#39;sophomore&#39;</span>,<span class="st">&#39;first year&#39;</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb307-5"><a href="#cb307-5" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_rev</span>(Year) ) <span class="sc">%&gt;%</span></span>
<span id="cb307-6"><a href="#cb307-6" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_shift</span>(Year, <span class="sc">-</span><span class="dv">1</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb307-7"><a href="#cb307-7" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-163-4.png" width="672" /></p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="#cb308-1" tabindex="-1"></a><span class="co"># In the order of the most number of records</span></span>
<span id="cb308-2"><a href="#cb308-2" tabindex="-1"></a>Students <span class="sc">%&gt;%</span></span>
<span id="cb308-3"><a href="#cb308-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Year =</span> <span class="fu">fct_infreq</span>(Year) ) <span class="sc">%&gt;%</span></span>
<span id="cb308-4"><a href="#cb308-4" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">fill=</span>Gender)) <span class="sc">+</span> <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-163-5.png" width="672" /></p>
<p>For a second example data set, consider a September 2019 <a href="https://www.monmouth.edu/polling-institute/reports/monmouthpoll_NH_092419/">poll</a>
from Monmouth University of New Hampshire Democrats and Independents.</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="#cb309-1" tabindex="-1"></a>Dems <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb309-2"><a href="#cb309-2" tabindex="-1"></a>  <span class="sc">~</span>Candidate, <span class="sc">~</span>Percent, <span class="sc">~</span>AgeOnElection,</span>
<span id="cb309-3"><a href="#cb309-3" tabindex="-1"></a><span class="st">&#39;Elizabeth Warren&#39;</span>, <span class="dv">27</span>, <span class="dv">71</span>,</span>
<span id="cb309-4"><a href="#cb309-4" tabindex="-1"></a><span class="st">&#39;Joe Biden&#39;</span>,    <span class="dv">25</span>, <span class="dv">77</span>,</span>
<span id="cb309-5"><a href="#cb309-5" tabindex="-1"></a><span class="st">&#39;Bernie Sanders&#39;</span>,   <span class="dv">12</span>, <span class="dv">79</span>,</span>
<span id="cb309-6"><a href="#cb309-6" tabindex="-1"></a><span class="st">&#39;Pete Buttigieg&#39;</span>,   <span class="dv">10</span>, <span class="dv">38</span>,</span>
<span id="cb309-7"><a href="#cb309-7" tabindex="-1"></a><span class="st">&#39;Kamala Harris&#39;</span>,    <span class="dv">3</span>, <span class="dv">56</span>,</span>
<span id="cb309-8"><a href="#cb309-8" tabindex="-1"></a><span class="st">&#39;Cory Booker&#39;</span>,  <span class="dv">2</span>, <span class="dv">51</span>,</span>
<span id="cb309-9"><a href="#cb309-9" tabindex="-1"></a><span class="st">&#39;Tulsi Gabbard&#39;</span>,    <span class="dv">2</span>, <span class="dv">39</span>,</span>
<span id="cb309-10"><a href="#cb309-10" tabindex="-1"></a><span class="st">&#39;Amy Klobuchar&#39;</span>,    <span class="dv">2</span>, <span class="dv">60</span>, </span>
<span id="cb309-11"><a href="#cb309-11" tabindex="-1"></a><span class="st">&#39;Tom Steyer&#39;</span>,   <span class="dv">2</span>, <span class="dv">63</span>,</span>
<span id="cb309-12"><a href="#cb309-12" tabindex="-1"></a><span class="st">&#39;Andrew Yang&#39;</span>,  <span class="dv">2</span>, <span class="dv">45</span>, </span>
<span id="cb309-13"><a href="#cb309-13" tabindex="-1"></a><span class="st">&#39;Other&#39;</span>,    <span class="dv">3</span>, <span class="cn">NA</span>,</span>
<span id="cb309-14"><a href="#cb309-14" tabindex="-1"></a><span class="st">&#39;No one&#39;</span>,   <span class="dv">1</span>, <span class="cn">NA</span>,</span>
<span id="cb309-15"><a href="#cb309-15" tabindex="-1"></a><span class="st">&#39;Undecided&#39;</span>,    <span class="dv">9</span>, <span class="cn">NA</span>)</span></code></pre></div>
<p>We now want to first arrange the 2020 Democratic candidates for US president by their support.</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="#cb310-1" tabindex="-1"></a><span class="co"># Reorder Candidates based on the polling percent. The order of Smallest to largest </span></span>
<span id="cb310-2"><a href="#cb310-2" tabindex="-1"></a><span class="co"># results in &#39;No one&#39; at the bottom and Elizabeth Warren at the top. </span></span>
<span id="cb310-3"><a href="#cb310-3" tabindex="-1"></a>Dems <span class="sc">%&gt;%</span></span>
<span id="cb310-4"><a href="#cb310-4" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_reorder</span>(Candidate, Percent) ) <span class="sc">%&gt;%</span></span>
<span id="cb310-5"><a href="#cb310-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Candidate, <span class="at">y=</span>Percent)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-165-1.png" width="672" /></p>
<p>We might consider moving the <code>Other</code> and <code>Undecided</code> categories as the first categories before “No one”.</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="#cb311-1" tabindex="-1"></a>Dems <span class="sc">%&gt;%</span></span>
<span id="cb311-2"><a href="#cb311-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_reorder</span>(Candidate, Percent) ) <span class="sc">%&gt;%</span></span>
<span id="cb311-3"><a href="#cb311-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_relevel</span>(Candidate, <span class="st">&#39;Other&#39;</span>, <span class="at">after=</span><span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb311-4"><a href="#cb311-4" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_relevel</span>(Candidate, <span class="st">&#39;Undecided&#39;</span>, <span class="at">after=</span><span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb311-5"><a href="#cb311-5" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Candidate, <span class="at">y=</span>Percent)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-166-1.png" width="672" /></p>
</div>
<div id="add-or-subtract-levels-1" class="section level2 hasAnchor" number="7.4">
<h2 class="hasAnchor"><span class="header-section-number">7.4</span> Add or subtract Levels<a href="#add-or-subtract-levels-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Often we find that it is necessary to collapse several categories into one. In the Democratic candidate example, we might want to collapse <code>No one</code>, <code>Other</code> and <code>Undecided</code> into a single <code>Other</code> category.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="#cb312-1" tabindex="-1"></a><span class="co"># This collapses the factor levels but I still have 3 rows of &quot;other&quot;</span></span>
<span id="cb312-2"><a href="#cb312-2" tabindex="-1"></a>Dems <span class="sc">%&gt;%</span></span>
<span id="cb312-3"><a href="#cb312-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_collapse</span>(Candidate, <span class="at">other =</span> <span class="fu">c</span>(<span class="st">&#39;No one&#39;</span>, <span class="st">&#39;Other&#39;</span>, <span class="st">&#39;Undecided&#39;</span>)) )</span></code></pre></div>
<pre><code>## # A tibble: 13 × 3
##    Candidate        Percent AgeOnElection
##    &lt;fct&gt;              &lt;dbl&gt;         &lt;dbl&gt;
##  1 Elizabeth Warren      27            71
##  2 Joe Biden             25            77
##  3 Bernie Sanders        12            79
##  4 Pete Buttigieg        10            38
##  5 Kamala Harris          3            56
##  6 Cory Booker            2            51
##  7 Tulsi Gabbard          2            39
##  8 Amy Klobuchar          2            60
##  9 Tom Steyer             2            63
## 10 Andrew Yang            2            45
## 11 other                  3            NA
## 12 other                  1            NA
## 13 other                  9            NA</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="#cb314-1" tabindex="-1"></a><span class="co"># Collapse the factor, then summarize by adding up the percentages  </span></span>
<span id="cb314-2"><a href="#cb314-2" tabindex="-1"></a>Dems <span class="sc">%&gt;%</span></span>
<span id="cb314-3"><a href="#cb314-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_collapse</span>(Candidate, <span class="at">other =</span> <span class="fu">c</span>(<span class="st">&#39;No one&#39;</span>, <span class="st">&#39;Other&#39;</span>, <span class="st">&#39;Undecided&#39;</span>)) ) <span class="sc">%&gt;%</span></span>
<span id="cb314-4"><a href="#cb314-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Candidate) <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">Percent =</span> <span class="fu">sum</span>(Percent)) <span class="sc">%&gt;%</span></span>
<span id="cb314-5"><a href="#cb314-5" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_reorder</span>(Candidate, Percent) ) <span class="sc">%&gt;%</span></span>
<span id="cb314-6"><a href="#cb314-6" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Candidate =</span> <span class="fu">fct_relevel</span>(Candidate, <span class="st">&#39;other&#39;</span>, <span class="at">after=</span><span class="dv">0</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb314-7"><a href="#cb314-7" tabindex="-1"></a>  <span class="fu">ggplot</span>( <span class="fu">aes</span>(<span class="at">x=</span>Candidate, <span class="at">y=</span>Percent)) <span class="sc">+</span> <span class="fu">geom_col</span>() <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="444_files/figure-html/unnamed-chunk-167-1.png" width="672" /></p>
<p><em>I need to add the case where we are updating a column of factors and we want to replace a single observation’s level with another. To do this we do something like this:</em></p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="#cb315-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>( <span class="at">Name=</span><span class="fu">c</span>(<span class="st">&#39;Alice&#39;</span>,<span class="st">&#39;Bruce&#39;</span>,<span class="st">&#39;Charlie&#39;</span>), <span class="at">Grade =</span> <span class="fu">c</span>(<span class="st">&#39;A&#39;</span>,<span class="st">&#39;B&#39;</span>,<span class="st">&#39;B&#39;</span>) ) <span class="sc">%&gt;%</span></span>
<span id="cb315-2"><a href="#cb315-2" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Grade =</span> <span class="fu">factor</span>(Grade) ) <span class="sc">%&gt;%</span></span>
<span id="cb315-3"><a href="#cb315-3" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Grade =</span> <span class="fu">fct_expand</span>(Grade, <span class="st">&#39;C&#39;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb315-4"><a href="#cb315-4" tabindex="-1"></a>  <span class="fu">mutate</span>( <span class="at">Grade =</span> <span class="fu">if_else</span>(Name <span class="sc">==</span> <span class="st">&#39;Charlie&#39;</span>, <span class="fu">factor</span>(<span class="st">&#39;C&#39;</span>, <span class="at">levels=</span><span class="fu">levels</span>(Grade)), Grade ) )</span>
<span id="cb315-5"><a href="#cb315-5" tabindex="-1"></a>data  </span></code></pre></div>
<pre><code>##      Name Grade
## 1   Alice     A
## 2   Bruce     B
## 3 Charlie     C</code></pre>
<p><em>The key idea is that both the TRUE and the FALSE outputs have to have the same type (which is a factor), and both factors have to have a compatible set of levels.</em></p>
</div>
<div id="Exercises_Factors" class="section level2 hasAnchor" number="7.5">
<h2 class="hasAnchor"><span class="header-section-number">7.5</span> Exercises<a href="#Exercises_Factors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>In the package <code>Lock5Data</code> there is a dataset <code>FloridaLakes</code> that contains water sample measurements from 53 lakes in Florida. Produce a bar graph that shows the <code>Lake</code> and <code>AvgMercury</code> variables, and make sure that the lakes are ordered by Average Mercury content. <em>To fix the issue of lake labels being squished together, you could rotate the labels using a <code>+ theme(axis.text.x = element_text(angle = 90, hjust = 1))</code> or flipping the coordinate axes. However, you’ll likely want to resize the figure so the labels aren’t so squished. the chunk options <code>fig.height</code> and <code>fig.width</code> control the size of the resulting figure.</em></p></li>
<li><p>In the package <code>Lock5Data</code>, there is a dataset <code>FootballBrain</code> that has brain measurements for 75 individuals. The <code>Group</code> variable has three levels: <code>Control</code> is somebody that did not play football, <code>FBNoConcuss</code> is a football player with no history of concussions, or <code>FBConcuss</code> which is a football player with concussion history. The variable <code>Cogniton</code> measures their testing composite reaction time score. Change the <code>Group</code> labels to something that would make sense to a reader and create a box-plot graph of the groups vs cognition. <em>Because there is no data for the <code>Control</code> group, don’t show it on your graph. Also notice that the original data set column name misspells “cognition”.</em></p></li>
<li><p>In the package <code>Lock5Data</code>, there is a dataset <code>RestaurantTips</code> that gives tip data from the restaurant First Crush Bistro in Potsdam, NY. Make all necessary modifications to the <code>Day</code> variable so that subsequent graphs and tables are labeled in a professional manner. Do a similar modification to the <code>Credit</code> variable. Graph the <code>Bill</code> versus the <code>PctTip</code> for each <code>Day</code> of the week where we use <code>Day</code> as the variable to facet_grid or facet_wrap on. Also include information about if the bill was paid via credit card or cash.</p></li>
</ol>
<!--chapter:end:07_Factors.Rmd-->
</div>
</div>
<div id="part-additional-information" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">(PART*) Additional Information<a href="#part-additional-information" class="anchor-section" aria-label="Anchor link to header"></a></h1>
</div>
<div id="personal-computer---r-and-rmd" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">Personal Computer - R and RMD<a href="#personal-computer---r-and-rmd" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>This section was last updated on 08/22/2024 by RB.</p>
<div id="installing-r" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Installing R<a href="#installing-r" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>R can be downloaded free online at <a href="https://www.r-project.org/" class="uri">https://www.r-project.org/</a>. Navigate to Downloads via CRAN, and choose a mirror. Select the ‘base’ installation for your operating system. I will be working with the latest version <code>4.4.1</code> during the semester. It is strongly recommended that all students take STA 444, which gives a very useful introduction to using the R language.</p>
</div>
<div id="rstudio" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">RStudio<a href="#rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>RStudio gives an easy to work with interface for writing R scripts and preparing RMD files. RStudio is free for download at <a href="https://www.rstudio.com/products/rstudio/download/" class="uri">https://www.rstudio.com/products/rstudio/download/</a>. I will be using RStudio version <code>2024.04.2+764 "Chocolate Cosmos"</code>.</p>
</div>
<div id="rmarkdown" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">RMarkdown<a href="#rmarkdown" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One important goal this semester will be to help translate what we learn in lectures to applications in your field of study. One excellent solution for keeping documents that need both writing and scripting to flow nicely is known as markdown. Through RStudio, we can install the package <strong>rmarkdown</strong>, which I will frequently refer to as RMD. This document, along with nearly all content that I will provide, will be produced through RMD.</p>
<p>RMD will be an excellent way for you to share your solutions with me electronically. For STA 444/445, it is required for all assignment preparation and submissions as PDF (outside of some special topics). Depending on the depth to which you learn RMD, you can also blend in the use of the latex language to make complete stand-alone documents. With a little practice, you can produce documents with text, code, figures, and tables with amazing organization. There are also shortcuts for leaving space within a document, so that pencil can be used to work out calculations. Remember, you can always double check any solutions this semester with the use of R!</p>
<p>Start by installing <strong>rmarkdown</strong> package. You may get some minor warnings, but you will not need <code>Rtools</code> to compile PDFs.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="#cb317-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;rmarkdown&quot;</span>)</span></code></pre></div>
<p>As a note of caution, packages should never be installed within an RMD file. <strong>Once a package is installed, it can be used continually without installation on that terminal.</strong> Thus, it is often best to install packages through script or the console window.</p>
<div style="page-break-after: always;"></div>
</div>
<div id="tinytex" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">tinytex<a href="#tinytex" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>If you have a latex distribution on your computer, you can skip the Latex instructions below. However, tinytex is one of the most reliable latex distributions for compiling PDF documents using Rmarkdown.</em></p>
<p>You must have a version of latex to produce high quality PDF files. The good news, there is an easy to implement solution directly through R. The package <strong>tinytex</strong> gives you both a fully operational latex developer and automatically updates required files so that you can generate PDFs with ease.</p>
<p>You will want to start install <strong>tinytex</strong> before trying to knit any RMD files.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="#cb318-1" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;tinytex&quot;</span>)</span></code></pre></div>
<p>The packages should install rather quickly, as it is just an interface to an online latex downloader. Once the package installation is complete, you must install ‘tinytex’ through the following R command.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="#cb319-1" tabindex="-1"></a>tinytex<span class="sc">::</span><span class="fu">install_tinytex</span>()</span></code></pre></div>
<p>The install can be long but they have improved the installation process dramatically over the years. The author has made it such that the most up-to-date latex distributions are automatically downloaded and installed. There were previously a few errors along the way to installation. Recently I have not experienced any pop-up window errors. If you notice any keep clicking ‘OK’ and being patient with the downloads. However, my most recent install of <code>tinytex</code> took only seconds to finish. When your console returns to normal and installation is complete, be sure to restart RStudio. You can then double check the installation was successful with the command</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="#cb320-1" tabindex="-1"></a>tinytex<span class="sc">:::</span><span class="fu">is_tinytex</span>()</span></code></pre></div>
<pre><code>## [1] TRUE</code></pre>
<p>You can see that the output on the computer being used to generate this document returns ‘TRUE’. This means you are ready to produce your first PDF file through RMD.</p>
</div>
<div id="first-rmd-file" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">First RMD File<a href="#first-rmd-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Everything should be prepared to knit your first RMD file to PDF. The task here is to ensure it will knit the basic document. Select from the RStudio interface File &gt; New File &gt; R Markdown…, this will bring up the interface shown below in Figure 1. Fill in the information as required and be sure to select PDF as the Default output format.</p>
<p>A new page will appear that is the .RMD file. Before anything can be knit, the file must be saved (File &gt; Save As…). Where the file is saved is the “working directory” that will be used for the PDF creation. Be sure to be aware of the location you save the file. Once saved, select “knit” from the top of the screen. If everything from above has been done correctly, you should knit for you first PDF file!</p>
<p>With the new installation of <code>tinytex</code> that is much faster, it is likely that your first <code>knit</code> will require a few downloads from the Latex server. If you have done everything correctly, just be patient (you can watch progress in the <code>RMarkdown</code> terminal window) and a PDF should be produced. My first <code>knit</code> took about 60 seconds and installed three files needed to properly knit the document.</p>
<p>I will provide more code and RMD information as the semester continues.</p>
<div class="float">
<img src="images/New_RMD.png" alt="New RMD Creation Interface" />
<div class="figcaption">New RMD Creation Interface</div>
</div>
<!--chapter:end:98_PersonalComputer.Rmd-->
</div>
</div>
<div id="cheatsheet" class="section level1 unnumbered hasAnchor">
<h1 class="unnumbered hasAnchor">CheatSheet<a href="#cheatsheet" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>The goal of this appendix is to give a easy reference to basic manipulation functions that are often used and should always be readily accessible.</p>
<div id="importing-data-and-loading-packages" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Importing Data and Loading Packages<a href="#importing-data-and-loading-packages" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<colgroup>
<col width="53%" />
<col width="46%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>data("DataName", package="PackageName")</code></td>
<td align="left">Load the data set <code>DataName</code> which is found in the package <code>PackageName</code></td>
</tr>
<tr class="even">
<td align="left"><code>library(PackageName)</code></td>
<td align="left">Load the package <code>PackageName</code> to be used.</td>
</tr>
<tr class="odd">
<td align="left"><code>read.csv("filename.csv")</code></td>
<td align="left">Read a .csv file. This result needs to be saved or else it is just printed</td>
</tr>
</tbody>
</table>
</div>
<div id="useful-vectorized-functions" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Useful vectorized functions<a href="#useful-vectorized-functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<table>
<colgroup>
<col width="56%" />
<col width="43%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>ifelse( logicalTest, TrueResult, FalseResult )</code></td>
<td align="left">Creates a vector of output, where elements are either the <code>TrueResult</code> or <code>FalseResult</code> based on the corresponding outcome in the <code>logicalTest</code> vector</td>
</tr>
</tbody>
</table>
</div>
<div id="data-frame-tibble-manipulation" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Data frame (tibble) manipulation<a href="#data-frame-tibble-manipulation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the examples below, <code>df</code> stands for an arbitrary data frame that we are applying the functions to.</p>
<table>
<colgroup>
<col width="38%" />
<col width="61%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>data.frame(x= , y=.)</code></td>
<td align="left">Creates a data frame “by hand” with one column per input.</td>
</tr>
<tr class="even">
<td align="left"><code>tibble(x= , y= )</code></td>
<td align="left">Creates a tibble “by hand” with one column per input.</td>
</tr>
<tr class="odd">
<td align="left"><code>tribble( ~x, ~y, 1,  2)</code></td>
<td align="left">Creates a tibble “by hand”, but with row-wise specification.</td>
</tr>
<tr class="even">
<td align="left"><code>df %&gt;% add_row(x=3, y=5)</code></td>
<td align="left">Add a single row to the <code>df</code> data frame. Any column with unspecified data is filled with <code>NA</code>.</td>
</tr>
<tr class="odd">
<td align="left"><code>df1 %&gt;% bind_rows(df2)</code></td>
<td align="left">Stack data frames <code>df1</code> and <code>df2</code></td>
</tr>
<tr class="even">
<td align="left"><code>df %&gt;% select(ColumnNames)</code></td>
<td align="left">Subset <code>df</code> and return a data frame with the <em>columns</em> specified.</td>
</tr>
<tr class="odd">
<td align="left"><code>df %&gt;% filter(logicalTest)</code></td>
<td align="left">Subset <code>df</code> and return a data frame with the <em>rows</em> that satisfy the logical expression</td>
</tr>
<tr class="even">
<td align="left"><code>df %&gt;% mutate( New= )</code></td>
<td align="left">Create (or update) a column <code>New</code> with some manipulation of <code>Old</code> column. A common manipulation is to use an <code>ifelse()</code> command to update only particular rows.</td>
</tr>
</tbody>
</table>
</div>
<div id="data-frame-tibble-reshaping" class="section level2 unnumbered hasAnchor">
<h2 class="unnumbered hasAnchor">Data frame (tibble) reshaping<a href="#data-frame-tibble-reshaping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>These functions will modify an input data frame <code>df</code></p>
<table>
<colgroup>
<col width="54%" />
<col width="45%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Function</th>
<th align="left">Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left"><code>group_by(df, Column1, Column2)</code></td>
<td align="left">Create a grouped tibble with groups defined by all unique combinations of <code>Column1</code> and <code>Column2</code></td>
</tr>
<tr class="even">
<td align="left"><code>summarize(df, Function(Column1))</code></td>
<td align="left">Apply <code>Function</code> to <code>Column1</code> and return a data frame with just a single row. This is quite powerful when applied to a grouped tibble as it will result in a single row per group.</td>
</tr>
<tr class="odd">
<td align="left"><code>df %&gt;% pivot_wider(names_from=, values_from=)</code></td>
<td align="left">Create a <em>wide</em> data set from a <em>long</em> format</td>
</tr>
<tr class="even">
<td align="left"><code>df %&gt;% pivot_longer(names_to, values_to)</code></td>
<td align="left">Create a <em>long</em> data set from a <em>wide</em> format</td>
</tr>
</tbody>
</table>
<!--chapter:end:99_FunctionCheatSheet.Rmd-->
</div>
</div>
<!--bookdown:body:end-->
            </section>

          </div>
        </div>
      </div>
<!--bookdown:link_prev-->
<!--bookdown:link_next-->
    </div>
  </div>
<!--bookdown:config-->

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
